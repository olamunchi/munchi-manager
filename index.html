<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Munchi Manager</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
const { useState, useEffect } = React;

// Icons
const Plus = (props) => <svg className={props.className || "w-5 h-5"} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" /></svg>;
const Trash2 = (props) => <svg className={props.className || "w-5 h-5"} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>;
const Upload = (props) => <svg className={props.className || "w-5 h-5"} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" /></svg>;
const Download = (props) => <svg className={props.className || "w-5 h-5"} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10" /></svg>;
const TrendingUp = (props) => <svg className={props.className || "w-5 h-5"} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" /></svg>;
const DollarSign = (props) => <svg className={props.className || "w-5 h-5"} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>;
const Package = (props) => <svg className={props.className || "w-5 h-5"} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" /></svg>;
const FileText = (props) => <svg className={props.className || "w-5 h-5"} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>;
const Calculator = (props) => <svg className={props.className || "w-5 h-5"} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" /></svg>;
const BarChart3 = (props) => <svg className={props.className || "w-5 h-5"} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" /></svg>;
const Target = (props) => <svg className={props.className || "w-5 h-5"} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" /></svg>;
const Check = (props) => <svg className={props.className || "w-5 h-5"} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" /></svg>;
const X = (props) => <svg className={props.className || "w-5 h-5"} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" /></svg>;
const AlertCircle = (props) => <svg className={props.className || "w-5 h-5"} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>;
const ChevronDown = (props) => <svg className={props.className || "w-5 h-5"} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" /></svg>;
const ChevronUp = (props) => <svg className={props.className || "w-5 h-5"} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 15l7-7 7 7" /></svg>;
const Search = (props) => <svg className={props.className || "w-5 h-5"} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>;
const Settings = (props) => <svg className={props.className || "w-5 h-5"} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg>;
const Edit2 = (props) => <svg className={props.className || "w-5 h-5"} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>;
const Save = (props) => <svg className={props.className || "w-5 h-5"} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4" /></svg>;
const Users = (props) => <svg className={props.className || "w-5 h-5"} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" /></svg>;

// ==================== GITHUB GIST SYNC ====================
const GitHubSync = {
  GIST_ID_KEY: 'munchi_gist_id',
  TOKEN_KEY: 'munchi_github_token',
  LAST_SYNC_KEY: 'munchi_last_sync',
  
  async saveToGist(data, token) {
    try {
      const gistId = localStorage.getItem(this.GIST_ID_KEY);
      const url = gistId 
        ? `https://api.github.com/gists/${gistId}`
        : 'https://api.github.com/gists';
      
      const method = gistId ? 'PATCH' : 'POST';
      
      const response = await fetch(url, {
        method,
        headers: {
          'Authorization': `token ${token}`,
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          description: 'Munchi Manager - Backup Autom√°tico',
          public: false,
          files: {
            'munchi-data.json': {
              content: JSON.stringify(data, null, 2)
            }
          }
        })
      });
      
      if (!response.ok) {
        const errorText = await response.text();
        throw new Error(`GitHub API error: ${response.status} - ${errorText}`);
      }
      
      const result = await response.json();
      
      if (!gistId) {
        localStorage.setItem(this.GIST_ID_KEY, result.id);
      }
      
      localStorage.setItem(this.LAST_SYNC_KEY, new Date().toISOString());
      
      return { success: true, gistId: result.id, url: result.html_url };
    } catch (error) {
      console.error('Erro ao guardar no GitHub:', error);
      return { success: false, error: error.message };
    }
  },
  
  async loadFromGist(token) {
    try {
      const gistId = localStorage.getItem(this.GIST_ID_KEY);
      if (!gistId) {
        return { success: false, error: 'Nenhum backup encontrado' };
      }
      
      const response = await fetch(`https://api.github.com/gists/${gistId}`, {
        headers: {
          'Authorization': `token ${token}`,
        }
      });
      
      if (!response.ok) {
        throw new Error(`GitHub API error: ${response.status}`);
      }
      
      const gist = await response.json();
      const content = gist.files['munchi-data.json'].content;
      const data = JSON.parse(content);
      
      return { success: true, data };
    } catch (error) {
      console.error('Erro ao carregar do GitHub:', error);
      return { success: false, error: error.message };
    }
  },
  
  isConfigured() {
    return !!localStorage.getItem(this.TOKEN_KEY);
  },
  
  getToken() {
    return localStorage.getItem(this.TOKEN_KEY);
  },
  
  setToken(token) {
    localStorage.setItem(this.TOKEN_KEY, token);
  },
  
  clearConfig() {
    localStorage.removeItem(this.TOKEN_KEY);
    localStorage.removeItem(this.GIST_ID_KEY);
    localStorage.removeItem(this.LAST_SYNC_KEY);
  },
  
  getLastSync() {
    const lastSync = localStorage.getItem(this.LAST_SYNC_KEY);
    return lastSync ? new Date(lastSync) : null;
  },
  
  getGistUrl() {
    const gistId = localStorage.getItem(this.GIST_ID_KEY);
    return gistId ? `https://gist.github.com/${gistId}` : null;
  },
  
  getAutoSyncEnabled() {
    const enabled = localStorage.getItem('munchi_auto_sync_enabled');
    return enabled === null ? true : enabled === 'true';
  },
  
  setAutoSyncEnabled(enabled) {
    localStorage.setItem('munchi_auto_sync_enabled', enabled.toString());
  }
};

// Novos √≠cones para cloud sync
const Cloud = (props) => <svg className={props.className || "w-5 h-5"} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10" /></svg>;
const CloudCheck = (props) => <svg className={props.className || "w-5 h-5"} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>;
const RefreshCw = (props) => <svg className={props.className || "w-5 h-5"} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" /></svg>;


if (typeof window.storage === 'undefined') {
  window.storage = {
    get: (key) => { try { const value = localStorage.getItem(key); return value ? { key, value, shared: false } : null; } catch { return null; } },
    set: (key, value) => { try { localStorage.setItem(key, value); return { key, value, shared: false }; } catch { return null; } },
    delete: (key) => { try { localStorage.removeItem(key); return { key, deleted: true, shared: false }; } catch { return null; } },
    list: () => ({ keys: Object.keys(localStorage), shared: false })
  };
}




const CloudSyncPanel = ({ 
  onSync, 
  isSyncing, 
  lastSync, 
  syncError,
  autoSyncEnabled,
  setAutoSyncEnabled 
}) => {
  const [showConfig, setShowConfig] = React.useState(false);
  const [token, setToken] = React.useState('');
  const [showToken, setShowToken] = React.useState(false);
  
  const isConfigured = GitHubSync.isConfigured();
  const gistUrl = GitHubSync.getGistUrl();
  
  const saveToken = () => {
    if (token.trim()) {
      GitHubSync.setToken(token.trim());
      setShowConfig(false);
      setToken('');
      alert('‚úÖ Token guardado! A sincronizar dados...');
      setTimeout(onSync, 500);
    }
  };
  
  const clearConfig = () => {
    if (confirm('‚ö†Ô∏è Tem a certeza que quer desconectar o GitHub?\n\nOs dados locais N√ÉO ser√£o apagados, mas o backup autom√°tico ser√° desativado.')) {
      GitHubSync.clearConfig();
      setShowConfig(false);
      alert('‚úÖ GitHub desconectado');
    }
  };
  
  const getTimeSince = (date) => {
    if (!date) return 'Nunca';
    const seconds = Math.floor((new Date() - date) / 1000);
    if (seconds < 60) return 'Agora mesmo';
    const minutes = Math.floor(seconds / 60);
    if (minutes < 60) return `H√° ${minutes} min`;
    const hours = Math.floor(minutes / 60);
    if (hours < 24) return `H√° ${hours}h`;
    const days = Math.floor(hours / 24);
    return `H√° ${days} ${days === 1 ? 'dia' : 'dias'}`;
  };
  
  return (
    <div className="bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg p-4 border-2 border-blue-200 shadow-md">
      <div className="flex items-center justify-between mb-3">
        <div className="flex items-center gap-2">
          <Cloud className="w-6 h-6 text-blue-600" />
          <div>
            <h3 className="font-bold text-blue-900">Backup Cloud (GitHub)</h3>
            {isConfigured && !showConfig && (
              <p className="text-xs text-blue-700">Auto-sync: {autoSyncEnabled ? '‚úÖ Ativo' : '‚è∏Ô∏è Pausado'}</p>
            )}
          </div>
        </div>
        <button
          onClick={() => setShowConfig(!showConfig)}
          className="text-blue-600 hover:text-blue-800 p-2 hover:bg-blue-100 rounded transition"
          title="Configura√ß√µes"
        >
          <Settings className="w-5 h-5" />
        </button>
      </div>
      
      {showConfig ? (
        <div className="space-y-3 bg-white rounded-lg p-4 border border-blue-300">
          <div>
            <label className="block text-sm font-semibold text-gray-700 mb-2">
              üîë GitHub Personal Access Token
            </label>
            <div className="relative">
              <input
                type={showToken ? "text" : "password"}
                value={token}
                onChange={(e) => setToken(e.target.value)}
                placeholder="ghp_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
                className="w-full px-3 py-2 pr-20 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500"
              />
              <button
                onClick={() => setShowToken(!showToken)}
                className="absolute right-2 top-1/2 -translate-y-1/2 text-xs text-blue-600 hover:text-blue-800 font-semibold"
              >
                {showToken ? 'Ocultar' : 'Mostrar'}
              </button>
            </div>
            
            <div className="mt-2 space-y-1 text-xs text-gray-600">
              <p className="flex items-start gap-1">
                <span className="text-blue-600 font-bold">1.</span>
                <span>Crie token em: <a href="https://github.com/settings/tokens/new?scopes=gist&description=Munchi%20Manager%20Backup" target="_blank" className="text-blue-600 underline font-semibold hover:text-blue-800">github.com/settings/tokens</a></span>
              </p>
              <p className="flex items-start gap-1">
                <span className="text-blue-600 font-bold">2.</span>
                <span>Marque apenas: <strong className="text-green-700">‚úì gist</strong></span>
              </p>
              <p className="flex items-start gap-1">
                <span className="text-blue-600 font-bold">3.</span>
                <span>Cole aqui e clique em "Guardar"</span>
              </p>
            </div>
          </div>
          
          <div className="flex gap-2">
            <button
              onClick={saveToken}
              disabled={!token.trim()}
              className="flex-1 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed text-white px-4 py-2 rounded font-semibold transition"
            >
              üíæ Guardar Token
            </button>
            {isConfigured && (
              <button
                onClick={clearConfig}
                className="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded font-semibold transition"
              >
                üîå Desconectar
              </button>
            )}
          </div>
          
          <div className="bg-yellow-50 border border-yellow-200 rounded p-3 text-xs text-yellow-900">
            <p className="font-semibold mb-1 flex items-center gap-1">
              üîí Seguran√ßa & Privacidade
            </p>
            <ul className="space-y-1 ml-4 text-yellow-800">
              <li>‚Ä¢ Token guardado <strong>localmente</strong> no seu browser</li>
              <li>‚Ä¢ Nunca partilhado com servidores externos</li>
              <li>‚Ä¢ Gist criado como <strong>privado</strong> (s√≥ voc√™ v√™)</li>
              <li>‚Ä¢ Pode revogar token a qualquer momento</li>
            </ul>
          </div>
        </div>
      ) : (
        <>
          {!isConfigured ? (
            <div className="bg-yellow-50 border border-yellow-300 rounded-lg p-3">
              <p className="text-sm text-yellow-800 flex items-center gap-2">
                <AlertCircle className="w-5 h-5 flex-shrink-0" />
                <span>Configure o GitHub para ativar backup autom√°tico na cloud</span>
              </p>
              <button
                onClick={() => setShowConfig(true)}
                className="mt-2 w-full bg-yellow-600 hover:bg-yellow-700 text-white px-3 py-2 rounded font-semibold transition text-sm"
              >
                ‚öôÔ∏è Configurar Agora
              </button>
            </div>
          ) : (
            <div className="space-y-3">
              {/* Status Card */}
              <div className="bg-white rounded-lg p-3 border-2 border-green-300 shadow-sm">
                <div className="flex items-center justify-between mb-2">
                  <div className="flex items-center gap-2">
                    <CloudCheck className="w-5 h-5 text-green-600" />
                    <div>
                      <p className="text-sm font-semibold text-green-900">Conectado ‚úì</p>
                      <p className="text-xs text-green-700">√öltimo backup: {getTimeSince(lastSync)}</p>
                    </div>
                  </div>
                  <button
                    onClick={onSync}
                    disabled={isSyncing}
                    className="bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white px-3 py-2 rounded font-semibold transition flex items-center gap-2 text-sm"
                    title="Sincronizar agora"
                  >
                    <RefreshCw className={`w-4 h-4 ${isSyncing ? 'animate-spin' : ''}`} />
                    {isSyncing ? 'A sincronizar...' : 'Sync'}
                  </button>
                </div>
                
                {gistUrl && (
                  <a
                    href={gistUrl}
                    target="_blank"
                    rel="noopener noreferrer"
                    className="text-xs text-blue-600 hover:text-blue-800 underline flex items-center gap-1"
                  >
                    üîó Ver backup no GitHub
                    <svg className="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                    </svg>
                  </a>
                )}
              </div>
              
              {/* Error Message */}
              {syncError && (
                <div className="bg-red-50 border border-red-300 rounded-lg p-3">
                  <p className="text-sm text-red-800 flex items-start gap-2">
                    <AlertCircle className="w-5 h-5 flex-shrink-0 mt-0.5" />
                    <span><strong>Erro:</strong> {syncError}</span>
                  </p>
                  <button
                    onClick={() => setShowConfig(true)}
                    className="mt-2 text-xs text-red-700 hover:text-red-900 underline font-semibold"
                  >
                    ‚Üí Reconfigurar token
                  </button>
                </div>
              )}
              
              {/* Auto-sync Toggle */}
              <div className="flex items-center justify-between bg-white rounded p-2 border border-gray-200">
                <div className="flex items-center gap-2">
                  <input
                    type="checkbox"
                    id="autoSyncToggle"
                    checked={autoSyncEnabled}
                    onChange={(e) => setAutoSyncEnabled(e.target.checked)}
                    className="w-4 h-4 rounded text-blue-600 focus:ring-2 focus:ring-blue-500"
                  />
                  <label htmlFor="autoSyncToggle" className="text-sm text-gray-700 cursor-pointer">
                    üîÑ Auto-sync a cada 5 minutos
                  </label>
                </div>
                <span className={`text-xs font-semibold px-2 py-1 rounded ${autoSyncEnabled ? 'bg-green-100 text-green-700' : 'bg-gray-100 text-gray-600'}`}>
                  {autoSyncEnabled ? 'ON' : 'OFF'}
                </span>
              </div>
              
              {/* Info Box */}
              <div className="bg-blue-50 border border-blue-200 rounded p-2 text-xs text-blue-800">
                <p className="font-semibold mb-1">üí° Como funciona:</p>
                <ul className="space-y-0.5 ml-3">
                  <li>‚Ä¢ Dados guardados automaticamente no GitHub</li>
                  <li>‚Ä¢ Aceda de qualquer dispositivo com o mesmo token</li>
                  <li>‚Ä¢ Hist√≥rico completo no seu Gist privado</li>
                </ul>
              </div>
            </div>
          )}
        </>
      )}
    </div>
  );
};

const ComprasAnalysis = ({ despesas, faturas = [], ingredientes, fornecedores }) => {
  const [searchCompra, setSearchCompra] = React.useState('');
  const [categoriaCompra, setCategoriaCompra] = React.useState('all');
  
  // Combinar despesas antigas com faturas novas
  const todasCompras = React.useMemo(() => {
    const compras = [];
    
    // Adicionar despesas antigas (se existirem)
    despesas.forEach(d => {
      if (d.ingredienteId && d.quantidade && d.quantidade > 0) {
        compras.push({
          ingredienteId: d.ingredienteId,
          quantidade: d.quantidade,
          fornecedor: d.fornecedor,
          precoUnitario: d.valor / d.quantidade,
          data: d.data
        });
      }
    });
    
    // Adicionar items de faturas novas
    faturas.forEach(f => {
      f.items.forEach(item => {
        compras.push({
          ingredienteId: item.ingredienteId,
          quantidade: item.quantidade,
          fornecedor: f.fornecedorNome,
          precoUnitario: item.precoUnitario,
          data: f.data
        });
      });
    });
    
    return compras;
  }, [despesas, faturas]);
  
  
  // Categorize ingredients
  const categorias = {
    'vegetais': ['alface', 'tomate', 'cebola', 'cenoura', 'batata', 'cogumelo', 'pimento', 'alho', 'couve', 'br√≥colos', 'espinafre'],
    'carnes': ['frango', 'carne', 'porco', 'vaca', 'peru', 'bacon', 'salsicha', 'bife', 'costela'],
    'peixe': ['salm√£o', 'atum', 'bacalhau', 'camar√£o', 'polvo', 'lula', 'peixe', 'marisco'],
    'latic√≠nios': ['leite', 'queijo', 'iogurte', 'manteiga', 'nata', 'mozzarella', 'requeij√£o', 'mozarela'],
    'padaria': ['p√£o'],
    'pastelaria': ['farinha', 'fermento', 'chocolate', 'cacau', 'baunilha', 'am√™ndoa', 'noz'],
    'compotas': ['a√ß√∫car', 'pectina', '√°cido c√≠trico'],
    'bebidas': ['√°gua', 'sumo', 'refrigerante', 'vinho', 'cerveja', 'caf√©', 'ch√°'],
    'temperos': ['sal', 'pimenta', 'azeite', 'vinagre', 'oreg√£os', 'especiaria', 'canela', 'colorau']
  };
  
  const getCategoria = (ingrediente) => {
    return ingrediente.categoria || 'outros';
  };
  
  // Build price comparison data
  const comprasPorIngrediente = React.useMemo(() => {
    const result = {};
    todasCompras.forEach(compra => {
      const ing = ingredientes.find(i => i.id == compra.ingredienteId);
      if (!ing) return;
      
      if (!result[compra.ingredienteId]) {
        result[compra.ingredienteId] = {
          nome: ing.nome,
          unidade: ing.unidade,
          categoria: getCategoria(ing),
          compras: []
        };
      }
      
      result[compra.ingredienteId].compras.push({
        fornecedor: compra.fornecedor,
        precoUnitario: compra.precoUnitario,
        data: compra.data,
        quantidade: compra.quantidade
      });
    });
    return result;
  }, [todasCompras, ingredientes]);
  
  // Filter ingredients
  const ingredientesFiltrados = React.useMemo(() => {
    let filtered = Object.values(comprasPorIngrediente).filter(ing => ing.compras.length > 0);
    
    if (categoriaCompra !== 'all') {
      filtered = filtered.filter(ing => ing.categoria === categoriaCompra);
    }
    
    if (searchCompra) {
      filtered = filtered.filter(ing => 
        ing.nome.toLowerCase().includes(searchCompra.toLowerCase())
      );
    }
    
    return filtered.slice(0, 50);
  }, [comprasPorIngrediente, categoriaCompra, searchCompra]);
  
  // Count by category
  const countByCategoria = React.useMemo(() => {
    const counts = {};
    Object.values(comprasPorIngrediente).forEach(ing => {
      counts[ing.categoria] = (counts[ing.categoria] || 0) + 1;
    });
    return counts;
  }, [comprasPorIngrediente]);
  
  const allCount = Object.values(comprasPorIngrediente).filter(ing => ing.compras.length > 0).length;
  
  return (
    <div className="bg-white rounded-lg shadow p-3">
      <h2 className="text-base font-bold mb-3">üìä An√°lise de Compras</h2>
      
      {/* Summary Cards */}
<div className="grid grid-cols-3 gap-2 mb-3">
        <div className="bg-blue-50 rounded p-3 border border-blue-200">
          <p className="text-xs text-blue-700 mb-1">Total Compras</p>
          <p className="text-xl font-bold text-blue-900">
            ‚Ç¨{todasCompras.reduce((sum, c) => sum + (c.precoUnitario * c.quantidade), 0).toFixed(2)}
          </p>
        </div>
        <div className="bg-green-50 rounded p-3 border border-green-200">
          <p className="text-xs text-green-700 mb-1">N¬∫ Fornecedores</p>
          <p className="text-xl font-bold text-green-900">{fornecedores.length}</p>
        </div>
        <div className="bg-purple-50 rounded p-3 border border-purple-200">
          <p className="text-xs text-purple-700 mb-1">Ingredientes</p>
          <p className="text-xl font-bold text-purple-900">{ingredientes.length}</p>
        </div>
      </div>

      {/* Price Comparison */}
      <div className="bg-gradient-to-r from-blue-50 to-indigo-50 rounded border border-blue-200 p-3">
        <h3 className="text-sm font-bold mb-3 text-blue-900">üí∞ Compara√ß√£o de Pre√ßos</h3>
        
        {/* Category Tabs */}
        <div className="flex gap-1 mb-3 overflow-x-auto bg-white p-1 rounded">
          {[
            {id: 'all', emoji: 'üì¶', label: 'Todos', count: allCount},
            {id: 'vegetais', emoji: 'ü•¨', label: 'Vegetais', count: countByCategoria['vegetais'] || 0},
            {id: 'carnes', emoji: 'ü•©', label: 'Carnes', count: countByCategoria['carnes'] || 0},
            {id: 'peixe', emoji: 'üêü', label: 'Peixe', count: countByCategoria['peixe'] || 0},
            {id: 'latic√≠nios', emoji: 'üßÄ', label: 'Latic√≠nios', count: countByCategoria['latic√≠nios'] || 0},
            {id: 'padaria', emoji: 'ü•ñ', label: 'Padaria', count: countByCategoria['padaria'] || 0},
            {id: 'pastelaria', emoji: 'üç∞', label: 'Pastelaria', count: countByCategoria['pastelaria'] || 0},
            {id: 'compotas', emoji: 'üçØ', label: 'Compotas', count: countByCategoria['compotas'] || 0},
            {id: 'bebidas', emoji: 'ü•§', label: 'Bebidas', count: countByCategoria['bebidas'] || 0},
            {id: 'temperos', emoji: 'üßÇ', label: 'Temperos', count: countByCategoria['temperos'] || 0},
            {id: 'embalagens', emoji: 'üì¶', label: 'Embalagens', count: countByCategoria['embalagens'] || 0},
            {id: 'limpeza', emoji: 'üßπ', label: 'Limpeza', count: countByCategoria['limpeza'] || 0},
            {id: 'outros', emoji: 'üìã', label: 'Outros', count: countByCategoria['outros'] || 0}
          ].map(cat => (
            <button
              key={cat.id}
              onClick={() => setCategoriaCompra(cat.id)}
              className={`px-3 py-1.5 rounded text-xs font-semibold whitespace-nowrap transition-colors ${
                categoriaCompra === cat.id ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
              }`}
            >
              {cat.emoji} {cat.label} ({cat.count})
            </button>
          ))}
        </div>
        
        {/* Search Bar */}
        <div className="mb-3">
          <input
            type="text"
            placeholder="üîç Procurar ingrediente..."
            value={searchCompra}
            onChange={(e) => setSearchCompra(e.target.value)}
            className="w-full px-3 py-2 border-2 border-blue-300 rounded-lg text-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-200"
          />
        </div>
        
        {/* Results */}
        {ingredientesFiltrados.length === 0 ? (
          <div className="text-center py-8 bg-white rounded border">
            <p className="text-sm text-gray-600">
              {searchCompra ? `Nenhum ingrediente encontrado com "${searchCompra}"` : 'Nenhum ingrediente nesta categoria'}
            </p>
          </div>
        ) : (
          <div className="space-y-2 max-h-96 overflow-y-auto">
            {ingredientesFiltrados.map(ing => {
              const precoMedio = ing.compras.reduce((s, c) => s + c.precoUnitario, 0) / ing.compras.length;
              const precoMin = Math.min(...ing.compras.map(c => c.precoUnitario));
              const precoMax = Math.max(...ing.compras.map(c => c.precoUnitario));
              const melhorCompra = ing.compras.reduce((best, curr) => 
                curr.precoUnitario < best.precoUnitario ? curr : best
              );
              
              return (
                <div key={ing.nome} className="bg-white rounded p-2 border hover:shadow-md transition-shadow">
                  <div className="flex justify-between items-start mb-1">
                    <span className="font-bold text-sm text-gray-800">{ing.nome}</span>
                    <div className="text-right">
                      <span className="text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded block">
                        {ing.compras.length} compra{ing.compras.length > 1 ? 's' : ''}
                      </span>
                      {(() => {
                        // Calculate monthly average
                        if (ing.compras.length === 0) return null;
                        
                        const sortedCompras = [...ing.compras].sort((a, b) => new Date(a.data) - new Date(b.data));
                        const firstDate = new Date(sortedCompras[0].data);
                        const lastDate = new Date(sortedCompras[sortedCompras.length - 1].data);
                        
                        // Calculate months between first and last purchase
                        const monthsDiff = (lastDate.getFullYear() - firstDate.getFullYear()) * 12 + 
                                          (lastDate.getMonth() - firstDate.getMonth()) + 1; // +1 to include both months
                        
                        const comprasPorMes = ing.compras.length / monthsDiff;
                        const qtdTotal = ing.compras.reduce((sum, c) => sum + c.quantidade, 0);
                        const qtdPorMes = qtdTotal / monthsDiff;
                        const gastoTotal = ing.compras.reduce((sum, c) => sum + (c.precoUnitario * c.quantidade), 0);
                        const gastoPorMes = gastoTotal / monthsDiff;
                        
                        return (
                          <div className="mt-1 text-[10px] text-gray-600 space-y-0.5">
                            <div className="bg-purple-50 px-1.5 py-0.5 rounded">
                              üìä {comprasPorMes.toFixed(1)}x/m√™s
                            </div>
                            <div className="bg-green-50 px-1.5 py-0.5 rounded">
                              üì¶ {qtdPorMes.toFixed(1)}{ing.unidade}/m√™s
                            </div>
                            <div className="bg-orange-50 px-1.5 py-0.5 rounded">
                              üí∞ ‚Ç¨{gastoPorMes.toFixed(2)}/m√™s
                            </div>
                          </div>
                        );
                      })()}
                    </div>
                  </div>
                  <div className="grid grid-cols-3 gap-2 text-xs">
                    <div>
                      <span className="text-gray-600">M√©dio:</span>
                      <span className="font-semibold ml-1">‚Ç¨{precoMedio.toFixed(2)}/{ing.unidade}</span>
                    </div>
                    <div>
                      <span className="text-green-600">Min:</span>
                      <span className="font-semibold ml-1 text-green-700">‚Ç¨{precoMin.toFixed(2)}</span>
                    </div>
                    <div>
                      <span className="text-red-600">Max:</span>
                      <span className="font-semibold ml-1 text-red-700">‚Ç¨{precoMax.toFixed(2)}</span>
                    </div>
                  </div>
                  {melhorCompra.fornecedor && (
                    <p className="text-xs text-gray-600 mt-1">
                      üí° Melhor: <span className="font-semibold">{melhorCompra.fornecedor}</span> - ‚Ç¨{melhorCompra.precoUnitario.toFixed(2)}/{ing.unidade}
                    </p>
                  )}
                  
                  {/* Hist√≥rico de Compras */}
                  {ing.compras.length > 1 && (
                    <div className="mt-2 bg-gray-50 rounded p-2">
                      <p className="text-xs font-semibold text-gray-700 mb-1">üìÖ Hist√≥rico:</p>
                      <div className="space-y-0.5">
                        {ing.compras
                          .sort((a, b) => new Date(a.data) - new Date(b.data))
                          .map((compra, idx) => {
                            const isMelhor = compra.precoUnitario === precoMin;
                            return (
                              <div key={idx} className={`text-xs flex justify-between items-center ${isMelhor ? 'font-semibold text-green-700' : 'text-gray-600'}`}>
                                <span>
                                  {new Date(compra.data).toLocaleDateString('pt-PT', { day: '2-digit', month: '2-digit' })} 
                                  {' ‚Ä¢ '}
                                  {compra.fornecedor}
                                </span>
                                <span>
                                  ‚Ç¨{compra.precoUnitario.toFixed(2)}/{ing.unidade}
                                  {isMelhor && ' ‚≠ê'}
                                </span>
                              </div>
                            );
                          })}
                      </div>
                    </div>
                  )}
                  
                  {/* Price Evolution Chart */}
                  {ing.compras.length > 2 && (
                    <div className="mt-2 bg-blue-50 rounded p-2 border border-blue-200">
                      <p className="text-xs font-semibold text-blue-900 mb-2">üìà Evolu√ß√£o de Pre√ßos</p>
                      <div className="relative h-40 bg-white rounded p-3">
                        {(() => {
                          const sortedCompras = [...ing.compras].sort((a, b) => new Date(a.data) - new Date(b.data));
                          const precos = sortedCompras.map(c => c.precoUnitario);
                          const minPreco = Math.min(...precos);
                          const maxPreco = Math.max(...precos);
                          const range = maxPreco - minPreco || 1;
                          
                          return (
                            <>
                              {/* Grid lines with labels */}
                              <div className="absolute inset-0 p-2 pointer-events-none">
                                {[0, 0.25, 0.5, 0.75, 1].map((percent, idx) => {
                                  const price = minPreco + (maxPreco - minPreco) * (1 - percent);
                                  const yPos = `${percent * 100}%`;
                                  return (
                                    <div key={idx} className="absolute w-full" style={{top: yPos}}>
                                      <div className={`border-t ${idx === 0 || idx === 4 ? 'border-gray-400' : 'border-gray-200'} border-dashed`}></div>
                                      <span className="absolute left-0 -top-2 text-[9px] font-semibold text-gray-700 bg-white/90 px-1">
                                        ‚Ç¨{price.toFixed(2)}
                                      </span>
                                    </div>
                                  );
                                })}
                              </div>
                              
                              {/* Price line */}
                              <svg className="absolute inset-0 w-full h-full p-2" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid meet">
                                <polyline
                                  points={sortedCompras.map((c, i) => {
                                    const x = (i / (sortedCompras.length - 1)) * 100;
                                    const y = 100 - ((c.precoUnitario - minPreco) / range) * 80;
                                    return `${x},${y}`;
                                  }).join(' ')}
                                  fill="none"
                                  stroke="#3b82f6"
                                  strokeWidth="0.8"
                                  vectorEffect="non-scaling-stroke"
                                />
                                {/* Points */}
                                {sortedCompras.map((c, i) => {
                                  const x = (i / (sortedCompras.length - 1)) * 100;
                                  const y = 100 - ((c.precoUnitario - minPreco) / range) * 80;
                                  const isMelhor = c.precoUnitario === minPreco;
                                  
                                  // Determine color based on price change
                                  let priceColor = '#6b7280'; // gray for first point
                                  if (i > 0) {
                                    const prevPrice = sortedCompras[i - 1].precoUnitario;
                                    if (c.precoUnitario < prevPrice) {
                                      priceColor = '#10b981'; // GREEN (desceu)
                                    } else if (c.precoUnitario > prevPrice) {
                                      priceColor = '#ef4444'; // RED (subiu)
                                    } else {
                                      priceColor = '#6b7280'; // GRAY (igual)
                                    }
                                  }
                                  
                                  return (
                                    <g key={i}>
                                      <circle
                                        cx={x}
                                        cy={y}
                                        r="2"
                                        fill={isMelhor ? '#10b981' : '#3b82f6'}
                                        stroke="white"
                                        strokeWidth="0.3"
                                      />
                                      {/* Price label */}
                                      <text
                                        x={x}
                                        y={y + 6}
                                        fontSize="6"
                                        fontWeight="800"
                                        fill={priceColor}
                                        stroke="white"
                                        strokeWidth="0.4"
                                        textAnchor="middle"
                                        className="pointer-events-none"
                                      >
                                        ‚Ç¨{c.precoUnitario.toFixed(2)}
                                      </text>
                                      {/* Date label */}
                                      <text
                                        x={x}
                                        y={y + 13}
                                        fontSize="4"
                                        fontWeight="700"
                                        fill="#6b7280"
                                        textAnchor="middle"
                                        className="pointer-events-none"
                                      >
                                        {new Date(c.data).toLocaleDateString('pt-PT', { day: '2-digit', month: '2-digit' })}
                                      </text>
                                    </g>
                                  );
                                })}
                              </svg>
                              

                              {/* Date labels - Smart spacing */}
                              <div className="absolute bottom-0 left-0 right-0 flex justify-between px-2 text-[9px] font-semibold text-blue-700">
                                {(() => {
                                  // Show 4-6 date markers evenly spaced
                                  const numLabels = Math.min(6, sortedCompras.length);
                                  const step = Math.max(1, Math.floor(sortedCompras.length / (numLabels - 1)));
                                  const labels = [];
                                  
                                  for (let i = 0; i < sortedCompras.length; i += step) {
                                    if (labels.length >= numLabels - 1) break;
                                    labels.push(i);
                                  }
                                  // Always include last
                                  if (labels[labels.length - 1] !== sortedCompras.length - 1) {
                                    labels.push(sortedCompras.length - 1);
                                  }
                                  
                                  return labels.map((idx, i) => (
                                    <span key={i} className="bg-blue-50/90 px-1 py-0.5 rounded">
                                      {new Date(sortedCompras[idx].data).toLocaleDateString('pt-PT', { day: 'numeric', month: 'short' })}
                                    </span>
                                  ));
                                })()}
                              </div>
                            </>
                          );
                        })()}
                      </div>
                      
                      {/* Trend indicator */}
                      {(() => {
                        const sortedCompras = [...ing.compras].sort((a, b) => new Date(a.data) - new Date(b.data));
                        const primeiroPreco = sortedCompras[0].precoUnitario;
                        const ultimoPreco = sortedCompras[sortedCompras.length - 1].precoUnitario;
                        const variacao = ((ultimoPreco - primeiroPreco) / primeiroPreco) * 100;
                        const isSubiu = variacao > 0;
                        
                        return (
                          <div className={`mt-1 text-xs flex items-center gap-1 ${isSubiu ? 'text-red-600' : variacao < 0 ? 'text-green-600' : 'text-gray-600'}`}>
                            {isSubiu ? 'üìà' : variacao < 0 ? 'üìâ' : '‚û°Ô∏è'}
                            <span className="font-semibold">
                              {isSubiu ? '+' : ''}{variacao.toFixed(1)}%
                            </span>
                            <span>desde {new Date(sortedCompras[0].data).toLocaleDateString('pt-PT', { month: 'short' })}</span>
                          </div>
                        );
                      })()}
                    </div>
                  )}
                  
                  {/* Price Alerts */}
                  {ing.compras.length > 1 && (() => {
                    const sortedCompras = [...ing.compras].sort((a, b) => new Date(a.data) - new Date(b.data));
                    const precos = sortedCompras.map(c => c.precoUnitario);
                    const minPreco = Math.min(...precos);
                    const maxPreco = Math.max(...precos);
                    const variacao = ((maxPreco - minPreco) / minPreco) * 100;
                    
                    // Check last 30 days
                    const hoje = new Date();
                    const trinta_dias = new Date(hoje.getTime() - 30 * 24 * 60 * 60 * 1000);
                    const comprasRecentes = sortedCompras.filter(c => new Date(c.data) >= trinta_dias);
                    
                    // Trend in last month
                    let trendAlert = null;
                    if (comprasRecentes.length >= 2) {
                      const primeiraRecente = comprasRecentes[0].precoUnitario;
                      const ultimaRecente = comprasRecentes[comprasRecentes.length - 1].precoUnitario;
                      const variacaoMes = ((ultimaRecente - primeiraRecente) / primeiraRecente) * 100;
                      
                      if (variacaoMes > 5) {
                        trendAlert = { type: 'warning', message: `Pre√ßo subiu ${variacaoMes.toFixed(1)}% este m√™s`, icon: '‚ö†Ô∏è' };
                      } else if (variacaoMes < -5) {
                        trendAlert = { type: 'success', message: `Pre√ßo desceu ${Math.abs(variacaoMes).toFixed(1)}% este m√™s`, icon: '‚úÖ' };
                      }
                    }
                    
                    // Best price recently
                    const melhorCompraRecente = sortedCompras.find(c => c.precoUnitario === minPreco);
                    const diasDesdeRecorde = melhorCompraRecente ? Math.floor((hoje - new Date(melhorCompraRecente.data)) / (24 * 60 * 60 * 1000)) : 999;
                    const recordeRecente = diasDesdeRecorde <= 30;
                    
                    // High variation alert
                    const altaVariacao = variacao > 10;
                    
                    const alerts = [];
                    if (trendAlert) alerts.push(trendAlert);
                    if (recordeRecente) alerts.push({ 
                      type: 'info', 
                      message: `Melhor pre√ßo nos √∫ltimos 30 dias (${melhorCompraRecente.fornecedor})`,
                      icon: 'üéØ'
                    });
                    if (altaVariacao) alerts.push({
                      type: 'warning',
                      message: `Varia√ß√£o de ${variacao.toFixed(1)}% entre fornecedores`,
                      icon: 'üìä'
                    });
                    
                    return alerts.length > 0 ? (
                      <div className="mt-2 space-y-1">
                        {alerts.map((alert, idx) => (
                          <div 
                            key={idx}
                            className={`text-xs px-2 py-1 rounded flex items-start gap-1 ${
                              alert.type === 'warning' ? 'bg-orange-50 text-orange-800 border border-orange-200' :
                              alert.type === 'success' ? 'bg-green-50 text-green-800 border border-green-200' :
                              'bg-blue-50 text-blue-800 border border-blue-200'
                            }`}
                          >
                            <span>{alert.icon}</span>
                            <span className="flex-1">{alert.message}</span>
                          </div>
                        ))}
                      </div>
                    ) : null;
                  })()}
                </div>
              );
            })}
            {ingredientesFiltrados.length === 50 && (
              <p className="text-xs text-center text-gray-500 py-2">
                A mostrar 50 ingredientes. Refine a pesquisa para ver mais resultados espec√≠ficos.
              </p>
            )}
          </div>
        )}
      </div>
    </div>
  );
};

// ==================== GITHUB BACKUP PANEL COMPONENT ====================
const GitHubBackupPanel = ({ onSync }) => {
  const [token, setToken] = React.useState('');
  const [showToken, setShowToken] = React.useState(false);
  const [showConfig, setShowConfig] = React.useState(false);
  const [isSyncing, setIsSyncing] = React.useState(false);
  const [passwordInput, setPasswordInput] = React.useState('');
  const [showSavedToken, setShowSavedToken] = React.useState(false);
  
  const isConfigured = GitHubSync.isConfigured();
  const gistUrl = GitHubSync.getGistUrl();
  const lastSync = GitHubSync.getLastSync();
  const autoSyncEnabled = GitHubSync.getAutoSyncEnabled();

  const saveToken = () => {
    if (token.trim()) {
      GitHubSync.setToken(token.trim());
      setShowConfig(false);
      setToken('');
      alert('‚úÖ Token guardado! A sincronizar dados...');
      handleSync();
    }
  };

  const clearConfig = () => {
    if (confirm('‚ö†Ô∏è Tem a certeza que quer desconectar o GitHub?\\n\\nOs dados locais N√ÉO ser√£o apagados, mas o backup autom√°tico ser√° desativado.')) {
      GitHubSync.clearConfig();
      setShowConfig(false);
      alert('‚úÖ GitHub desconectado');
    }
  };

  const handleSync = async () => {
    setIsSyncing(true);
    try {
      await onSync();
    } finally {
      setIsSyncing(false);
    }
  };

  const getTimeSince = (dateString) => {
    if (!dateString) return 'Nunca';
    const date = new Date(dateString);
    const now = new Date();
    const seconds = Math.floor((now - date) / 1000);
    if (seconds < 60) return 'Agora mesmo';
    const minutes = Math.floor(seconds / 60);
    if (minutes < 60) return `H√° ${minutes} ${minutes === 1 ? 'minuto' : 'minutos'}`;
    const hours = Math.floor(minutes / 60);
    if (hours < 24) return `H√° ${hours} ${hours === 1 ? 'hora' : 'horas'}`;
    const days = Math.floor(hours / 24);
    return `H√° ${days} ${days === 1 ? 'dia' : 'dias'}`;
  };
  
  return (
    <div className="bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg p-4 border-2 border-blue-200 shadow-md">
      <div className="flex items-center justify-between mb-3">
        <div className="flex items-center gap-2">
          <Cloud className="w-6 h-6 text-blue-600" />
          <div>
            <h3 className="font-bold text-blue-900">Backup Cloud (GitHub)</h3>
            {isConfigured && !showConfig && (
              <p className="text-xs text-blue-700">Auto-sync: {autoSyncEnabled ? '‚úÖ Ativo' : '‚è∏Ô∏è Pausado'}</p>
            )}
          </div>
        </div>
        <button
          onClick={() => setShowConfig(!showConfig)}
          className="text-blue-600 hover:text-blue-800 p-2 hover:bg-blue-100 rounded transition"
          title="Configura√ß√µes"
        >
          <Settings className="w-5 h-5" />
        </button>
      </div>
      
      {showConfig ? (
        <div className="space-y-3 bg-white rounded-lg p-4 border border-blue-300">
          <div>
            <label className="block text-sm font-semibold text-gray-700 mb-2">
              üîë GitHub Personal Access Token
            </label>
            <div className="relative">
              <input
                type={showToken ? "text" : "password"}
                value={token}
                onChange={(e) => setToken(e.target.value)}
                placeholder="ghp_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
                className="w-full px-3 py-2 pr-20 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500"
              />
              <button
                onClick={() => setShowToken(!showToken)}
                className="absolute right-2 top-1/2 -translate-y-1/2 text-xs text-blue-600 hover:text-blue-800 font-semibold"
              >
                {showToken ? 'Ocultar' : 'Mostrar'}
              </button>
            </div>
            
            <div className="mt-2 space-y-1 text-xs text-gray-600">
              <p className="flex items-start gap-1">
                <span className="text-blue-600 font-bold">1.</span>
                <span>Crie token em: <a href="https://github.com/settings/tokens/new?scopes=gist&description=Munchi%20Manager%20Backup" target="_blank" className="text-blue-600 underline font-semibold hover:text-blue-800">github.com/settings/tokens</a></span>
              </p>
              <p className="flex items-start gap-1">
                <span className="text-blue-600 font-bold">2.</span>
                <span>Marque apenas: <strong className="text-green-700">‚úì gist</strong></span>
              </p>
              <p className="flex items-start gap-1">
                <span className="text-blue-600 font-bold">3.</span>
                <span>Cole aqui e clique em "Guardar"</span>
              </p>
            </div>
          </div>
          
          <div className="flex gap-2">
            <button
              onClick={saveToken}
              disabled={!token.trim()}
              className="flex-1 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed text-white px-4 py-2 rounded font-semibold transition"
            >
              üíæ Guardar Token
            </button>
            {isConfigured && (
              <button
                onClick={clearConfig}
                className="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded font-semibold transition"
              >
                üîå Desconectar
              </button>
            )}
          </div>
          
          <div className="bg-yellow-50 border border-yellow-200 rounded p-3 text-xs text-yellow-900">
            <p className="font-semibold mb-1 flex items-center gap-1">
              üîí Seguran√ßa & Privacidade
            </p>
            <ul className="space-y-1 ml-4 text-yellow-800">
              <li>‚Ä¢ Token guardado <strong>localmente</strong> no seu browser</li>
              <li>‚Ä¢ Nunca partilhado com servidores externos</li>
              <li>‚Ä¢ Gist criado como <strong>privado</strong> (s√≥ voc√™ v√™)</li>
              <li>‚Ä¢ Pode revogar token a qualquer momento</li>
            </ul>
          </div>
        </div>
      ) : (
        <>
          {!isConfigured ? (
            <div className="bg-yellow-50 border border-yellow-300 rounded-lg p-3">
              <p className="text-sm text-yellow-800 flex items-center gap-2">
                <AlertCircle className="w-5 h-5 flex-shrink-0" />
                <span>Configure o GitHub para ativar backup autom√°tico na cloud</span>
              </p>
              <button
                onClick={() => setShowConfig(true)}
                className="mt-2 w-full bg-yellow-600 hover:bg-yellow-700 text-white px-3 py-2 rounded font-semibold transition text-sm"
              >
                ‚öôÔ∏è Configurar Agora
              </button>
            </div>
          ) : (
            <div className="space-y-3">
              <div className="bg-white rounded-lg p-3 border-2 border-green-300 shadow-sm">
                <div className="flex items-center justify-between mb-2">
                  <div className="flex items-center gap-2">
                    <CloudCheck className="w-5 h-5 text-green-600" />
                    <div>
                      <p className="text-sm font-semibold text-green-900">Conectado ‚úì</p>
                      <p className="text-xs text-green-700">√öltimo backup: {getTimeSince(lastSync)}</p>
                    </div>
                  </div>
                  <button
                    onClick={handleSync}
                    disabled={isSyncing}
                    className="bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white px-3 py-2 rounded font-semibold transition flex items-center gap-2 text-sm"
                    title="Sincronizar agora"
                  >
                    <RefreshCw className={`w-4 h-4 ${isSyncing ? 'animate-spin' : ''}`} />
                    {isSyncing ? 'A sincronizar...' : 'Sync'}
                  </button>
                </div>
                
                {gistUrl && (
                  <a
                    href={gistUrl}
                    target="_blank"
                    rel="noopener noreferrer"
                    className="text-xs text-blue-600 hover:text-blue-800 underline flex items-center gap-1"
                  >
                    üîó Ver backup no GitHub
                    <svg className="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                    </svg>
                  </a>
                )}
              </div>
              
              {/* Ver Token Protegido por Password */}
              <div className="bg-white rounded-lg p-3 border border-gray-300">
                <div className="space-y-2">
                  <p className="text-sm font-semibold text-gray-900 flex items-center gap-2">
                    üîê Ver Token
                    <span className="text-xs font-normal text-gray-500">(para copiar noutro dispositivo)</span>
                  </p>
                  
                  {!showSavedToken ? (
                    <div className="space-y-2">
                      <div className="flex gap-2">
                        <input
                          type="password"
                          value={passwordInput}
                          onChange={(e) => setPasswordInput(e.target.value)}
                          placeholder="Password de prote√ß√£o"
                          className="flex-1 px-3 py-2 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500"
                          onKeyPress={(e) => {
                            if (e.key === 'Enter') {
                              const savedPwd = localStorage.getItem('munchi_token_password');
                              
                              if (!savedPwd) {
                                // Primeira vez - define a password
                                localStorage.setItem('munchi_token_password', passwordInput);
                                setShowSavedToken(true);
                                setPasswordInput('');
                                alert('‚úÖ Password definida! Use esta password para ver o token no futuro.');
                              } else if (passwordInput === savedPwd) {
                                // Password correta
                                setShowSavedToken(true);
                                setPasswordInput('');
                              } else {
                                // Password errada
                                alert('‚ùå Password incorreta!');
                                setPasswordInput('');
                              }
                            }
                          }}
                        />
                        <button
                          onClick={() => {
                            const savedPwd = localStorage.getItem('munchi_token_password');
                            
                            if (!savedPwd) {
                              localStorage.setItem('munchi_token_password', passwordInput);
                              setShowSavedToken(true);
                              setPasswordInput('');
                              alert('‚úÖ Password definida! Use esta password para ver o token no futuro.');
                            } else if (passwordInput === savedPwd) {
                              setShowSavedToken(true);
                              setPasswordInput('');
                            } else {
                              alert('‚ùå Password incorreta!');
                              setPasswordInput('');
                            }
                          }}
                          className="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded font-semibold transition text-sm whitespace-nowrap"
                        >
                          üëÅÔ∏è Ver
                        </button>
                      </div>
                      <p className="text-xs text-gray-500">
                        {localStorage.getItem('munchi_token_password') 
                          ? 'üí° Introduce a tua password para ver o token' 
                          : 'üí° Define uma password para proteger o acesso ao token'}
                      </p>
                    </div>
                  ) : (
                    <div className="space-y-2">
                      <div className="relative">
                        <input
                          type="text"
                          value={GitHubSync.getToken()}
                          readOnly
                          className="w-full px-3 py-2 pr-24 border border-gray-300 rounded text-xs bg-gray-50 font-mono"
                        />
                        <button
                          onClick={() => {
                            navigator.clipboard.writeText(GitHubSync.getToken());
                            alert('‚úÖ Token copiado para a √°rea de transfer√™ncia!');
                          }}
                          className="absolute right-2 top-1/2 -translate-y-1/2 px-3 py-1 bg-green-600 hover:bg-green-700 text-white rounded text-xs font-semibold"
                        >
                          üìã Copiar
                        </button>
                      </div>
                      <button
                        onClick={() => {
                          setShowSavedToken(false);
                          setPasswordInput('');
                        }}
                        className="text-xs text-blue-600 hover:text-blue-800 font-semibold"
                      >
                        üîí Ocultar
                      </button>
                    </div>
                  )}
                </div>
              </div>
              
              <div className="bg-white rounded-lg p-3 border border-gray-300">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-sm font-semibold text-gray-900">Sincroniza√ß√£o Autom√°tica</p>
                    <p className="text-xs text-gray-600">Backup a cada 5 minutos</p>
                  </div>
                  <button
                    onClick={() => {
                      GitHubSync.setAutoSyncEnabled(!autoSyncEnabled);
                      window.location.reload();
                    }}
                    className={`w-12 h-6 rounded-full transition ${autoSyncEnabled ? 'bg-green-500' : 'bg-gray-300'} relative`}
                  >
                    <div className={`w-5 h-5 rounded-full bg-white absolute top-0.5 transition-all ${autoSyncEnabled ? 'left-6' : 'left-0.5'}`}></div>
                  </button>
                </div>
              </div>
            </div>
          )}
        </>
      )}
    </div>
  );
};

const RestauranteGestor = () => {
  const [activeTab, setActiveTab] = useState('dashboard');

  const [isSyncing, setIsSyncing] = React.useState(false);
  const [lastSync, setLastSync] = React.useState(GitHubSync.getLastSync());
  const [syncError, setSyncError] = React.useState(null);
  const [autoSyncEnabled, setAutoSyncEnabled] = React.useState(true);
  
  

  const [dashboardSubTab, setDashboardSubTab] = useState('resumo');
  const [dateFilter, setDateFilter] = useState('all'); // all, today, week, month, custom
  const [customStartDate, setCustomStartDate] = useState('');
  const [customEndDate, setCustomEndDate] = useState('');
  const [gestaoSubTab, setGestaoSubTab] = useState('ingredientes');
  const [produtos, setProdutos] = useState([]);
  const [ingredientes, setIngredientes] = useState([]);
  const [vendas, setVendas] = useState([]);
  const [despesas, setDespesas] = useState([]);
  const [fornecedores, setFornecedores] = useState([]);
  const [novoProduto, setNovoProduto] = useState({ nome: '', precoVenda: '', iva: '6', receita: [], embalagens: [] });
  const [editandoProduto, setEditandoProduto] = useState(false);
  const [produtoEditandoId, setProdutoEditandoId] = useState(null);
  
  // Estados para delivery apps
  const [deliveryApps, setDeliveryApps] = useState([
    { 
      id: 'uber', 
      nome: 'Uber Eats', 
      comissao: 25, 
      ativo: false, 
      cor: '#06c167',
      dataAtualizacao: new Date().toISOString().split('T')[0]
    },
    { 
      id: 'glovo', 
      nome: 'Glovo', 
      comissao: 28, 
      ativo: false, 
      cor: '#ffc244',
      dataAtualizacao: new Date().toISOString().split('T')[0]
    },
    { 
      id: 'bolt', 
      nome: 'Bolt Food', 
      comissao: 27, 
      ativo: false, 
      cor: '#34d186',
      dataAtualizacao: new Date().toISOString().split('T')[0]
    }
  ]);
  const [editandoApp, setEditandoApp] = useState(null);
  const [novaApp, setNovaApp] = useState({ nome: '', comissao: '25' });
  const [embalagens, setEmbalagens] = useState([]);
  const [novaEmbalagem, setNovaEmbalagem] = useState({ nome: '', custoUnitario: '', categoria: 'copos' });
  const [searchIngrediente, setSearchIngrediente] = useState('');

  // Auto-save GitHub (handled by GitHubSync internally)

  const [showIngredienteSuggestions, setShowIngredienteSuggestions] = useState(false);
  const [searchIngredienteFatura, setSearchIngredienteFatura] = useState('');
  const [showIngredienteSuggestionsFatura, setShowIngredienteSuggestionsFatura] = useState(false);
  const [novoIngrediente, setNovoIngrediente] = useState({ nome: '', unidade: 'kg', custoUnitario: '', iva: '6' });
  const [editandoIngrediente, setEditandoIngrediente] = useState(false);
  const [ingredienteEditandoId, setIngredienteEditandoId] = useState(null);
  const [novaDespesa, setNovaDespesa] = useState({ 
    descricao: '', 
    valor: '', 
    iva: '23', 
    data: new Date().toISOString().split('T')[0], 
    categoria: 'compras',
    fornecedor: '',
    ingredienteId: null,
    quantidade: '',
    num_funcionarios: 1,
    frequencia_pagamento: 'mensal'
  });
  const [searchDespesaIngrediente, setSearchDespesaIngrediente] = useState('');
  const [showDespesaSuggestions, setShowDespesaSuggestions] = useState(false);
  const [showPriceHistory, setShowPriceHistory] = useState(false);
  const [showPriceAlert, setShowPriceAlert] = useState(false);
  const [priceAlertData, setPriceAlertData] = useState(null);
  const [ordenadoDesejado, setOrdenadoDesejado] = useState(920);
  const [incluirSubsidioAlimentacao, setIncluirSubsidioAlimentacao] = useState(false);
  const [valorSubsidioAlimentacao, setValorSubsidioAlimentacao] = useState(6.00);
  const [modoSimulador, setModoSimulador] = useState('fulltime'); // 'fulltime' ou 'parttime'
  const [horasSemanaisPartTime, setHorasSemanaisPartTime] = useState(8);
  const [horasSemanais, setHorasSemanais] = useState(20);
  const [valorHora, setValorHora] = useState(10);
  const [simuladorAberto, setSimuladorAberto] = useState(false);
  const [notification, setNotification] = useState(null);
  const [expandedProduct, setExpandedProduct] = useState(null);
  
  // Novos estados para Dados da Empresa
  const [dadosEmpresa, setDadosEmpresa] = useState({
    nif: '',
    nome: '',
    morada: '',
    codigoPostal: '',
    cidade: '',
    cae: '',
    email: '',
    telefone: ''
  });
  
  // Novos estados para Faturas
  const [faturas, setFaturas] = useState([]);
  const [novaFatura, setNovaFatura] = useState({
    numero: '',
    data: new Date().toISOString().split('T')[0],
    fornecedorId: '',
    items: [],
    notas: ''
  });
  const [itemFatura, setItemFatura] = useState({
    ingredienteId: '',
    quantidade: '',
    precoUnitario: '',
    iva: '13'
  });
  const [expandedFatura, setExpandedFatura] = useState(null);
  const [editandoFatura, setEditandoFatura] = useState(false);
  const [faturaEditando, setFaturaEditando] = useState(null);
  const [modoFormulario, setModoFormulario] = useState('completo'); // 'completo' ou 'rapido'
  const [dadosEmpresaExpanded, setDadosEmpresaExpanded] = useState(false);
  const [fornecedoresExpanded, setFornecedoresExpanded] = useState(false);
  const [deliveryAppsExpanded, setDeliveryAppsExpanded] = useState(false);

  const showNotification = (message, type = 'success') => {
    setNotification({ message, type });
    setTimeout(() => setNotification(null), 3000);
  };


  const exportarDados = () => {
    const dados = {
      versao: '2.0',
      dataExport: new Date().toISOString(),
      produtos,
      ingredientes,
      vendas,
      despesas,
      fornecedores,
      dadosEmpresa,
      faturas
    };
    
    const blob = new Blob([JSON.stringify(dados, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `munchi-backup-${new Date().toISOString().split('T')[0]}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    showNotification('Backup exportado!', 'success');
  };

  const importarDados = (event) => {
    const file = event.target.files[0];
    if (!file) return;
    
    const reader = new FileReader();
    reader.onload = (e) => {
      try {
        const dados = JSON.parse(e.target.result);
        
        if (confirm('‚ö†Ô∏è Substituir todos os dados?')) {
          if (dados.produtos) setProdutos(dados.produtos);
          if (dados.ingredientes) setIngredientes(dados.ingredientes);
          if (dados.vendas) setVendas(dados.vendas);
          if (dados.despesas) setDespesas(dados.despesas);
          if (dados.fornecedores) setFornecedores(dados.fornecedores);
          if (dados.dadosEmpresa) setDadosEmpresa(dados.dadosEmpresa);
          if (dados.faturas) setFaturas(dados.faturas);
          
          showNotification('Dados importados!', 'success');
          event.target.value = '';
        }
      } catch (error) {
        showNotification('Erro ao importar!', 'error');
      }
    };
    reader.readAsText(file);
  };
  
  // ========== FUN√á√ïES DE EXPORT CSV ==========
  
  const exportarVendasCSV = () => {
    if (!vendas || vendas.length === 0) {
      showNotification('Nenhuma venda para exportar!', 'error');
      return;
    }

    const filteredVendas = getFilteredData(vendas);
    
    if (filteredVendas.length === 0) {
      showNotification('Nenhuma venda no per√≠odo selecionado!', 'error');
      return;
    }

    // CSV Header
    const headers = ['Data', 'Produto', 'Quantidade', 'Pre√ßo Unit.', 'Total', 'IVA', 'Total c/ IVA'];
    
    // Build CSV rows
    const rows = filteredVendas.map(v => {
      const totalSemIva = v.valor;
      const valorIva = totalSemIva * (v.iva / 100);
      const totalComIva = totalSemIva + valorIva;
      const precoUnitario = v.quantidade > 0 ? totalSemIva / v.quantidade : 0;
      
      return [
        new Date(v.data).toLocaleDateString('pt-PT'),
        `"${v.produto}"`,
        v.quantidade,
        precoUnitario.toFixed(2),
        totalSemIva.toFixed(2),
        `${v.iva}%`,
        totalComIva.toFixed(2)
      ].join(',');
    });
    
    // Create CSV content
    const csvContent = [
      headers.join(','),
      ...rows
    ].join('\n');
    
    // Download
    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `munchi-vendas-${new Date().toISOString().split('T')[0]}.csv`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    showNotification(`${filteredVendas.length} vendas exportadas!`, 'success');
  };
  
  const exportarDespesasCSV = () => {
    if (!despesas || despesas.length === 0) {
      showNotification('Nenhuma despesa para exportar!', 'error');
      return;
    }

    const filteredDespesas = getFilteredData(despesas);
    
    if (filteredDespesas.length === 0) {
      showNotification('Nenhuma despesa no per√≠odo selecionado!', 'error');
      return;
    }

    // CSV Header
    const headers = ['Data', 'Categoria', 'Descri√ß√£o', 'Fornecedor', 'Valor', 'IVA', 'Total c/ IVA'];
    
    // Build CSV rows
    const rows = filteredDespesas.map(d => {
      const valorIva = d.valor * (d.iva / 100);
      const totalComIva = d.valor + valorIva;
      
      return [
        new Date(d.data).toLocaleDateString('pt-PT'),
        `"${d.categoria}"`,
        `"${d.descricao}"`,
        `"${d.fornecedor || 'N/A'}"`,
        d.valor.toFixed(2),
        `${d.iva}%`,
        totalComIva.toFixed(2)
      ].join(',');
    });
    
    // Create CSV content
    const csvContent = [
      headers.join(','),
      ...rows
    ].join('\n');
    
    // Download
    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `munchi-despesas-${new Date().toISOString().split('T')[0]}.csv`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    showNotification(`${filteredDespesas.length} despesas exportadas!`, 'success');
  };

  useEffect(() => {
    const carregar = async () => {
      try {
        const [p, i, v, d, f, de, ft] = await Promise.all([
          window.storage.get('produtos').catch(() => null),
          window.storage.get('ingredientes').catch(() => null),
          window.storage.get('vendas').catch(() => null),
          window.storage.get('despesas').catch(() => null),
          window.storage.get('fornecedores').catch(() => null),
          window.storage.get('dadosEmpresa').catch(() => null),
          window.storage.get('faturas').catch(() => null)
        ]);
        if (p) setProdutos(JSON.parse(p.value));
        if (i) setIngredientes(JSON.parse(i.value));
        if (v) setVendas(JSON.parse(v.value));
        if (d) setDespesas(JSON.parse(d.value));
        if (f) setFornecedores(JSON.parse(f.value));
        if (de) setDadosEmpresa(JSON.parse(de.value));
        if (ft) setFaturas(JSON.parse(ft.value));
      } catch (e) { console.log('Primeira vez'); }
    };
    carregar();
  }, []);


  // Close ingredient suggestions when changing tabs
  useEffect(() => {
    setShowIngredienteSuggestions(false);
  }, [activeTab, gestaoSubTab]);

  useEffect(() => {
    const salvar = async () => {
      try {
        await Promise.all([
          window.storage.set('produtos', JSON.stringify(produtos)),
          window.storage.set('ingredientes', JSON.stringify(ingredientes)),
          window.storage.set('vendas', JSON.stringify(vendas)),
          window.storage.set('despesas', JSON.stringify(despesas)),
          window.storage.set('fornecedores', JSON.stringify(fornecedores)),
          window.storage.set('dadosEmpresa', JSON.stringify(dadosEmpresa)),
          window.storage.set('faturas', JSON.stringify(faturas))
        ]);
      } catch (e) { console.error(e); }
    };
    salvar();
  }, [produtos, ingredientes, vendas, despesas, fornecedores, dadosEmpresa, faturas]);


  const detectarCategoria = (nome) => {
    const n = nome.toLowerCase();
    const categorias = {
      'vegetais': ['alface', 'tomate', 'cebola', 'cenoura', 'batata', 'cogumelo', 'pimento', 'alho', 'couve', 'br√≥colos', 'espinafre'],
      'carnes': ['frango', 'carne', 'porco', 'vaca', 'peru', 'bacon', 'salsicha', 'bife', 'costela'],
      'peixe': ['salm√£o', 'atum', 'bacalhau', 'camar√£o', 'polvo', 'lula', 'peixe', 'marisco'],
      'latic√≠nios': ['leite', 'queijo', 'iogurte', 'manteiga', 'nata', 'mozzarella', 'requeij√£o', 'mozarela'],
      'padaria': ['p√£o'],
      'pastelaria': ['farinha', 'fermento', 'chocolate', 'cacau', 'baunilha', 'am√™ndoa', 'noz'],
      'compotas': ['a√ß√∫car', 'pectina', '√°cido c√≠trico'],
      'bebidas': ['√°gua', 'sumo', 'refrigerante', 'vinho', 'cerveja', 'caf√©', 'ch√°'],
      'temperos': ['sal', 'pimenta', 'azeite', 'vinagre', 'oreg√£os', 'especiaria', 'canela', 'colorau']
    };
    
    for (const [cat, keywords] of Object.entries(categorias)) {
      if (keywords.some(k => n.includes(k))) return cat;
    }
    return 'outros';
  };

  const adicionarIngrediente = () => {
    if (!novoIngrediente.nome || !novoIngrediente.custoUnitario) {
      showNotification('Preencha nome e custo!', 'error');
      return;
    }
    const custoComIva = parseFloat(novoIngrediente.custoUnitario);
    const iva = parseFloat(novoIngrediente.iva);
    const custoSemIva = custoComIva / (1 + iva / 100);
    
    setIngredientes([...ingredientes, { 
      id: Date.now(), 
      ...novoIngrediente, 
      custoUnitario: custoComIva,
      custoSemIva: custoSemIva,
      iva: iva,
      categoria: novoIngrediente.categoria || 'outros'
    }]);
    setNovoIngrediente({ nome: '', unidade: 'kg', custoUnitario: '', iva: '6', categoria: 'outros' });
    showNotification('Ingrediente adicionado!', 'success');
  };
  
  const adicionarEmbalagem = () => {
    if (!novaEmbalagem.nome || !novaEmbalagem.custoUnitario) {
      showNotification('Preencha nome e custo da embalagem!', 'error');
      return;
    }
    setEmbalagens([...embalagens, {
      id: Date.now(),
      ...novaEmbalagem,
      custoUnitario: parseFloat(novaEmbalagem.custoUnitario)
    }]);
    setNovaEmbalagem({ nome: '', custoUnitario: '', categoria: 'copos' });
    showNotification('Embalagem adicionada!', 'success');
  };
  
  const toggleApp = (appId) => {
    setDeliveryApps(deliveryApps.map(app => 
      app.id === appId ? { ...app, ativo: !app.ativo } : app
    ));
    const app = deliveryApps.find(a => a.id === appId);
    showNotification(`${app.nome} ${app.ativo ? 'desativada' : 'ativada'}!`, 'success');
  };
  
  const atualizarComissaoApp = (appId, novaComissao) => {
    setDeliveryApps(deliveryApps.map(app => 
      app.id === appId ? { 
        ...app, 
        comissao: parseFloat(novaComissao),
        dataAtualizacao: new Date().toISOString().split('T')[0]
      } : app
    ));
    setEditandoApp(null);
    showNotification('Comiss√£o atualizada!', 'success');
  };
  
  const adicionarNovaApp = () => {
    if (!novaApp.nome || !novaApp.comissao) {
      showNotification('Preencha nome e comiss√£o!', 'error');
      return;
    }
    setDeliveryApps([...deliveryApps, {
      id: Date.now().toString(),
      nome: novaApp.nome,
      comissao: parseFloat(novaApp.comissao),
      ativo: false,
      cor: '#' + Math.floor(Math.random()*16777215).toString(16),
      dataAtualizacao: new Date().toISOString().split('T')[0]
    }]);
    setNovaApp({ nome: '', comissao: '25' });
    showNotification('App adicionada!', 'success');
  };
  
  const apagarApp = (appId) => {
    if (confirm('Apagar esta app?')) {
      setDeliveryApps(deliveryApps.filter(app => app.id !== appId));
      showNotification('App apagada!', 'success');
    }
  };
  
  const editarIngrediente = (ingrediente) => {
    setNovoIngrediente({
      nome: ingrediente.nome,
      unidade: ingrediente.unidade,
      custoUnitario: ingrediente.custoUnitario.toString(),
      iva: ingrediente.iva.toString(),
      categoria: ingrediente.categoria || 'outros'
    });
    setEditandoIngrediente(true);
    setIngredienteEditandoId(ingrediente.id);
    window.scrollTo({ top: 0, behavior: 'smooth' });
  };
  
  const atualizarIngrediente = () => {
    if (!novoIngrediente.nome || !novoIngrediente.custoUnitario) {
      showNotification('Preencha nome e custo!', 'error');
      return;
    }
    
    const ingredienteAntigo = ingredientes.find(i => i.id === ingredienteEditandoId);
    const custoNovo = parseFloat(novoIngrediente.custoUnitario);
    const custoAntigo = ingredienteAntigo.custoUnitario;
    const diferenca = Math.abs(custoNovo - custoAntigo);
    const diferencaPerc = custoAntigo > 0 ? (diferenca / custoAntigo) * 100 : 0;
    
    // Se pre√ßo mudou mais de 5%, mostrar alerta
    if (diferencaPerc > 5) {
      // Encontrar produtos afetados
      const produtosAfetados = produtos.filter(p => 
        p.receita && p.receita.some(r => r.ingredienteId === ingredienteEditandoId)
      ).map(p => {
        const receitaItem = p.receita.find(r => r.ingredienteId === ingredienteEditandoId);
        const custoAntes = receitaItem.quantidade * custoAntigo;
        const custoDepois = receitaItem.quantidade * custoNovo;
        const margemAntes = p.precoVenda - p.receita.reduce((s, r) => {
          const ing = ingredientes.find(i => i.id == r.ingredienteId);
          return s + (r.quantidade * (ing?.custoUnitario || 0));
        }, 0);
        const margemDepois = margemAntes - (custoDepois - custoAntes);
        
        return {
          nome: p.nome,
          margemDif: margemDepois - margemAntes
        };
      });
      
      setPriceAlertData({
        ingrediente: ingredienteAntigo,
        precoAtual: custoAntigo,
        precoNovo: custoNovo,
        diferencaPerc,
        produtosAfetados,
        ingredienteData: novoIngrediente,
        tipoFatura: 'ingrediente' // Marca como edi√ß√£o de ingrediente
      });
      setShowPriceAlert(true);
      return; // N√£o atualiza ainda
    }
    
    // Se pre√ßo n√£o mudou muito, atualiza normalmente
    atualizarIngredienteSemAlerta();
  };
  
  const atualizarIngredienteSemAlerta = () => {
    const custoComIva = parseFloat(novoIngrediente.custoUnitario);
    const iva = parseFloat(novoIngrediente.iva);
    const custoSemIva = custoComIva / (1 + iva / 100);
    
    setIngredientes(ingredientes.map(i => 
      i.id === ingredienteEditandoId ? {
        ...i,
        nome: novoIngrediente.nome,
        unidade: novoIngrediente.unidade,
        custoUnitario: custoComIva,
        custoSemIva: custoSemIva,
        iva: iva,
        categoria: novoIngrediente.categoria || 'outros'
      } : i
    ));
    
    setNovoIngrediente({ nome: '', unidade: 'kg', custoUnitario: '', iva: '6', categoria: 'outros' });
    setEditandoIngrediente(false);
    setIngredienteEditandoId(null);
    showNotification('Ingrediente atualizado!', 'success');
  };
  
  const cancelarEdicaoIngrediente = () => {
    setNovoIngrediente({ nome: '', unidade: 'kg', custoUnitario: '', iva: '6', categoria: 'outros' });
    setEditandoIngrediente(false);
    setIngredienteEditandoId(null);
  };

  const adicionarProduto = () => {
    if (!novoProduto.nome || !novoProduto.precoVenda) {
      showNotification('Preencha nome e pre√ßo!', 'error');
      return;
    }
    setProdutos([...produtos, { id: Date.now(), ...novoProduto, precoVenda: parseFloat(novoProduto.precoVenda), iva: parseFloat(novoProduto.iva) }]);
    setNovoProduto({ nome: '', precoVenda: '', iva: '6', receita: [] });
    setSearchIngrediente('');
    setShowIngredienteSuggestions(false);
    showNotification('Produto adicionado!', 'success');
  };
  
  const editarProduto = (produto) => {
    setNovoProduto({
      nome: produto.nome,
      precoVenda: produto.precoVenda.toString(),
      iva: produto.iva.toString(),
      receita: produto.receita || []
    });
    setEditandoProduto(true);
    setProdutoEditandoId(produto.id);
    window.scrollTo({ top: 0, behavior: 'smooth' });
  };
  
  const atualizarProduto = () => {
    if (!novoProduto.nome || !novoProduto.precoVenda) {
      showNotification('Preencha nome e pre√ßo!', 'error');
      return;
    }
    
    setProdutos(produtos.map(p => 
      p.id === produtoEditandoId ? {
        ...p,
        nome: novoProduto.nome,
        precoVenda: parseFloat(novoProduto.precoVenda),
        iva: parseFloat(novoProduto.iva),
        receita: novoProduto.receita
      } : p
    ));
    
    setNovoProduto({ nome: '', precoVenda: '', iva: '6', receita: [] });
    setSearchIngrediente('');
    setShowIngredienteSuggestions(false);
    setEditandoProduto(false);
    setProdutoEditandoId(null);
    showNotification('Produto atualizado!', 'success');
  };
  
  const cancelarEdicaoProduto = () => {
    setNovoProduto({ nome: '', precoVenda: '', iva: '6', receita: [] });
    setSearchIngrediente('');
    setShowIngredienteSuggestions(false);
    setEditandoProduto(false);
    setProdutoEditandoId(null);
  };

  const adicionarDespesa = () => {
    if (!novaDespesa.descricao || !novaDespesa.valor) {
      showNotification('Preencha descri√ß√£o e valor!', 'error');
      return;
    }
    
    // Check price difference if ingredient selected
    if (novaDespesa.ingredienteId && novaDespesa.quantidade) {
      const ingrediente = ingredientes.find(i => i.id === novaDespesa.ingredienteId);
      const precoNovo = parseFloat(novaDespesa.valor) / parseFloat(novaDespesa.quantidade);
      const precoAtual = ingrediente.custoUnitario;
      const diferenca = Math.abs(precoNovo - precoAtual);
      const diferencaPerc = (diferenca / precoAtual) * 100;
      
      // Show alert if price differs by more than 5%
      if (diferencaPerc > 5) {
        // Find affected products
        const produtosAfetados = produtos.filter(p => 
          p.receita && p.receita.some(r => r.ingredienteId === novaDespesa.ingredienteId)
        ).map(p => {
          const receitaItem = p.receita.find(r => r.ingredienteId === novaDespesa.ingredienteId);
          const custoAntes = receitaItem.quantidade * precoAtual;
          const custoDepois = receitaItem.quantidade * precoNovo;
          const margemAntes = p.precoVenda - p.receita.reduce((s, r) => {
            const ing = ingredientes.find(i => i.id === r.ingredienteId);
            return s + (r.quantidade * (ing?.custoUnitario || 0));
          }, 0);
          const margemDepois = margemAntes - (custoDepois - custoAntes);
          
          return {
            nome: p.nome,
            margemDif: margemDepois - margemAntes
          };
        });
        
        setPriceAlertData({
          ingrediente,
          precoAtual,
          precoNovo,
          diferencaPerc,
          produtosAfetados,
          despesaData: novaDespesa
        });
        setShowPriceAlert(true);
        return; // Don't add yet, wait for user decision
      }
    }
    
    // Add expense normally
    if (novaDespesa.fornecedor && !fornecedores.includes(novaDespesa.fornecedor)) {
      setFornecedores([...fornecedores, novaDespesa.fornecedor]);
    }
    
    setDespesas([...despesas, { 
      id: Date.now(), 
      ...novaDespesa, 
      valor: parseFloat(novaDespesa.valor), 
      iva: parseFloat(novaDespesa.iva),
      quantidade: novaDespesa.quantidade ? parseFloat(novaDespesa.quantidade) : null
    }]);
    setNovaDespesa({ 
      descricao: '', 
      valor: '', 
      iva: '23', 
      data: new Date().toISOString().split('T')[0], 
      categoria: 'compras',
      fornecedor: '',
      ingredienteId: null,
      quantidade: '',
      num_funcionarios: 1,
      frequencia_pagamento: 'mensal'
    });
    setSearchDespesaIngrediente('');
    showNotification('Despesa adicionada!', 'success');
  };

  const confirmarDespesaSemAtualizar = () => {
    const despesaData = priceAlertData.despesaData;
    
    if (despesaData.fornecedor && !fornecedores.includes(despesaData.fornecedor)) {
      setFornecedores([...fornecedores, despesaData.fornecedor]);
    }
    
    setDespesas([...despesas, { 
      id: Date.now(), 
      ...despesaData, 
      valor: parseFloat(despesaData.valor), 
      iva: parseFloat(despesaData.iva),
      quantidade: despesaData.quantidade ? parseFloat(despesaData.quantidade) : null
    }]);
    setNovaDespesa({ 
      descricao: '', 
      valor: '', 
      iva: '23', 
      data: new Date().toISOString().split('T')[0], 
      categoria: 'compras',
      fornecedor: '',
      ingredienteId: null,
      quantidade: '',
      num_funcionarios: 1,
      frequencia_pagamento: 'mensal'
    });
    setSearchDespesaIngrediente('');
    setShowPriceAlert(false);
    setPriceAlertData(null);
    showNotification('Despesa adicionada!', 'success');
  };

  const confirmarDespesaEAtualizar = () => {
    const { ingrediente, precoNovo, produtosAfetados, despesaData } = priceAlertData;
    
    // Update ingredient cost
    const updatedIngredientes = ingredientes.map(i => 
      i.id === ingrediente.id ? { ...i, custoUnitario: precoNovo } : i
    );
    setIngredientes(updatedIngredientes);
    
    // Add expense
    if (despesaData.fornecedor && !fornecedores.includes(despesaData.fornecedor)) {
      setFornecedores([...fornecedores, despesaData.fornecedor]);
    }
    
    setDespesas([...despesas, { 
      id: Date.now(), 
      ...despesaData, 
      valor: parseFloat(despesaData.valor), 
      iva: parseFloat(despesaData.iva),
      quantidade: despesaData.quantidade ? parseFloat(despesaData.quantidade) : null
    }]);
    setNovaDespesa({ 
      descricao: '', 
      valor: '', 
      iva: '23', 
      data: new Date().toISOString().split('T')[0], 
      categoria: 'compras',
      fornecedor: '',
      ingredienteId: null,
      quantidade: '',
      num_funcionarios: 1,
      frequencia_pagamento: 'mensal'
    });
    setSearchDespesaIngrediente('');
    setShowPriceAlert(false);
    setPriceAlertData(null);
    showNotification(`‚úÖ Custo do ${ingrediente.nome} atualizado! ${produtosAfetados.length} produtos recalculados`, 'success');
  };

  // ========== FUN√á√ïES PARA FATURAS ==========
  
  const confirmarFaturaSemAtualizar = () => {
    console.log('confirmarFaturaSemAtualizar chamada', priceAlertData);
    // Guardar sem atualizar custo
    if (priceAlertData.tipoFatura === 'rapido') {
      salvarFaturaRapidaSemAlerta();
    } else if (priceAlertData.tipoFatura === 'edicao') {
      atualizarFaturaSemAlerta(priceAlertData.faturaData, priceAlertData.faturaEditandoId);
    } else if (priceAlertData.tipoFatura === 'ingrediente') {
      atualizarIngredienteSemAlerta();
    } else {
      salvarFaturaSemAlerta(priceAlertData.faturaData);
    }
    setShowPriceAlert(false);
    setPriceAlertData(null);
  };
  
  const confirmarFaturaEAtualizar = () => {
    console.log('confirmarFaturaEAtualizar chamada', priceAlertData);
    const { ingrediente, precoNovo, produtosAfetados } = priceAlertData;
    
    // Se for edi√ß√£o de ingrediente, N√ÉO atualiza custo (j√° est√° sendo atualizado)
    if (priceAlertData.tipoFatura !== 'ingrediente') {
      // Atualizar custo do ingrediente (para faturas)
      const updatedIngredientes = ingredientes.map(i => 
        i.id == ingrediente.id ? { ...i, custoUnitario: precoNovo } : i
      );
      setIngredientes(updatedIngredientes);
    }
    
    // Guardar/atualizar
    if (priceAlertData.tipoFatura === 'rapido') {
      salvarFaturaRapidaSemAlerta();
    } else if (priceAlertData.tipoFatura === 'edicao') {
      atualizarFaturaSemAlerta(priceAlertData.faturaData, priceAlertData.faturaEditandoId);
    } else if (priceAlertData.tipoFatura === 'ingrediente') {
      atualizarIngredienteSemAlerta();
    } else {
      salvarFaturaSemAlerta(priceAlertData.faturaData);
    }
    setShowPriceAlert(false);
    setPriceAlertData(null);
    
    showNotification(`Custo do ${ingrediente.nome} atualizado! ${produtosAfetados.length} produtos afetados`, 'success');
  };
  
  const adicionarItemFatura = () => {
    console.log('adicionarItemFatura chamada', { itemFatura });
    
    if (!itemFatura.ingredienteId || !itemFatura.quantidade || !itemFatura.precoUnitario) {
      console.log('Valida√ß√£o falhou:', {
        ingredienteId: itemFatura.ingredienteId,
        quantidade: itemFatura.quantidade,
        precoUnitario: itemFatura.precoUnitario
      });
      showNotification('Preencha todos os campos do item!', 'error');
      return;
    }
    
    const ingrediente = ingredientes.find(i => i.id == itemFatura.ingredienteId);
    console.log('Ingrediente encontrado:', ingrediente);
    
    if (!ingrediente) {
      showNotification('Ingrediente n√£o encontrado!', 'error');
      return;
    }
    
    const quantidade = parseFloat(itemFatura.quantidade);
    const precoUnitario = parseFloat(itemFatura.precoUnitario);
    const iva = parseFloat(itemFatura.iva || '13');
    const subtotal = quantidade * precoUnitario;
    
    const novoItem = {
      id: Date.now(),
      ingredienteId: itemFatura.ingredienteId,
      ingredienteNome: ingrediente.nome,
      unidade: ingrediente.unidade,
      quantidade,
      precoUnitario,
      iva,
      subtotal
    };
    
    console.log('Novo item criado:', novoItem);
    
    setNovaFatura({
      ...novaFatura,
      items: [...novaFatura.items, novoItem]
    });
    
    setItemFatura({
      ingredienteId: '',
      quantidade: '',
      precoUnitario: '',
      iva: '13'
    });
    
    showNotification('Item adicionado √† fatura!', 'success');
  };
  
  const removerItemFatura = (itemId) => {
    setNovaFatura({
      ...novaFatura,
      items: novaFatura.items.filter(item => item.id !== itemId)
    });
  };
  
  const salvarFatura = () => {
    if (!novaFatura.numero || !novaFatura.fornecedorId || novaFatura.items.length === 0) {
      showNotification('Preencha n√∫mero, fornecedor e adicione pelo menos 1 item!', 'error');
      return;
    }
    
    // Verificar se algum item tem pre√ßo muito diferente
    let temAlertaPreco = false;
    for (const item of novaFatura.items) {
      const ingrediente = ingredientes.find(i => i.id == item.ingredienteId);
      if (ingrediente) {
        const precoAtual = ingrediente.custoUnitario;
        const precoNovo = item.precoUnitario;
        const diferenca = Math.abs(precoNovo - precoAtual);
        const diferencaPerc = precoAtual > 0 ? (diferenca / precoAtual) * 100 : 0;
        
        if (diferencaPerc > 5) {
          // Mostrar alerta para o primeiro item com diferen√ßa > 5%
          const produtosAfetados = produtos.filter(p => 
            p.receita && p.receita.some(r => r.ingredienteId == item.ingredienteId)
          ).map(p => {
            const receitaItem = p.receita.find(r => r.ingredienteId == item.ingredienteId);
            const custoAntes = receitaItem.quantidade * precoAtual;
            const custoDepois = receitaItem.quantidade * precoNovo;
            const margemAntes = p.precoVenda - p.receita.reduce((s, r) => {
              const ing = ingredientes.find(i => i.id == r.ingredienteId);
              return s + (r.quantidade * (ing?.custoUnitario || 0));
            }, 0);
            const margemDepois = margemAntes - (custoDepois - custoAntes);
            
            return {
              nome: p.nome,
              margemDif: margemDepois - margemAntes
            };
          });
          
          setPriceAlertData({
            ingrediente,
            precoAtual,
            precoNovo,
            diferencaPerc,
            produtosAfetados,
            faturaData: novaFatura,
            tipoFatura: 'completa'
          });
          setShowPriceAlert(true);
          temAlertaPreco = true;
          return; // N√£o guarda ainda
        }
      }
    }
    
    // Se n√£o tem alerta, guarda normalmente
    if (!temAlertaPreco) {
      salvarFaturaSemAlerta();
    }
  };
  
  const salvarFaturaSemAlerta = (dadosFatura = null) => {
    // Se n√£o recebeu dados, usa novaFatura atual
    const faturaParaGuardar = dadosFatura || novaFatura;
    
    const fornecedor = fornecedores.find(f => (f.id || f) === faturaParaGuardar.fornecedorId);
    
    // Handle both old format (string) and new format (object)
    const fornecedorNome = typeof fornecedor === 'string' ? fornecedor : (fornecedor?.nome || '');
    const fornecedorNif = typeof fornecedor === 'string' ? '' : (fornecedor?.nif || '');
    
    const novaFaturaCompleta = {
      id: Date.now(),
      numero: faturaParaGuardar.numero,
      data: faturaParaGuardar.data,
      fornecedorId: faturaParaGuardar.fornecedorId,
      fornecedorNome: fornecedorNome,
      fornecedorNif: fornecedorNif,
      items: faturaParaGuardar.items,
      notas: faturaParaGuardar.notas,
      subtotal: faturaParaGuardar.items.reduce((sum, item) => sum + item.subtotal, 0),
      totalIva: faturaParaGuardar.items.reduce((sum, item) => sum + (item.subtotal * item.iva / 100), 0),
      total: faturaParaGuardar.items.reduce((sum, item) => sum + (item.subtotal * (1 + item.iva / 100)), 0),
      tipo: 'completa' // Marca que √© fatura completa
    };
    
    setFaturas([...faturas, novaFaturaCompleta]);
    
    // Resetar formul√°rio
    setNovaFatura({
      numero: '',
      data: new Date().toISOString().split('T')[0],
      fornecedorId: '',
      items: [],
      notas: ''
    });
    
    setEditandoFatura(false);
    showNotification('Fatura guardada!', 'success');
  };
  
  const salvarFaturaRapida = () => {
    if (!itemFatura.ingredienteId || !itemFatura.quantidade || !itemFatura.precoUnitario || !novaFatura.fornecedorId) {
      showNotification('Preencha fornecedor, ingrediente, quantidade e pre√ßo!', 'error');
      return;
    }
    
    const ingrediente = ingredientes.find(i => i.id == itemFatura.ingredienteId);
    const quantidade = parseFloat(itemFatura.quantidade);
    const precoUnitario = parseFloat(itemFatura.precoUnitario);
    const precoAtual = ingrediente.custoUnitario;
    const diferenca = Math.abs(precoUnitario - precoAtual);
    const diferencaPerc = precoAtual > 0 ? (diferenca / precoAtual) * 100 : 0;
    
    // Se pre√ßo mudou mais de 5%, mostrar alerta
    if (diferencaPerc > 5) {
      // Encontrar produtos afetados
      const produtosAfetados = produtos.filter(p => 
        p.receita && p.receita.some(r => r.ingredienteId == itemFatura.ingredienteId)
      ).map(p => {
        const receitaItem = p.receita.find(r => r.ingredienteId == itemFatura.ingredienteId);
        const custoAntes = receitaItem.quantidade * precoAtual;
        const custoDepois = receitaItem.quantidade * precoUnitario;
        const margemAntes = p.precoVenda - p.receita.reduce((s, r) => {
          const ing = ingredientes.find(i => i.id == r.ingredienteId);
          return s + (r.quantidade * (ing?.custoUnitario || 0));
        }, 0);
        const margemDepois = margemAntes - (custoDepois - custoAntes);
        
        return {
          nome: p.nome,
          margemDif: margemDepois - margemAntes
        };
      });
      
      setPriceAlertData({
        ingrediente,
        precoAtual,
        precoNovo: precoUnitario,
        diferencaPerc,
        produtosAfetados,
        faturaData: {
          ...novaFatura,
          itemFatura: itemFatura
        },
        tipoFatura: 'rapido'
      });
      setShowPriceAlert(true);
      return; // N√£o guarda ainda, espera decis√£o do utilizador
    }
    
    // Se pre√ßo n√£o mudou muito, guarda normalmente
    salvarFaturaRapidaSemAlerta();
  };
  
  const salvarFaturaRapidaSemAlerta = () => {
    const ingrediente = ingredientes.find(i => i.id == itemFatura.ingredienteId);
    const fornecedor = fornecedores.find(f => (f.id || f) === novaFatura.fornecedorId);
    
    // Handle both old format (string) and new format (object)
    const fornecedorNome = typeof fornecedor === 'string' ? fornecedor : (fornecedor?.nome || '');
    const fornecedorNif = typeof fornecedor === 'string' ? '' : (fornecedor?.nif || '');
    
    const quantidade = parseFloat(itemFatura.quantidade);
    const precoUnitario = parseFloat(itemFatura.precoUnitario);
    const iva = parseFloat(itemFatura.iva);
    const subtotal = quantidade * precoUnitario;
    const totalIva = subtotal * (iva / 100);
    const total = subtotal + totalIva;
    
    // Gerar n√∫mero autom√°tico para registo r√°pido
    const hoje = new Date();
    const ano = hoje.getFullYear();
    const registosRapidosHoje = faturas.filter(f => 
      f.tipo === 'rapido' && 
      f.data === novaFatura.data
    ).length;
    const numeroAuto = `RR/${ano}/${String(registosRapidosHoje + 1).padStart(3, '0')}`;
    
    const item = {
      id: Date.now(),
      ingredienteId: itemFatura.ingredienteId,
      ingredienteNome: ingrediente.nome,
      unidade: ingrediente.unidade,
      quantidade,
      precoUnitario,
      iva,
      subtotal
    };
    
    const faturaRapida = {
      id: Date.now(),
      numero: numeroAuto,
      data: novaFatura.data,
      fornecedorId: novaFatura.fornecedorId,
      fornecedorNome: fornecedorNome,
      fornecedorNif: fornecedorNif,
      items: [item],
      notas: novaFatura.notas || 'Registo r√°pido',
      subtotal,
      totalIva,
      total,
      tipo: 'rapido' // Marca que √© registo r√°pido
    };
    
    setFaturas([...faturas, faturaRapida]);
    
    // Resetar formul√°rio
    setNovaFatura({
      numero: '',
      data: new Date().toISOString().split('T')[0],
      fornecedorId: '',
      items: [],
      notas: ''
    });
    setItemFatura({
      ingredienteId: '',
      quantidade: '',
      precoUnitario: '',
      iva: '13'
    });
    
    showNotification('Compra registada!', 'success');
  };
  
  const apagarFatura = (faturaId) => {
    if (confirm('‚ö†Ô∏è Apagar esta compra?')) {
      setFaturas(faturas.filter(f => f.id !== faturaId));
      showNotification('Compra apagada!', 'success');
    }
  };
  
  const editarFatura = (fatura) => {
    setNovaFatura({
      numero: fatura.numero,
      data: fatura.data,
      fornecedorId: fatura.fornecedorId,
      items: fatura.items,
      notas: fatura.notas
    });
    setEditandoFatura(true);
    setFaturaEditando(fatura.id);
    window.scrollTo({ top: 0, behavior: 'smooth' });
  };
  
  const atualizarFatura = () => {
    console.log('atualizarFatura chamada', { novaFatura, faturaEditando });
    
    if (!novaFatura.numero || !novaFatura.fornecedorId || novaFatura.items.length === 0) {
      showNotification('Preencha n√∫mero, fornecedor e adicione pelo menos 1 item!', 'error');
      return;
    }
    
    // Verificar se algum item tem pre√ßo muito diferente
    let temAlertaPreco = false;
    for (const item of novaFatura.items) {
      const ingrediente = ingredientes.find(i => i.id == item.ingredienteId);
      if (ingrediente) {
        const precoAtual = ingrediente.custoUnitario;
        const precoNovo = item.precoUnitario;
        const diferenca = Math.abs(precoNovo - precoAtual);
        const diferencaPerc = precoAtual > 0 ? (diferenca / precoAtual) * 100 : 0;
        
        if (diferencaPerc > 5) {
          // Mostrar alerta para o primeiro item com diferen√ßa > 5%
          const produtosAfetados = produtos.filter(p => 
            p.receita && p.receita.some(r => r.ingredienteId == item.ingredienteId)
          ).map(p => {
            const receitaItem = p.receita.find(r => r.ingredienteId == item.ingredienteId);
            const custoAntes = receitaItem.quantidade * precoAtual;
            const custoDepois = receitaItem.quantidade * precoNovo;
            const margemAntes = p.precoVenda - p.receita.reduce((s, r) => {
              const ing = ingredientes.find(i => i.id == r.ingredienteId);
              return s + (r.quantidade * (ing?.custoUnitario || 0));
            }, 0);
            const margemDepois = margemAntes - (custoDepois - custoAntes);
            
            return {
              nome: p.nome,
              margemDif: margemDepois - margemAntes
            };
          });
          
          setPriceAlertData({
            ingrediente,
            precoAtual,
            precoNovo,
            diferencaPerc,
            produtosAfetados,
            faturaData: novaFatura,
            faturaEditandoId: faturaEditando, // Guardar ID da fatura em edi√ß√£o
            tipoFatura: 'edicao' // Marcar como edi√ß√£o
          });
          setShowPriceAlert(true);
          temAlertaPreco = true;
          return; // N√£o atualiza ainda
        }
      }
    }
    
    // Se n√£o tem alerta, atualiza normalmente
    if (!temAlertaPreco) {
      atualizarFaturaSemAlerta();
    }
  };
  
  const atualizarFaturaSemAlerta = (dadosFatura = null, faturaId = null) => {
    const faturaParaAtualizar = dadosFatura || novaFatura;
    const idParaAtualizar = faturaId || faturaEditando;
    
    const fornecedor = fornecedores.find(f => (f.id || f) === faturaParaAtualizar.fornecedorId);
    console.log('Fornecedor encontrado:', fornecedor);
    
    // Handle both old format (string) and new format (object)
    const fornecedorNome = typeof fornecedor === 'string' ? fornecedor : (fornecedor?.nome || '');
    const fornecedorNif = typeof fornecedor === 'string' ? '' : (fornecedor?.nif || '');
    
    const faturaAtualizada = {
      id: idParaAtualizar,
      numero: faturaParaAtualizar.numero,
      data: faturaParaAtualizar.data,
      fornecedorId: faturaParaAtualizar.fornecedorId,
      fornecedorNome: fornecedorNome,
      fornecedorNif: fornecedorNif,
      items: faturaParaAtualizar.items,
      notas: faturaParaAtualizar.notas,
      subtotal: faturaParaAtualizar.items.reduce((sum, item) => sum + item.subtotal, 0),
      totalIva: faturaParaAtualizar.items.reduce((sum, item) => sum + (item.subtotal * item.iva / 100), 0),
      total: faturaParaAtualizar.items.reduce((sum, item) => sum + (item.subtotal * (1 + item.iva / 100)), 0),
      tipo: faturas.find(f => f.id === idParaAtualizar)?.tipo || 'completa' // Preservar tipo original
    };
    
    setFaturas(faturas.map(f => f.id === idParaAtualizar ? faturaAtualizada : f));
    
    // Resetar formul√°rio
    setNovaFatura({
      numero: '',
      data: new Date().toISOString().split('T')[0],
      fornecedorId: '',
      items: [],
      notas: ''
    });
    
    setEditandoFatura(false);
    setFaturaEditando(null);
    showNotification('Fatura atualizada!', 'success');
  };
  
  const cancelarEdicaoFatura = () => {
    setNovaFatura({
      numero: '',
      data: new Date().toISOString().split('T')[0],
      fornecedorId: '',
      items: [],
      notas: ''
    });
    setEditandoFatura(false);
    setFaturaEditando(null);
  };
  
  // ========== FUN√á√ïES PARA FORNECEDORES ==========
  
  const adicionarFornecedor = (nome, nif = '', morada = '', email = '', telefone = '') => {
    const novoFornecedor = {
      id: Date.now(),
      nome,
      nif,
      morada,
      email,
      telefone,
      dataCriacao: new Date().toISOString()
    };
    setFornecedores([...fornecedores, novoFornecedor]);
    return novoFornecedor.id;
  };
  
  const atualizarFornecedor = (fornecedorId, dadosAtualizados) => {
    setFornecedores(fornecedores.map(f => 
      f.id === fornecedorId ? { ...f, ...dadosAtualizados } : f
    ));
  };
  
  const apagarFornecedor = (fornecedorId) => {
    // Verificar se h√° faturas com este fornecedor
    const faturasComFornecedor = faturas.filter(f => f.fornecedorId === fornecedorId);
    if (faturasComFornecedor.length > 0) {
      showNotification(`N√£o pode apagar! Existem ${faturasComFornecedor.length} faturas com este fornecedor.`, 'error');
      return;
    }
    
    if (confirm('‚ö†Ô∏è Apagar este fornecedor?')) {
      setFornecedores(fornecedores.filter(f => f.id !== fornecedorId));
      showNotification('Fornecedor apagado!', 'success');
    }
  };

  const processarFicheiro = (e) => {
    const f = e.target.files[0];
    if (!f) return;
    const r = new FileReader();
    r.onload = (ev) => {
      const txt = ev.target.result;
      const lns = txt.split('\n').filter(l => l.trim());
      const vs = [];
      for (let i = 0; i < lns.length; i++) {
        const ln = lns[i];
        if (ln.includes('"') && ln.split(';').length >= 11) {
          const pts = ln.split(';').map(p => p.replace(/"/g, '').trim());
          if (pts[0] && pts[0].match(/\d{2}-\d{2}-\d{4}/)) {
            const [d, m, a] = pts[0].split('-');
            const dt = `${a}-${m}-${d}`;
            const prd = pts[1];
            const qtd = parseFloat(pts[10]?.replace('Uni.', '').replace(',', '.')) || 1;
            const tot = parseFloat(pts[11]?.replace('‚Ç¨', '').replace(',', '.')) || 0;
            if (prd && tot > 0) vs.push({ id: Date.now() + i, data: dt, produto: prd, quantidade: qtd, valor: tot, iva: 6 });
          }
        }
      }
      if (vs.length > 0) { 
        setVendas([...vendas, ...vs]); 
        showNotification(`${vs.length} vendas importadas!`, 'success');
        e.target.value = ''; 
      }
      else showNotification('Erro ao importar', 'error');
    };
    r.readAsText(f);
  };


  const syncToGitHub = React.useCallback(async () => {
    if (!GitHubSync.isConfigured() || isSyncing) return;
    
    setIsSyncing(true);
    setSyncError(null);
    
    try {
      const token = GitHubSync.getToken();
      const data = {
        produtos,
        ingredientes,
        vendas,
        despesas,
        fornecedores,
        dadosEmpresa,
        faturas,
        timestamp: new Date().toISOString()
      };
      
      const result = await GitHubSync.saveToGist(data, token);
      
      if (result.success) {
        setLastSync(new Date());
      } else {
        setSyncError(result.error);
      }
    } catch (error) {
      setSyncError(error.message);
    } finally {
      setIsSyncing(false);
    }
  }, [produtos, ingredientes, vendas, despesas, fornecedores, dadosEmpresa, faturas, isSyncing]);

  const calcCusto = (p) => {
    if (!p.receita || !p.receita.length) return 0;
    return p.receita.reduce((t, it) => {
      const ing = ingredientes.find(i => i.id === it.ingredienteId);
      if (!ing) return t;
      
      let q = it.quantidade;
      const unidadeReceita = it.unidade || ing.unidade;
      
      if (ing.unidade === 'kg' && unidadeReceita === 'g') q = it.quantidade / 1000;
      if (ing.unidade === 'L' && unidadeReceita === 'ml') q = it.quantidade / 1000;
      if (ing.unidade === 'g' && unidadeReceita === 'kg') q = it.quantidade * 1000;
      if (ing.unidade === 'ml' && unidadeReceita === 'L') q = it.quantidade * 1000;
      if (unidadeReceita === ing.unidade) q = it.quantidade;
      
      return t + (q * ing.custoUnitario);
    }, 0);
  };

  const calcMargem = (p) => {
    const c = calcCusto(p);
    const ps = p.precoVenda / (1 + p.iva / 100);
    const m = ps - c;
    const mp = c > 0 ? (m / c) * 100 : 0;
    return { custo: c, margem: m, margemPercentual: mp, precoSemIva: ps };
  };
  
  // Calcular custos e pre√ßos por modalidade (Local, Take-Away, Delivery)
  const calcPrecosPorModalidade = (produto) => {
    const custoIngredientes = calcCusto(produto);
    const ivaPerc = produto.iva || 6; // Default 6% se n√£o definido
    
    // Custo embalagens (ingredientes com categoria "embalagens")
    const custoEmbalagens = (produto.receita || []).reduce((sum, item) => {
      const ing = ingredientes.find(i => i.id == item.ingredienteId);
      if (ing && ing.categoria === 'embalagens') {
        return sum + (ing.custoUnitario * (item.quantidade || 1));
      }
      return sum;
    }, 0);
    
    const precoLocal = produto.precoVenda || 0;
    const custoLocal = custoIngredientes - custoEmbalagens; // Custo sem embalagens
    const margemLocal = precoLocal / (1 + ivaPerc / 100) - custoLocal;
    
    const custoTakeAway = custoIngredientes; // J√° inclui embalagens
    const precoTakeAway = produto.precoVenda; // Usar pre√ßo do produto
    const margemTakeAway = precoTakeAway / (1 + ivaPerc / 100) - custoTakeAway;
    
    const resultados = {
      local: {
        custo: custoLocal,
        preco: precoLocal,
        margem: margemLocal,
        margemPerc: custoLocal > 0 ? (margemLocal / custoLocal) * 100 : 0
      },
      takeaway: {
        custo: custoTakeAway,
        custoEmbalagens,
        preco: precoTakeAway,
        margem: margemTakeAway,
        margemPerc: custoTakeAway > 0 ? (margemTakeAway / custoTakeAway) * 100 : 0
      },
      delivery: {}
    };
    
    // Calcular para cada app ativa
    deliveryApps.filter(app => app.ativo).forEach(app => {
      const precoDelivery = produto.precosDelivery?.[app.id] || precoTakeAway / (1 - app.comissao / 100);
      const receitaLiquida = precoDelivery * (1 - app.comissao / 100);
      const margemDelivery = receitaLiquida / (1 + ivaPerc / 100) - custoTakeAway;
      
      resultados.delivery[app.id] = {
        custo: custoTakeAway,
        precoSugerido: precoDelivery,
        precoDefinido: produto.precosDelivery?.[app.id] || null,
        comissao: app.comissao,
        receitaLiquida,
        margem: margemDelivery,
        margemPerc: custoTakeAway > 0 ? (margemDelivery / custoTakeAway) * 100 : 0
      };
    });
    
    return resultados;
  };

  const calcLucroVenda = (v) => {
    const p = produtos.find(pr => pr.nome.toLowerCase() === v.produto.toLowerCase());
    if (!p) return { lucro: 0, temCusto: false };
    const custo = calcCusto(p);
    const precoSemIva = v.valor / (1 + (v.iva / 100));
    const custoTotal = custo * v.quantidade;
    const lucro = precoSemIva - custoTotal;
    return { lucro: lucro, temCusto: true };
  };


  // Filter data by date
  const getFilteredData = (data, dateField = 'data') => {
    const now = new Date();
    const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
    
    return data.filter(item => {
      const itemDate = new Date(item[dateField]);
      
      switch(dateFilter) {
        case 'today':
          return itemDate >= today;
        case 'week':
          const weekAgo = new Date(today);
          weekAgo.setDate(weekAgo.getDate() - 7);
          return itemDate >= weekAgo;
        case 'month':
          const monthAgo = new Date(today);
          monthAgo.setMonth(monthAgo.getMonth() - 1);
          return itemDate >= monthAgo;
        case 'custom':
          if (customStartDate && customEndDate) {
            const start = new Date(customStartDate);
            const end = new Date(customEndDate);
            end.setHours(23, 59, 59);
            return itemDate >= start && itemDate <= end;
          }
          return true;
        default:
          return true;
      }
    });
  };

  // Apply filters to data
  const filteredVendas = getFilteredData(vendas);
  const filteredDespesas = getFilteredData(despesas);
  const filteredFaturas = getFilteredData(faturas);

  const totV = filteredVendas.reduce((s, v) => s + v.valor, 0);
  const totD = filteredDespesas.reduce((s, d) => s + d.valor, 0);
  
  // IVA Vendas (a receber do estado)
  const ivaV = filteredVendas.reduce((s, v) => s + (v.valor * v.iva / (100 + v.iva)), 0);
  
  // IVA Compras (das faturas - a deduzir)
  const ivaCompras = filteredFaturas.reduce((s, f) => s + (f.totalIva || 0), 0);
  
  // IVA a Pagar = IVA Vendas - IVA Compras
  const ivaP = ivaV - ivaCompras;
  
  const ratioDespesaFaturacao = totV > 0 ? (totD / totV) * 100 : 0;

  let lucroReal = 0;
  let vComC = 0;
  vendas.forEach(v => { 
    const { lucro, temCusto } = calcLucroVenda(v); 
    lucroReal += lucro; 
    if (temCusto) vComC++; 
  });

  const vPorDia = {};
  vendas.forEach(v => {
    if (!vPorDia[v.data]) vPorDia[v.data] = { total: 0, lucro: 0, qtd: 0 };
    vPorDia[v.data].total += v.valor;
    vPorDia[v.data].qtd += v.quantidade;
    vPorDia[v.data].lucro += calcLucroVenda(v).lucro;
  });

  const dias = Object.keys(vPorDia).length;
  const medFat = dias > 0 ? totV / dias : 0;
  const medLuc = dias > 0 ? lucroReal / dias : 0;

  const dFixas = despesas.filter(d => ['renda', 'utilities', 'salarios'].includes(d.categoria)).reduce((s, d) => s + d.valor, 0);
  const dFixDia = dFixas / 30;
  
  // Calculate total salaries considering payment frequency (normalize to monthly)
  const totalSalarios = filteredDespesas.filter(d => d.categoria === 'salarios').reduce((s, d) => {
    const multiplicador = d.frequencia_pagamento === 'semanal' ? 4 :
                         d.frequencia_pagamento === 'quinzenal' ? 2 : 1;
    return s + (d.valor * multiplicador);
  }, 0);
  const laborCostPercentage = totV > 0 ? (totalSalarios / totV) * 100 : 0;

  // New metrics calculations
  const totalFoodCost = filteredDespesas.filter(d => d.categoria === 'compras').reduce((s, d) => s + d.valor, 0);
  const foodCostPercentage = totV > 0 ? (totalFoodCost / totV) * 100 : 0;
  const primeCostPercentage = foodCostPercentage + laborCostPercentage;
  const primeCostTotal = totalFoodCost + totalSalarios;
  
  // Break-even calculation: Fixed costs / (1 - (Variable costs / Revenue))
  const fixedCosts = filteredDespesas.filter(d => ['renda', 'utilities', 'salarios'].includes(d.categoria)).reduce((s, d) => s + d.valor, 0);
  const variableCosts = filteredDespesas.filter(d => ['compras', 'consumiveis'].includes(d.categoria)).reduce((s, d) => s + d.valor, 0);
  const contributionMarginRatio = totV > 0 ? (totV - variableCosts) / totV : 0;
  const breakEvenPoint = contributionMarginRatio > 0 ? fixedCosts / contributionMarginRatio : 0;
  
  // Break-even DI√ÅRIO (26 dias √∫teis)
  const diasUteis = 26;
  const fixedCostsDiarios = fixedCosts / diasUteis;
  const ticketMedio = filteredVendas.length > 0 ? totV / filteredVendas.length : 0;
  const foodCostPorVenda = filteredVendas.length > 0 ? totalFoodCost / filteredVendas.length : 0;
  const margemPorVenda = ticketMedio - foodCostPorVenda;
  const vendasNecessariasPorDia = margemPorVenda > 0 ? fixedCostsDiarios / margemPorVenda : 0;
  const breakEvenDiario = vendasNecessariasPorDia * ticketMedio;
  
  // Efficiency per employee (count unique employees considering frequency)
  const numEmployees = filteredDespesas
    .filter(d => d.categoria === 'salarios')
    .reduce((sum, d) => sum + (d.num_funcionarios || 1), 0) || 1;
  
  const revenuePerEmployee = numEmployees > 0 ? totV / numEmployees : 0;
  const salesPerEmployee = numEmployees > 0 ? filteredVendas.length / numEmployees : 0;


  const vPorProd = {};
  vendas.forEach(v => {
    if (!vPorProd[v.produto]) vPorProd[v.produto] = { quantidade: 0, total: 0, lucro: 0 };
    vPorProd[v.produto].quantidade += v.quantidade;
    vPorProd[v.produto].total += v.valor;
    vPorProd[v.produto].lucro += calcLucroVenda(v).lucro;
  });

  const top5Venda = Object.entries(vPorProd).sort((a, b) => b[1].quantidade - a[1].quantidade).slice(0, 5);
  const top5Lucro = Object.entries(vPorProd).sort((a, b) => b[1].lucro - a[1].lucro).slice(0, 5);
  const pior5Venda = Object.entries(vPorProd).sort((a, b) => a[1].quantidade - b[1].quantidade).slice(0, 5);
  const pior5Lucro = Object.entries(vPorProd).sort((a, b) => a[1].lucro - b[1].lucro).slice(0, 5);

  const dadosPorMes = {};
  
  vendas.forEach(v => {
    const mes = v.data.substring(0, 7);
    if (!dadosPorMes[mes]) {
      dadosPorMes[mes] = { 
        faturacao: 0, 
        lucro: 0, 
        despesas: 0,
        salarios: 0,
        vendas: 0,
        ivaVendas: 0,
        ivaCompras: 0
      };
    }
    dadosPorMes[mes].faturacao += v.valor;
    dadosPorMes[mes].lucro += calcLucroVenda(v).lucro;
    dadosPorMes[mes].vendas += 1;
    dadosPorMes[mes].ivaVendas += (v.valor * v.iva / (100 + v.iva));
  });

  despesas.forEach(d => {
    const mes = d.data.substring(0, 7);
    if (!dadosPorMes[mes]) {
      dadosPorMes[mes] = { 
        faturacao: 0, 
        lucro: 0, 
        despesas: 0,
        salarios: 0,
        vendas: 0,
        ivaVendas: 0,
        ivaCompras: 0
      };
    }
    dadosPorMes[mes].despesas += d.valor;
    if (d.categoria === 'salarios') {
      dadosPorMes[mes].salarios += d.valor;
    }
  });
  
  // IVA Compras das faturas por m√™s
  faturas.forEach(f => {
    const mes = f.data.substring(0, 7);
    if (!dadosPorMes[mes]) {
      dadosPorMes[mes] = { 
        faturacao: 0, 
        lucro: 0, 
        despesas: 0,
        salarios: 0,
        vendas: 0,
        ivaVendas: 0,
        ivaCompras: 0
      };
    }
    dadosPorMes[mes].ivaCompras += (f.totalIva || 0);
  });

  Object.keys(dadosPorMes).forEach(mes => {
    const dados = dadosPorMes[mes];
    
    // Calculate actual food costs for this month
    let custoAlimentosMes = 0;
    vendas.filter(v => v.data.startsWith(mes)).forEach(v => {
      const p = produtos.find(pr => pr.nome.toLowerCase() === v.produto.toLowerCase());
      if (p) {
        custoAlimentosMes += calcCusto(p) * v.quantidade;
      }
    });
    
    dados.foodCostPct = dados.faturacao > 0 ? ((custoAlimentosMes / dados.faturacao) * 100) : 0;
    dados.laborCostPct = dados.faturacao > 0 ? ((dados.salarios / dados.faturacao) * 100) : 0;
  });

  const mesesOrdenados = Object.keys(dadosPorMes).sort();
  const ultimos6Meses = mesesOrdenados.slice(-6);

  const tabs = [
    { id: 'dashboard', label: 'Dashboard', icon: BarChart3 },
    { id: 'gestao', label: 'Gest√£o', icon: FileText },
    { id: 'definicoes', label: 'Defini√ß√µes', icon: Settings }
  ];

  return (
    <div className={`min-h-screen p-2 transition-colors bg-gray-50`}>
      {/* Notification */}
      {notification && (
        <div className={`fixed top-2 right-2 z-50 flex items-center gap-2 px-4 py-2 rounded-lg shadow-lg text-sm ${
          notification.type === 'success' ? 'bg-green-500 text-white' : 
          notification.type === 'error' ? 'bg-red-500 text-white' : 'bg-blue-500 text-white'
        }`}>
          {notification.type === 'success' && <Check size={16} />}
          {notification.type === 'error' && <X size={16} />}
          <span>{notification.message}</span>
        </div>
      )}

      {/* Price Change Alert Modal */}
      {showPriceAlert && priceAlertData && (
        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
          <div className="bg-white rounded-lg shadow-2xl max-w-md w-full">
            <div className="bg-orange-500 text-white px-4 py-3 rounded-t-lg flex items-center justify-between">
              <h3 className="font-bold text-lg flex items-center gap-2">
                <AlertCircle size={20} />
                Preco Diferente do Registado
              </h3>
              <button
                onClick={() => {
                  console.log('Fechar modal');
                  setShowPriceAlert(false);
                  setPriceAlertData(null);
                }}
                className="hover:bg-orange-600 rounded p-1 transition"
              >
                <X size={20} />
              </button>
            </div>
            
            <div className="p-4 space-y-3">
              <div className="bg-orange-50 border border-orange-200 rounded p-3">
                <p className="text-sm font-bold text-orange-900 mb-2">{priceAlertData.ingrediente.nome}:</p>
                <div className="flex justify-between items-center text-sm mb-1">
                  <span className="text-gray-700">Pre√ßo atual:</span>
                  <span className="font-semibold">‚Ç¨{priceAlertData.precoAtual.toFixed(2)}/{priceAlertData.ingrediente.unidade}</span>
                </div>
                <div className="flex justify-between items-center text-sm mb-1">
                  <span className="text-gray-700">Pre√ßo novo:</span>
                  <span className="font-bold text-orange-600">‚Ç¨{priceAlertData.precoNovo.toFixed(2)}/{priceAlertData.ingrediente.unidade}</span>
                </div>
                <div className="flex justify-between items-center text-sm">
                  <span className="text-gray-700">Diferen√ßa:</span>
                  <span className={`font-bold ${priceAlertData.precoNovo > priceAlertData.precoAtual ? 'text-red-600' : 'text-green-600'}`}>
                    {priceAlertData.precoNovo > priceAlertData.precoAtual ? '+' : ''}{priceAlertData.diferencaPerc.toFixed(1)}%
                  </span>
                </div>
              </div>
              
              {priceAlertData.produtosAfetados.length > 0 && (
                <div className="bg-blue-50 border border-blue-200 rounded p-3">
                  <p className="text-xs font-semibold text-blue-900 mb-2">
                    üçΩÔ∏è {priceAlertData.produtosAfetados.length} produtos afetados:
                  </p>
                  <div className="space-y-1 max-h-32 overflow-y-auto">
                    {priceAlertData.produtosAfetados.slice(0, 5).map((p, idx) => (
                      <div key={idx} className="flex justify-between items-center text-xs bg-white rounded px-2 py-1">
                        <span className="text-gray-700">{p.nome}</span>
                        <span className={`font-semibold ${p.margemDif < 0 ? 'text-red-600' : 'text-green-600'}`}>
                          margem {p.margemDif < 0 ? '‚Üì' : '‚Üë'} ‚Ç¨{Math.abs(p.margemDif).toFixed(2)}
                        </span>
                      </div>
                    ))}
                    {priceAlertData.produtosAfetados.length > 5 && (
                      <p className="text-xs text-gray-500 text-center">+ {priceAlertData.produtosAfetados.length - 5} mais...</p>
                    )}
                  </div>
                </div>
              )}
              
              <p className="text-xs text-gray-600">
                üí° Atualizar o custo base vai recalcular automaticamente as margens de todos os produtos.
              </p>
            </div>
            
            <div className="flex gap-2 px-4 pb-4">
              <button
                onClick={() => {
                  console.log('Bot√£o Ignorar clicado', priceAlertData);
                  if (priceAlertData.tipoFatura) {
                    confirmarFaturaSemAtualizar();
                  } else {
                    confirmarDespesaSemAtualizar();
                  }
                }}
                className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-800 rounded px-4 py-2 text-sm font-semibold transition"
              >
                Ignorar
              </button>
              <button
                onClick={() => {
                  console.log('Bot√£o Atualizar clicado', priceAlertData);
                  if (priceAlertData.tipoFatura) {
                    confirmarFaturaEAtualizar();
                  } else {
                    confirmarDespesaEAtualizar();
                  }
                }}
                className="flex-1 bg-orange-500 hover:bg-orange-600 text-white rounded px-4 py-2 text-sm font-semibold transition"
              >
                Atualizar Custo Base
              </button>
            </div>
          </div>
        </div>
      )}

      <div className="max-w-[1600px] mx-auto">
        {/* Header */}
        <div className="bg-gradient-to-r from-blue-600 to-indigo-600 rounded-lg shadow p-4 mb-3 text-white">
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-3">
              <div className="bg-white/20 rounded-lg p-2 backdrop-blur-sm">
                <span className="text-2xl">üçΩÔ∏è</span>
              </div>
              <div>
                <h1 className="text-2xl font-bold tracking-tight">AI Munchi Manager</h1>
                <p className="text-blue-100 text-sm">Controla custos, margens e rentabilidade do teu restaurante em tempo real</p>
              </div>
            </div>
            
            {/* GitHub Sync Status - Header */}
            <div className="flex items-center gap-3">
              {GitHubSync.isConfigured() ? (
                <>
                  <div className="text-right hidden sm:block">
                    <div className="flex items-center gap-1 text-xs text-green-200">
                      <CloudCheck className="w-3 h-3" />
                      <span>Conectado</span>
                    </div>
                    <div className="text-xs text-blue-100">
                      {(() => {
                        const lastSync = GitHubSync.getLastSync();
                        if (!lastSync) return 'Nunca';
                        const now = new Date();
                        const seconds = Math.floor((now - lastSync) / 1000);
                        if (seconds < 60) return 'Agora';
                        const minutes = Math.floor(seconds / 60);
                        if (minutes < 60) return `H√° ${minutes}m`;
                        const hours = Math.floor(minutes / 60);
                        return `H√° ${hours}h`;
                      })()}
                    </div>
                  </div>
                  <button
                    onClick={async () => {
                      setIsSyncing(true);
                      const token = GitHubSync.getToken();
                      const allData = {
                        produtos,
                        ingredientes,
                        vendas,
                        despesas,
                        faturas,
                        fornecedores,
                        deliveryApps,
                        embalagens,
                        dadosEmpresa,
                        version: '2.0'
                      };
                      const result = await GitHubSync.saveToGist(allData, token);
                      if (result.success) {
                        showNotification('‚úÖ Backup sincronizado!', 'success');
                      } else {
                        showNotification(`‚ùå Erro: ${result.error}`, 'error');
                      }
                      setIsSyncing(false);
                    }}
                    disabled={isSyncing}
                    className="bg-white/20 hover:bg-white/30 disabled:bg-white/10 backdrop-blur-sm text-white px-4 py-2 rounded-lg font-semibold transition flex items-center gap-2 text-sm"
                    title="Sincronizar backup agora"
                  >
                    <RefreshCw className={`w-4 h-4 ${isSyncing ? 'animate-spin' : ''}`} />
                    <span className="hidden sm:inline">{isSyncing ? 'A sincronizar...' : 'Sync'}</span>
                  </button>
                </>
              ) : (
                <button
                  onClick={() => setActiveTab('definicoes')}
                  className="bg-yellow-500/90 hover:bg-yellow-600 backdrop-blur-sm text-white px-4 py-2 rounded-lg font-semibold transition flex items-center gap-2 text-sm"
                  title="Configurar backup"
                >
                  <AlertCircle className="w-4 h-4" />
                  <span className="hidden sm:inline">Configurar Backup</span>
                </button>
              )}
            </div>
          </div>
        </div>

        {/* Main Tabs */}
        <div className={`rounded-lg shadow mb-3 bg-white`}>
          <div className="flex">
            {tabs.map(t => {
              const Icon = t.icon;
              return (
                <button key={t.id} onClick={() => setActiveTab(t.id)}
                  className={`flex items-center gap-2 px-6 py-3 font-medium border-b-2 transition text-sm ${
                    activeTab === t.id ? 'border-blue-600 text-blue-600 bg-blue-50' : 'border-transparent text-gray-600 hover:bg-gray-50'
                  }`}>
                  <Icon size={16} />{t.label}
                </button>
              );
            })}
          </div>
        </div>

        {activeTab === 'dashboard' && (
          <div className="space-y-3">
            {/* Dashboard Sub-tabs */}
            <div className="bg-white rounded-lg shadow">
              <div className="flex border-b overflow-x-auto">
                {[
                  { id: 'resumo', label: 'Resumo', icon: BarChart3 },
                  { id: 'metricas', label: 'M√©tricas', icon: Target },
                  { id: 'compras', label: 'Compras', icon: TrendingUp },
                  ...(deliveryApps.some(app => app.ativo) ? [{ id: 'delivery', label: 'Delivery', icon: TrendingUp }] : []),
                  { id: 'simuladores', label: 'Simuladores', icon: Calculator }
                ].map(tab => {
                  const Icon = tab.icon;
                  return (
                    <button key={tab.id} onClick={() => setDashboardSubTab(tab.id)}
                      className={`flex items-center gap-2 px-4 py-2 font-medium text-xs transition ${
                        dashboardSubTab === tab.id ? 'bg-blue-500 text-white' : 'text-gray-600 hover:bg-blue-50'
                      }`}>
                      <Icon size={14} />{tab.label}
                    </button>
                  );
                })}
              </div>
            </div>

            

            {dashboardSubTab === 'resumo' && (
              <>
            {/* Date Filter */}
            <div className="bg-white rounded-lg shadow p-3">
              <div className="flex flex-wrap items-center gap-2">
                <span className="text-xs font-semibold text-gray-700">Per√≠odo:</span>
                <button
                  onClick={() => setDateFilter('all')}
                  className={`px-3 py-1 rounded text-xs font-medium transition ${
                    dateFilter === 'all' ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                  }`}
                >
                  Tudo
                </button>
                <button
                  onClick={() => setDateFilter('today')}
                  className={`px-3 py-1 rounded text-xs font-medium transition ${
                    dateFilter === 'today' ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                  }`}
                >
                  Hoje
                </button>
                <button
                  onClick={() => setDateFilter('week')}
                  className={`px-3 py-1 rounded text-xs font-medium transition ${
                    dateFilter === 'week' ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                  }`}
                >
                  √öltima Semana
                </button>
                <button
                  onClick={() => setDateFilter('month')}
                  className={`px-3 py-1 rounded text-xs font-medium transition ${
                    dateFilter === 'month' ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                  }`}
                >
                  √öltimo M√™s
                </button>
                <button
                  onClick={() => setDateFilter('custom')}
                  className={`px-3 py-1 rounded text-xs font-medium transition ${
                    dateFilter === 'custom' ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                  }`}
                >
                  Personalizado
                </button>
                
                {dateFilter === 'custom' && (
                  <div className="flex items-center gap-2 ml-2">
                    <input
                      type="date"
                      value={customStartDate}
                      onChange={(e) => setCustomStartDate(e.target.value)}
                      className="border rounded px-2 py-1 text-xs"
                    />
                    <span className="text-xs text-gray-500">at√©</span>
                    <input
                      type="date"
                      value={customEndDate}
                      onChange={(e) => setCustomEndDate(e.target.value)}
                      className="border rounded px-2 py-1 text-xs"
                    />
                  </div>
                )}
                
                {dateFilter !== 'all' && (
                  <span className="text-xs text-gray-500 ml-2">
                    üìä {filteredVendas.length} vendas ‚Ä¢ {filteredDespesas.length} despesas
                  </span>
                )}
              </div>
            </div>

            {/* KPI Cards - 2 filas de 2 */}
            <div className="grid grid-cols-2 lg:grid-cols-4 gap-2">
              <div className="bg-gradient-to-br from-green-500 to-emerald-600 rounded-lg shadow p-3 text-white">
                <p className="text-green-100 text-xs mb-1">Fatura√ß√£o</p>
                <p className="text-xl font-bold">‚Ç¨{totV.toFixed(2)}</p>
                <p className="text-green-100 text-xs">‚Ç¨{medFat.toFixed(2)}/dia</p>
              </div>

              <div className="bg-gradient-to-br from-red-500 to-pink-600 rounded-lg shadow p-3 text-white">
                <p className="text-red-100 text-xs mb-1">Despesas</p>
                <p className="text-xl font-bold">‚Ç¨{totD.toFixed(2)}</p>
                <p className="text-red-100 text-xs">Fixas: ‚Ç¨{dFixas.toFixed(2)}</p>
              </div>

              <div className="bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg shadow p-3 text-white">
                <p className="text-blue-100 text-xs mb-1">Lucro Real</p>
                <p className="text-xl font-bold">‚Ç¨{lucroReal.toFixed(2)}</p>
                <p className="text-blue-100 text-xs">Com custos</p>
              </div>

              <div className="bg-gradient-to-br from-orange-500 to-amber-600 rounded-lg shadow p-3 text-white">
                <p className="text-orange-100 text-xs mb-1">IVA {ivaP >= 0 ? 'Pagar' : 'Receber'}</p>
                <p className="text-xl font-bold">‚Ç¨{Math.abs(ivaP).toFixed(2)}</p>
                <p className="text-orange-100 text-xs">{ivaP >= 0 ? 'Entregar' : 'Cr√©dito'}</p>
              </div>
            </div>

            {/* Todos os produtos e an√°lises em colunas lado a lado */}
            <div className="grid grid-cols-5 gap-2 overflow-x-auto">
              {/* IVA Limit */}
              <div className="bg-white rounded-lg shadow p-3 min-w-[180px]">
                <div className="flex justify-between items-center mb-2">
                  <h3 className="text-xs font-bold">Limite IVA</h3>
                  <span className={`px-1.5 py-0.5 rounded text-xs font-bold ${
                    totV >= 15000 ? 'bg-red-100 text-red-700' : 'bg-blue-100 text-blue-700'
                  }`}>
                    {((totV / 15000) * 100).toFixed(0)}%
                  </span>
                </div>
                <div className="w-full bg-gray-200 rounded-full h-2 mb-2">
                  <div className={`h-2 rounded-full ${totV >= 15000 ? 'bg-red-500' : 'bg-blue-500'}`} 
                    style={{ width: `${Math.min((totV / 15000) * 100, 100)}%` }}></div>
                </div>
                <p className="text-xs text-gray-600 mb-1">‚Ç¨{totV.toFixed(0)}</p>
                <p className="text-xs text-gray-500">de ‚Ç¨15.000</p>
              </div>

              {/* Top Vendidos */}
              <div className="bg-white rounded-lg shadow p-3 min-w-[180px]">
                <h3 className="font-bold mb-2 text-xs text-blue-600">üèÜ Top Vendidos</h3>
                <div className="space-y-1">
                  {top5Venda.slice(0, 5).map(([n, d], i) => (
                    <div key={n} className="flex items-center gap-1 text-xs">
                      <span className="font-bold text-blue-600 w-4">#{i+1}</span>
                      <span className="flex-1 truncate text-gray-700">{n}</span>
                      <span className="text-green-600 font-semibold text-xs">‚Ç¨{d.lucro.toFixed(0)}</span>
                    </div>
                  ))}
                  {top5Venda.length === 0 && <p className="text-center text-gray-400 py-2 text-xs">Sem vendas</p>}
                </div>
              </div>
              
              {/* Top Rent√°veis */}
              <div className="bg-white rounded-lg shadow p-3 min-w-[180px]">
                <h3 className="font-bold mb-2 text-xs text-green-600">üíé Top Rent√°veis</h3>
                <div className="space-y-1">
                  {top5Lucro.slice(0, 5).map(([n, d], i) => (
                    <div key={n} className="flex items-center gap-1 text-xs">
                      <span className="font-bold text-green-600 w-4">#{i+1}</span>
                      <span className="flex-1 truncate text-gray-700">{n}</span>
                      <span className="text-green-700 font-semibold text-xs">‚Ç¨{d.lucro.toFixed(0)}</span>
                    </div>
                  ))}
                  {top5Lucro.length === 0 && <p className="text-center text-gray-400 py-2 text-xs">Sem vendas</p>}
                </div>
              </div>

              {/* Pior Vendidos */}
              <div className="bg-white rounded-lg shadow p-3 min-w-[180px]">
                <h3 className="font-bold mb-2 text-xs text-red-600">üìâ Pior Vendidos</h3>
                <div className="space-y-1">
                  {pior5Venda.slice(0, 5).map(([n, d], i) => (
                    <div key={n} className="flex items-center gap-1 text-xs">
                      <span className="font-bold text-red-400 w-4">#{i+1}</span>
                      <span className="flex-1 truncate text-gray-700">{n}</span>
                      <span className="text-red-600 font-semibold text-xs">‚Ç¨{d.lucro.toFixed(0)}</span>
                    </div>
                  ))}
                  {pior5Venda.length === 0 && <p className="text-center text-gray-400 py-2 text-xs">Sem vendas</p>}
                </div>
              </div>

              {/* Pior Rent√°veis */}
              <div className="bg-white rounded-lg shadow p-3 min-w-[180px]">
                <h3 className="font-bold mb-2 text-xs text-orange-600">‚ö†Ô∏è Pior Rent√°veis</h3>
                <div className="space-y-1">
                  {pior5Lucro.slice(0, 5).map(([n, d], i) => (
                    <div key={n} className="flex items-center gap-1 text-xs">
                      <span className="font-bold text-orange-400 w-4">#{i+1}</span>
                      <span className="flex-1 truncate text-gray-700">{n}</span>
                      <span className="text-orange-700 font-semibold text-xs">‚Ç¨{d.lucro.toFixed(0)}</span>
                    </div>
                  ))}
                  {pior5Lucro.length === 0 && <p className="text-center text-gray-400 py-2 text-xs">Sem vendas</p>}
                </div>
              </div>
            </div>

            {/* An√°lise Financeira */}
            {totV > 0 && (
              <div className="bg-white rounded-lg shadow p-3">
                <h3 className="text-sm font-bold mb-2">üí° An√°lise Contabilidade</h3>
                <div className="flex justify-between items-center mb-2">
                  <span className="text-xs font-medium">Despesas vs Fatura√ß√£o</span>
                  <span className="text-lg font-bold text-blue-600">{ratioDespesaFaturacao.toFixed(1)}%</span>
                </div>
                <div className="w-full bg-gray-200 rounded-full h-3 mb-1">
                  <div className={`h-3 rounded-full ${
                    ratioDespesaFaturacao >= 40 ? 'bg-red-500' : 
                    ratioDespesaFaturacao >= 30 ? 'bg-orange-500' : 
                    ratioDespesaFaturacao >= 20 ? 'bg-yellow-500' : 'bg-green-500'
                  }`} style={{ width: `${Math.min(ratioDespesaFaturacao, 100)}%` }}></div>
                </div>
                <div className="flex justify-between text-xs text-gray-500">
                  <span>0%</span><span>20%</span><span>30%</span><span>40%</span>
                </div>
                <div className={`mt-2 rounded p-2 text-xs ${
                  ratioDespesaFaturacao >= 40 ? 'bg-red-50 text-red-700' :
                  ratioDespesaFaturacao >= 30 ? 'bg-orange-50 text-orange-700' :
                  ratioDespesaFaturacao >= 20 ? 'bg-yellow-50 text-yellow-700' : 'bg-green-50 text-green-700'
                }`}>
                  <p className="font-bold">
                    {ratioDespesaFaturacao >= 40 ? 'üö® Passar Contab. Organizada!' :
                     ratioDespesaFaturacao >= 30 ? '‚ö†Ô∏è Pr√≥ximo limite!' :
                     ratioDespesaFaturacao >= 20 ? '‚ö° Monitorize!' : '‚úÖ Normal'}
                  </p>
                  {ratioDespesaFaturacao >= 30 && <p className="mt-1">IVA recuper√°vel: ‚Ç¨{ivaCompras.toFixed(2)}</p>}
                </div>
              </div>
            )}



              </>
            )}


            {dashboardSubTab === 'metricas' && (
              <>
              {/* Date Filter */}
              <div className="bg-white rounded-lg shadow p-3">
                <div className="flex flex-wrap items-center gap-2">
                  <span className="text-xs font-semibold text-gray-700">Per√≠odo:</span>
                  <button
                    onClick={() => setDateFilter('all')}
                    className={`px-3 py-1 rounded text-xs font-medium transition ${
                      dateFilter === 'all' ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                    }`}
                  >
                    Tudo
                  </button>
                  <button
                    onClick={() => setDateFilter('today')}
                    className={`px-3 py-1 rounded text-xs font-medium transition ${
                      dateFilter === 'today' ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                    }`}
                  >
                    Hoje
                  </button>
                  <button
                    onClick={() => setDateFilter('week')}
                    className={`px-3 py-1 rounded text-xs font-medium transition ${
                      dateFilter === 'week' ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                    }`}
                  >
                    √öltima Semana
                  </button>
                  <button
                    onClick={() => setDateFilter('month')}
                    className={`px-3 py-1 rounded text-xs font-medium transition ${
                      dateFilter === 'month' ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                    }`}
                  >
                    √öltimo M√™s
                  </button>
                  <button
                    onClick={() => setDateFilter('custom')}
                    className={`px-3 py-1 rounded text-xs font-medium transition ${
                      dateFilter === 'custom' ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                    }`}
                  >
                    Personalizado
                  </button>
                  
                  {dateFilter === 'custom' && (
                    <div className="flex items-center gap-2 ml-2">
                      <input
                        type="date"
                        value={customStartDate}
                        onChange={(e) => setCustomStartDate(e.target.value)}
                        className="border rounded px-2 py-1 text-xs"
                      />
                      <span className="text-xs text-gray-500">at√©</span>
                      <input
                        type="date"
                        value={customEndDate}
                        onChange={(e) => setCustomEndDate(e.target.value)}
                        className="border rounded px-2 py-1 text-xs"
                      />
                    </div>
                  )}
                  
                  {dateFilter !== 'all' && (
                    <span className="text-xs text-gray-500 ml-2">
                      ({filteredVendas.length} vendas ‚Ä¢ ‚Ç¨{totV.toFixed(2)})
                    </span>
                  )}
                </div>
              </div>

              {/* ============================================ */}
              {/* SECTION 1: KPIs PRINCIPAIS */}
              {/* ============================================ */}
              <div className="bg-white rounded-lg shadow p-4 mb-3">
                <h2 className="text-xl font-bold mb-3 flex items-center gap-2">
                  üìä KPIs Principais
                </h2>
                <p className="text-xs text-gray-600 mb-3">Indicadores chave de performance do restaurante</p>
                
                <div className="grid grid-cols-2 lg:grid-cols-4 gap-3">
                  {/* Ticket M√©dio */}
                  <div className="bg-blue-50 rounded-lg p-4 border-l-4 border-blue-500">
                    <p className="text-xs text-blue-700 mb-1 font-semibold">üí∂ Ticket M√©dio</p>
                    <p className="text-2xl font-bold text-blue-900">
                      ‚Ç¨{filteredVendas.length > 0 ? (totV / filteredVendas.length).toFixed(2) : '0.00'}
                    </p>
                    <p className="text-xs text-blue-600 mt-1">Por venda</p>
                  </div>
                  
                  {/* Food Cost % */}
                  <div className="bg-purple-50 rounded-lg p-4 border-l-4 border-purple-500">
                    <p className="text-xs text-purple-700 mb-1 font-semibold">üçΩÔ∏è Food Cost %</p>
                    <p className={`text-2xl font-bold ${
                      foodCostPercentage > 40 ? 'text-red-700' :
                      foodCostPercentage > 35 ? 'text-orange-700' : 'text-purple-900'
                    }`}>
                      {foodCostPercentage.toFixed(1)}%
                    </p>
                    <p className="text-xs text-purple-600 mt-1">Ideal: 25-35%</p>
                  </div>
                  
                  {/* Labor Cost % */}
                  <div className="bg-orange-50 rounded-lg p-4 border-l-4 border-orange-500">
                    <p className="text-xs text-orange-700 mb-1 font-semibold">üë• Labor Cost %</p>
                    <p className={`text-2xl font-bold ${
                      laborCostPercentage > 35 ? 'text-red-700' : 
                      laborCostPercentage > 30 ? 'text-orange-700' : 'text-orange-900'
                    }`}>
                      {laborCostPercentage.toFixed(1)}%
                    </p>
                    <p className="text-xs text-orange-600 mt-1">Ideal: 25-30%</p>
                  </div>
                  
                  {/* Prime Cost % - THE KING */}
                  <div className="bg-gradient-to-br from-red-50 to-pink-50 rounded-lg p-4 border-l-4 border-red-500">
                    <p className="text-xs text-red-700 mb-1 font-bold flex items-center gap-1">
                      ‚ö° Prime Cost % <span className="text-[10px] bg-red-200 px-1 rounded">REI</span>
                    </p>
                    <p className={`text-2xl font-bold ${
                      primeCostPercentage > 65 ? 'text-red-700' :
                      primeCostPercentage > 60 ? 'text-orange-700' : 'text-green-700'
                    }`}>
                      {primeCostPercentage.toFixed(1)}%
                    </p>
                    <p className="text-xs text-red-600 mt-1">Ideal: 55-60%</p>
                  </div>
                </div>
                
                {/* Prime Cost Explanation */}
                <div className="mt-3 bg-red-50 border border-red-200 rounded-lg p-3">
                  <p className="text-xs text-red-800">
                    <strong>‚ö° Prime Cost</strong> = Food Cost + Labor Cost = 
                    <strong> ‚Ç¨{primeCostTotal.toFixed(2)}</strong> ({primeCostPercentage.toFixed(1)}%)
                    <br/>
                    √â o indicador MAIS importante! Se &gt;65% = problemas graves. Se &lt;60% = excelente gest√£o! üéØ
                  </p>
                </div>
              </div>

              {/* ============================================ */}
              {/* SECTION 2: BREAK-EVEN & EFICI√äNCIA */}
              {/* ============================================ */}
              <div className="bg-white rounded-lg shadow p-4 mb-3">
                <h2 className="text-xl font-bold mb-3 flex items-center gap-2">
                  üí∞ Break-Even & Efici√™ncia
                </h2>
                
                <div className="grid grid-cols-1 lg:grid-cols-3 gap-3">
                  {/* Break-Even Point */}
                  <div className="bg-gradient-to-br from-green-50 to-emerald-50 rounded-lg p-4 border-2 border-green-300">
                    <p className="text-xs text-green-700 mb-2 font-bold flex items-center gap-1">
                      üéØ Break-Even Point
                    </p>
                    <p className="text-3xl font-bold text-green-900 mb-1">
                      ‚Ç¨{breakEvenPoint.toFixed(0)}
                    </p>
                    <p className="text-xs text-green-700 mb-2">Mensal - Fatura√ß√£o necess√°ria</p>
                    
                    <div className="bg-white rounded p-2 text-xs space-y-1 mb-2">
                      <div className="flex justify-between">
                        <span className="text-gray-600">Fatura√ß√£o atual:</span>
                        <span className="font-semibold">‚Ç¨{totV.toFixed(2)}</span>
                      </div>
                      <div className="flex justify-between">
                        <span className="text-gray-600">Margem seguran√ßa:</span>
                        <span className={`font-bold ${
                          totV >= breakEvenPoint ? 'text-green-600' : 'text-red-600'
                        }`}>
                          ‚Ç¨{(totV - breakEvenPoint).toFixed(2)}
                        </span>
                      </div>
                      <div className="flex justify-between">
                        <span className="text-gray-600">Status:</span>
                        <span className={`font-bold ${
                          totV >= breakEvenPoint * 1.2 ? 'text-green-600' : 
                          totV >= breakEvenPoint ? 'text-yellow-600' : 'text-red-600'
                        }`}>
                          {totV >= breakEvenPoint * 1.2 ? '‚úÖ Excelente' : 
                           totV >= breakEvenPoint ? '‚ö†Ô∏è No limite' : 'üö® Abaixo'}
                        </span>
                      </div>
                    </div>
                    
                    {/* Break-Even Di√°rio */}
                    <div className="bg-green-100 border border-green-300 rounded p-2 text-xs">
                      <p className="font-bold text-green-900 mb-1">üìÖ Break-Even Di√°rio ({diasUteis} dias):</p>
                      <div className="space-y-0.5">
                        <div className="flex justify-between">
                          <span className="text-green-700">Fatura√ß√£o/dia:</span>
                          <span className="font-bold text-green-900">‚Ç¨{breakEvenDiario.toFixed(2)}</span>
                        </div>
                        <div className="flex justify-between">
                          <span className="text-green-700">Vendas necess√°rias:</span>
                          <span className="font-bold text-green-900">{Math.ceil(vendasNecessariasPorDia)}</span>
                        </div>
                        <div className="flex justify-between">
                          <span className="text-green-700">Margem/venda:</span>
                          <span className="font-bold text-green-900">‚Ç¨{margemPorVenda.toFixed(2)}</span>
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  {/* Efficiency per Employee */}
                  <div className="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-lg p-4 border-2 border-blue-300">
                    <p className="text-xs text-blue-700 mb-2 font-bold flex items-center gap-1">
                      üë§ Efici√™ncia por Colaborador
                    </p>
                    <p className="text-3xl font-bold text-blue-900 mb-1">
                      ‚Ç¨{revenuePerEmployee.toFixed(0)}
                    </p>
                    <p className="text-xs text-blue-700 mb-2">Fatura√ß√£o por colaborador</p>
                    
                    <div className="bg-white rounded p-2 text-xs space-y-1">
                      <div className="flex justify-between">
                        <span className="text-gray-600">N¬∫ Colaboradores:</span>
                        <span className="font-semibold">{numEmployees}</span>
                      </div>
                      <div className="flex justify-between">
                        <span className="text-gray-600">Vendas/Pessoa:</span>
                        <span className="font-semibold">{salesPerEmployee.toFixed(1)}</span>
                      </div>
                      <div className="flex justify-between">
                        <span className="text-gray-600">Custo/Pessoa:</span>
                        <span className="font-semibold">
                          ‚Ç¨{numEmployees > 0 ? (totalSalarios / numEmployees).toFixed(0) : '0'}
                        </span>
                      </div>
                    </div>
                  </div>
                  
                  {/* Daily Average */}
                  <div className="bg-gradient-to-br from-purple-50 to-pink-50 rounded-lg p-4 border-2 border-purple-300">
                    <p className="text-xs text-purple-700 mb-2 font-bold flex items-center gap-1">
                      üìÖ M√©dia Di√°ria
                    </p>
                    <p className="text-3xl font-bold text-purple-900 mb-1">
                      ‚Ç¨{medFat.toFixed(0)}
                    </p>
                    <p className="text-xs text-purple-700 mb-2">Fatura√ß√£o m√©dia por dia</p>
                    
                    <div className="bg-white rounded p-2 text-xs space-y-1">
                      <div className="flex justify-between">
                        <span className="text-gray-600">Dias ativos:</span>
                        <span className="font-semibold">{dias}</span>
                      </div>
                      <div className="flex justify-between">
                        <span className="text-gray-600">Vendas/Dia:</span>
                        <span className="font-semibold">
                          {dias > 0 ? (filteredVendas.length / dias).toFixed(1) : '0'}
                        </span>
                      </div>
                      <div className="flex justify-between">
                        <span className="text-gray-600">Produtos/Dia:</span>
                        <span className="font-semibold">
                          {dias > 0 ? (filteredVendas.reduce((s, v) => s + v.quantidade, 0) / dias).toFixed(1) : '0'}
                        </span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              {/* ============================================ */}
              {/* SECTION 3: AN√ÅLISE POR CLIENTE */}
              {/* ============================================ */}
              <div className="bg-white rounded-lg shadow p-4 mb-3">
                <h2 className="text-xl font-bold mb-3">üë§ An√°lise por Cliente</h2>
                <p className="text-xs text-gray-600 mb-3">Custos e margens por venda individual</p>
                
                <div className="grid grid-cols-2 lg:grid-cols-4 gap-2">
                  <div className="bg-blue-50 rounded p-3 border-l-4 border-blue-500">
                    <p className="text-xs text-blue-700 mb-1">Custo Alimentos</p>
                    <p className="text-lg font-bold text-blue-900">
                      ‚Ç¨{filteredVendas.length > 0 ? (
                        filteredDespesas
                          .filter(d => d.categoria === 'compras')
                          .reduce((s, d) => s + d.valor, 0) / filteredVendas.length
                      ).toFixed(2) : '0.00'}
                    </p>
                    <p className="text-xs text-blue-600 mt-1">Por venda</p>
                  </div>
                  
                  <div className="bg-purple-50 rounded p-3 border-l-4 border-purple-500">
                    <p className="text-xs text-purple-700 mb-1">Custo Consum√≠veis</p>
                    <p className="text-lg font-bold text-purple-900">
                      ‚Ç¨{filteredVendas.length > 0 ? (
                        filteredDespesas
                          .filter(d => d.categoria === 'consumiveis')
                          .reduce((s, d) => s + d.valor, 0) / filteredVendas.length
                      ).toFixed(2) : '0.00'}
                    </p>
                    <p className="text-xs text-purple-600 mt-1">Por venda</p>
                  </div>
                  
                  <div className="bg-orange-50 rounded p-3 border-l-4 border-orange-500">
                    <p className="text-xs text-orange-700 mb-1">Pre√ßo M√©dio Venda</p>
                    <p className="text-lg font-bold text-orange-900">
                      ‚Ç¨{filteredVendas.length > 0 ? (totV / filteredVendas.length).toFixed(2) : '0.00'}
                    </p>
                    <p className="text-xs text-orange-600 mt-1">Por venda</p>
                  </div>
                  
                  <div className="bg-green-50 rounded p-3 border-l-4 border-green-500">
                    <p className="text-xs text-green-700 mb-1">Margem por Cliente</p>
                    <p className="text-lg font-bold text-green-900">
                      ‚Ç¨{filteredVendas.length > 0 ? (
                        (totV - filteredDespesas.filter(d => d.categoria === 'compras' || d.categoria === 'consumiveis').reduce((s, d) => s + d.valor, 0)) / filteredVendas.length
                      ).toFixed(2) : '0.00'}
                    </p>
                    <p className="text-xs text-green-600 mt-1">Por venda</p>
                  </div>
                </div>
              </div>

              {/* ============================================ */}
              {/* SECTION 4: FISCAL (IVA) */}
              {/* ============================================ */}
              <div className="bg-white rounded-lg shadow p-4 mb-3">
                <h2 className="text-xl font-bold mb-3">üßÆ An√°lise Fiscal (IVA)</h2>
                
                <div className="grid grid-cols-3 gap-3 mb-3">
                  <div className="bg-green-50 rounded-lg p-4 border border-green-200">
                    <p className="text-xs text-green-700 mb-1 font-semibold">IVA Vendas</p>
                    <p className="text-xl font-bold text-green-900">
                      ‚Ç¨{filteredVendas.reduce((s, v) => {
                        // Vendas podem ter produtoId OU produto (nome)
                        const prod = v.produtoId 
                          ? produtos.find(p => p.id === v.produtoId)
                          : produtos.find(p => p.nome.toLowerCase() === v.produto.toLowerCase());
                        if (!prod) return s;
                        const precoSemIva = prod.precoVenda / (1 + prod.iva / 100);
                        return s + (prod.precoVenda - precoSemIva) * v.quantidade;
                      }, 0).toFixed(2)}
                    </p>
                    <p className="text-xs text-green-600 mt-1">Cobrado aos clientes</p>
                  </div>
                  
                  <div className="bg-blue-50 rounded-lg p-4 border border-blue-200">
                    <p className="text-xs text-blue-700 mb-1 font-semibold">IVA Compras</p>
                    <p className="text-xl font-bold text-blue-900">
                      ‚Ç¨{ivaCompras.toFixed(2)}
                    </p>
                    <p className="text-xs text-blue-600 mt-1">Dedut√≠vel (faturas)</p>
                  </div>
                  
                  <div className="bg-orange-50 rounded-lg p-4 border border-orange-200">
                    <p className="text-xs text-orange-700 mb-1 font-semibold">IVA a Pagar</p>
                    <p className="text-xl font-bold text-orange-900">
                      ‚Ç¨{ivaP.toFixed(2)}
                    </p>
                    <p className="text-xs text-orange-600 mt-1">A entregar ao Estado</p>
                  </div>
                </div>
                
                <div className="bg-blue-50 rounded p-2 text-xs text-blue-800 mb-3">
                  üí° <strong>C√°lculo:</strong> IVA a Pagar = IVA Vendas - IVA Compras
                </div>
                
                {/* IVA Breakdown */}
                <div className="border-t pt-3">
                  <h4 className="text-sm font-semibold mb-2 text-gray-700">üìã Breakdown IVA Compras</h4>
                  <div className="grid grid-cols-2 gap-2">
                    <div className="bg-blue-50 rounded p-2 border border-blue-200">
                      <p className="text-xs text-blue-700 mb-1">IVA Compras Alimentos (6%)</p>
                      <p className="text-base font-bold text-blue-900">
                        ‚Ç¨{filteredDespesas
                          .filter(d => d.categoria === 'compras')
                          .reduce((s, d) => {
                            const valorSemIva = d.valor / (1 + d.iva / 100);
                            return s + (d.valor - valorSemIva);
                          }, 0).toFixed(2)}
                      </p>
                      <p className="text-xs text-blue-600 mt-1">Recuper√°vel</p>
                    </div>
                    
                    <div className="bg-purple-50 rounded p-2 border border-purple-200">
                      <p className="text-xs text-purple-700 mb-1">IVA Compras Consum√≠veis (23%)</p>
                      <p className="text-base font-bold text-purple-900">
                        ‚Ç¨{filteredDespesas
                          .filter(d => d.categoria === 'consumiveis')
                          .reduce((s, d) => {
                            const valorSemIva = d.valor / (1 + d.iva / 100);
                            return s + (d.valor - valorSemIva);
                          }, 0).toFixed(2)}
                      </p>
                      <p className="text-xs text-purple-600 mt-1">Recuper√°vel</p>
                    </div>
                  </div>
                </div>
              </div>
              </>
            )}
            {dashboardSubTab === 'compras' && (
              <ComprasAnalysis 
                despesas={despesas}
                faturas={faturas}
                ingredientes={ingredientes}
                fornecedores={fornecedores}
              />
            )}

            {dashboardSubTab === 'simuladores' && (
              <>
                {/* Simulador de Custos Laborais */}
                <div className="bg-white rounded-lg shadow p-4 mb-3">
                  <h2 className="text-xl font-bold mb-3 flex items-center gap-2">
                    üí∞ Simulador de Custos Laborais
                  </h2>
                  <p className="text-sm text-gray-600 mb-4">
                    Calcula o custo real de um funcion√°rio incluindo subs√≠dios obrigat√≥rios e encargos da Seguran√ßa Social
                  </p>
                  
                  {/* Seletor de Modo */}
                  <div className="mb-4 flex gap-2">
                    <button
                      onClick={() => setModoSimulador('fulltime')}
                      className={`flex-1 py-2 px-4 rounded-lg font-medium text-sm transition ${
                        modoSimulador === 'fulltime' 
                          ? 'bg-blue-500 text-white' 
                          : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                      }`}
                    >
                      üëî Full-Time (40h/semana)
                    </button>
                    <button
                      onClick={() => setModoSimulador('parttime')}
                      className={`flex-1 py-2 px-4 rounded-lg font-medium text-sm transition ${
                        modoSimulador === 'parttime' 
                          ? 'bg-green-500 text-white' 
                          : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                      }`}
                    >
                      ‚è∞ Part-Time
                    </button>
                  </div>
                  
                  <div className="grid grid-cols-1 lg:grid-cols-2 gap-4">
                    {/* Input */}
                    <div className="bg-blue-50 border-2 border-blue-200 rounded-lg p-4">
                      <h3 className="font-semibold text-blue-900 mb-3">üìù Dados do Sal√°rio</h3>
                      
                      <div className="space-y-3">
                        {modoSimulador === 'parttime' && (
                          <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">
                              Horas Semanais
                            </label>
                            <div className="relative">
                              <input
                                type="number"
                                value={horasSemanaisPartTime}
                                onChange={(e) => setHorasSemanaisPartTime(parseFloat(e.target.value) || 0)}
                                className="w-full border rounded px-3 py-2 pr-12"
                                placeholder="8"
                                min="1"
                                max="30"
                              />
                              <span className="absolute right-3 top-2.5 text-gray-500 text-sm">h/sem</span>
                            </div>
                            <p className="text-xs text-gray-600 mt-1">
                              = {((horasSemanaisPartTime / 40) * 100).toFixed(0)}% de um full-time
                            </p>
                          </div>
                        )}
                        
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-1">
                            {modoSimulador === 'fulltime' ? 'Sal√°rio Bruto Mensal' : 'Sal√°rio Refer√™ncia Full-Time'}
                          </label>
                          <div className="relative">
                            <input
                              type="number"
                              value={ordenadoDesejado}
                              onChange={(e) => setOrdenadoDesejado(parseFloat(e.target.value) || 0)}
                              className="w-full border rounded px-3 py-2 pr-8"
                              placeholder="920"
                            />
                            <span className="absolute right-3 top-2.5 text-gray-500 font-semibold">‚Ç¨</span>
                          </div>
                          {modoSimulador === 'parttime' && (
                            <p className="text-xs text-green-700 mt-1 font-medium">
                              ‚Üí Part-time: ‚Ç¨{(ordenadoDesejado * horasSemanaisPartTime / 40).toFixed(2)}/m√™s
                            </p>
                          )}
                        </div>
                        
                        {/* Subs√≠dio de Alimenta√ß√£o */}
                        <div className="pt-2 border-t border-blue-300">
                          <label className="flex items-center gap-2 cursor-pointer">
                            <input
                              type="checkbox"
                              checked={incluirSubsidioAlimentacao}
                              onChange={(e) => setIncluirSubsidioAlimentacao(e.target.checked)}
                              className="w-4 h-4"
                            />
                            <span className="text-sm font-medium text-gray-700">Incluir Subs√≠dio de Alimenta√ß√£o</span>
                          </label>
                          
                          {incluirSubsidioAlimentacao && (
                            <div className="mt-2 pl-6">
                              <div className="flex items-center gap-2">
                                <input
                                  type="number"
                                  step="0.10"
                                  value={valorSubsidioAlimentacao}
                                  onChange={(e) => setValorSubsidioAlimentacao(parseFloat(e.target.value) || 0)}
                                  className="w-20 border rounded px-2 py-1 text-sm"
                                />
                                <span className="text-sm text-gray-600">
                                  ‚Ç¨/dia √ó {modoSimulador === 'parttime' ? Math.ceil(horasSemanaisPartTime / 5) : '22'} dias
                                </span>
                              </div>
                              <p className="text-xs text-blue-700 mt-1">
                                {modoSimulador === 'fulltime' ? (
                                  `= ‚Ç¨${(valorSubsidioAlimentacao * 22).toFixed(2)}/m√™s`
                                ) : (
                                  <>
                                    {horasSemanaisPartTime < 25 ? (
                                      `= ‚Ç¨${(valorSubsidioAlimentacao * Math.ceil(horasSemanaisPartTime / 5) * 0.8).toFixed(2)}/m√™s (proporcional <5h/dia)`
                                    ) : (
                                      `= ‚Ç¨${(valorSubsidioAlimentacao * Math.ceil(horasSemanaisPartTime / 5)).toFixed(2)}/m√™s`
                                    )}
                                  </>
                                )}
                              </p>
                            </div>
                          )}
                          
                          <p className="text-xs text-gray-500 mt-1 pl-6">
                            üí° N√£o obrigat√≥rio no setor privado. Refer√™ncia: ‚Ç¨6.00/dia (fun√ß√£o p√∫blica)
                          </p>
                        </div>
                      </div>
                    </div>
                    
                    {/* Output */}
                    <div className="bg-gradient-to-br from-green-50 to-emerald-50 border-2 border-green-300 rounded-lg p-4">
                      <h3 className="font-semibold text-green-900 mb-3">üíµ Custo Real para a Empresa</h3>
                      
                      {(() => {
                        // Calcular sal√°rio base (proporcional se part-time)
                        const proporcaoPartTime = modoSimulador === 'parttime' ? horasSemanaisPartTime / 40 : 1;
                        const salarioBase = ordenadoDesejado * proporcaoPartTime;
                        
                        // Calcular subs√≠dio alimenta√ß√£o
                        let subsidioAlimentacaoMensal = 0;
                        if (incluirSubsidioAlimentacao) {
                          if (modoSimulador === 'fulltime') {
                            subsidioAlimentacaoMensal = valorSubsidioAlimentacao * 22;
                          } else {
                            const diasTrabalhados = Math.ceil(horasSemanaisPartTime / 5); // aprox dias/semana
                            const valorDiario = horasSemanaisPartTime < 25 ? valorSubsidioAlimentacao * 0.8 : valorSubsidioAlimentacao;
                            subsidioAlimentacaoMensal = valorDiario * diasTrabalhados;
                          }
                        }
                        
                        const salarioComSubsidios = salarioBase + salarioBase / 12 * 2;
                        const tsuBase = salarioComSubsidios * 0.2375;
                        const custoTotal = salarioComSubsidios * 1.2375 + subsidioAlimentacaoMensal;
                        
                        return (
                          <>
                            {modoSimulador === 'parttime' && (
                              <div className="bg-green-100 border border-green-300 rounded p-2 mb-3">
                                <p className="text-xs font-semibold text-green-900">
                                  ‚è∞ Part-Time: {horasSemanaisPartTime}h/semana ({(proporcaoPartTime * 100).toFixed(0)}%)
                                </p>
                              </div>
                            )}
                            
                            <div className="space-y-2 text-sm">
                              <div className="flex justify-between items-center pb-2 border-b border-green-200">
                                <span className="text-gray-700">Sal√°rio mensal base:</span>
                                <span className="font-semibold">‚Ç¨{salarioBase.toFixed(2)}</span>
                              </div>
                              
                              <div className="flex justify-between items-center text-xs text-gray-600">
                                <span>Subs√≠dio de F√©rias (1/12):</span>
                                <span>‚Ç¨{(salarioBase / 12).toFixed(2)}</span>
                              </div>
                              
                              <div className="flex justify-between items-center text-xs text-gray-600 pb-2 border-b border-green-200">
                                <span>Subs√≠dio de Natal (1/12):</span>
                                <span>‚Ç¨{(salarioBase / 12).toFixed(2)}</span>
                              </div>
                              
                              {incluirSubsidioAlimentacao && (
                                <div className="flex justify-between items-center text-xs text-blue-700 pb-2 border-b border-green-200">
                                  <span>Subs√≠dio de Alimenta√ß√£o:</span>
                                  <span>‚Ç¨{subsidioAlimentacaoMensal.toFixed(2)}</span>
                                </div>
                              )}
                              
                              <div className="flex justify-between items-center pb-2 border-b border-green-200">
                                <span className="text-gray-700">Subtotal com subs√≠dios:</span>
                                <span className="font-semibold">‚Ç¨{(salarioComSubsidios + subsidioAlimentacaoMensal).toFixed(2)}</span>
                              </div>
                              
                              <div className="flex justify-between items-center text-orange-700 pb-2 border-b-2 border-green-300">
                                <span className="font-medium">TSU Patronal (23.75%):</span>
                                <span className="font-semibold">‚Ç¨{tsuBase.toFixed(2)}</span>
                              </div>
                              
                              <div className="flex justify-between items-center pt-2">
                                <span className="text-lg font-bold text-green-900">CUSTO TOTAL MENSAL:</span>
                                <span className="text-2xl font-bold text-green-900">
                                  ‚Ç¨{custoTotal.toFixed(2)}
                                </span>
                              </div>
                            </div>
                            
                            <div className="mt-3 pt-3 border-t border-green-300">
                              <div className="text-xs text-green-800 space-y-1">
                                <p>üí° <strong>Custo anual:</strong> ‚Ç¨{(custoTotal * 12).toFixed(2)}</p>
                                <p>üìä <strong>Encargos adicionais:</strong> +{((custoTotal / salarioBase - 1) * 100).toFixed(1)}% sobre sal√°rio base</p>
                              </div>
                            </div>
                          </>
                        );
                      })()}
                    </div>
                  </div>
                  
                  {/* Info Box */}
                  <div className="mt-4 bg-blue-50 border border-blue-200 rounded-lg p-3">
                    <p className="text-xs text-blue-800">
                      <strong>‚ÑπÔ∏è O que est√° inclu√≠do:</strong>
                    </p>
                    <ul className="text-xs text-blue-700 mt-2 space-y-1 ml-4">
                      <li>‚Ä¢ <strong>Subs√≠dio de F√©rias</strong>: 1 m√™s de sal√°rio (14¬∫ m√™s) - obrigat√≥rio por lei</li>
                      <li>‚Ä¢ <strong>Subs√≠dio de Natal</strong>: 1 m√™s de sal√°rio (13¬∫ m√™s) - obrigat√≥rio por lei</li>
                      <li>‚Ä¢ <strong>Subs√≠dio de Alimenta√ß√£o</strong>: Opcional (n√£o obrigat√≥rio no setor privado). Isento at√© ‚Ç¨6/dia em dinheiro ou ‚Ç¨10.20/dia em cart√£o</li>
                      <li>‚Ä¢ <strong>TSU Patronal</strong>: 23.75% sobre sal√°rio + subs√≠dios de f√©rias e natal (n√£o incide sobre subs√≠dio alimenta√ß√£o at√© limites isentos)</li>
                      <li>‚Ä¢ <strong>Nota</strong>: Trabalhador tamb√©m desconta 11% (retido do sal√°rio), mas n√£o est√° inclu√≠do aqui</li>
                    </ul>
                  </div>
                </div>

                {/* Simulador de IVA Trimestral */}
                <div className="bg-white rounded-lg shadow p-4">
                  <h2 className="text-xl font-bold mb-3 flex items-center gap-2">
                    üßæ Pr√≥xima Entrega de IVA
                  </h2>
                  <p className="text-sm text-gray-600 mb-4">
                    Estimativa do IVA a pagar no pr√≥ximo trimestre (regime trimestral)
                  </p>
                  
                  {(() => {
                    // Calculate current quarter
                    const now = new Date();
                    const currentMonth = now.getMonth() + 1; // 1-12
                    const currentYear = now.getFullYear();
                    
                    // Determine quarter
                    let quarter, quarterStart, quarterEnd, deadlineMonth, deadlineDay;
                    if (currentMonth >= 1 && currentMonth <= 3) {
                      quarter = 1;
                      quarterStart = new Date(currentYear, 0, 1);
                      quarterEnd = new Date(currentYear, 2, 31);
                      deadlineMonth = 5; // May
                      deadlineDay = 20;
                    } else if (currentMonth >= 4 && currentMonth <= 6) {
                      quarter = 2;
                      quarterStart = new Date(currentYear, 3, 1);
                      quarterEnd = new Date(currentYear, 5, 30);
                      deadlineMonth = 8; // August
                      deadlineDay = 20;
                    } else if (currentMonth >= 7 && currentMonth <= 9) {
                      quarter = 3;
                      quarterStart = new Date(currentYear, 6, 1);
                      quarterEnd = new Date(currentYear, 8, 30);
                      deadlineMonth = 11; // November
                      deadlineDay = 20;
                    } else {
                      quarter = 4;
                      quarterStart = new Date(currentYear, 9, 1);
                      quarterEnd = new Date(currentYear, 11, 31);
                      deadlineMonth = 2; // February next year
                      deadlineDay = 20;
                    }
                    
                    // Calculate deadline
                    const deadlineYear = quarter === 4 ? currentYear + 1 : currentYear;
                    const deadline = new Date(deadlineYear, deadlineMonth - 1, deadlineDay);
                    const daysUntil = Math.ceil((deadline - now) / (1000 * 60 * 60 * 24));
                    
                    // Filter sales and expenses for current quarter
                    const quarterVendas = vendas.filter(v => {
                      const vDate = new Date(v.data);
                      return vDate >= quarterStart && vDate <= quarterEnd;
                    });
                    
                    const quarterDespesas = despesas.filter(d => {
                      const dDate = new Date(d.data);
                      return dDate >= quarterStart && dDate <= quarterEnd;
                    });
                    
                    // Calculate IVA
                    const ivaVendas = quarterVendas.reduce((s, v) => {
                      const prod = v.produtoId 
                        ? produtos.find(p => p.id === v.produtoId)
                        : produtos.find(p => p.nome.toLowerCase() === v.produto.toLowerCase());
                      if (!prod) return s;
                      const precoSemIva = prod.precoVenda / (1 + prod.iva / 100);
                      return s + (prod.precoVenda - precoSemIva) * v.quantidade;
                    }, 0);
                    
                    const ivaCompras = quarterDespesas.reduce((s, d) => {
                      const valorSemIva = d.valor / (1 + d.iva / 100);
                      return s + (d.valor - valorSemIva);
                    }, 0);
                    
                    const ivaPagar = ivaVendas - ivaCompras;
                    
                    return (
                      <div className="grid grid-cols-1 lg:grid-cols-2 gap-4">
                        <div className="space-y-3">
                          <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
                            <p className="text-sm font-semibold text-blue-900 mb-2">
                              {quarter}¬∫ Trimestre {currentYear}
                            </p>
                            <div className="space-y-2 text-sm">
                              <div className="flex justify-between">
                                <span className="text-gray-700">IVA Vendas:</span>
                                <span className="font-semibold text-green-700">‚Ç¨{ivaVendas.toFixed(2)}</span>
                              </div>
                              <div className="flex justify-between">
                                <span className="text-gray-700">IVA Compras:</span>
                                <span className="font-semibold text-blue-700">-‚Ç¨{ivaCompras.toFixed(2)}</span>
                              </div>
                              <div className="flex justify-between pt-2 border-t border-blue-300">
                                <span className="font-bold text-gray-900">A Pagar:</span>
                                <span className={`text-xl font-bold ${ivaPagar >= 0 ? 'text-orange-600' : 'text-green-600'}`}>
                                  ‚Ç¨{ivaPagar.toFixed(2)}
                                </span>
                              </div>
                            </div>
                          </div>
                          
                          <div className={`border-2 rounded-lg p-4 ${
                            daysUntil <= 7 ? 'bg-red-50 border-red-300' :
                            daysUntil <= 30 ? 'bg-orange-50 border-orange-300' :
                            'bg-green-50 border-green-300'
                          }`}>
                            <p className="text-sm font-semibold mb-2">
                              üìÖ Prazo de Entrega
                            </p>
                            <p className="text-2xl font-bold">
                              {deadline.toLocaleDateString('pt-PT', { day: '2-digit', month: 'long', year: 'numeric' })}
                            </p>
                            <p className={`text-sm mt-1 font-semibold ${
                              daysUntil <= 7 ? 'text-red-700' :
                              daysUntil <= 30 ? 'text-orange-700' :
                              'text-green-700'
                            }`}>
                              {daysUntil > 0 ? `Faltam ${daysUntil} dias` : 'PRAZO EXPIRADO!'}
                            </p>
                          </div>
                        </div>
                        
                        <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                          <p className="text-sm font-semibold text-yellow-900 mb-2">
                            üìã Calend√°rio IVA Trimestral
                          </p>
                          <div className="space-y-2 text-xs text-yellow-800">
                            <div className="flex justify-between">
                              <span>1¬∫ Trimestre (Jan-Mar):</span>
                              <span className="font-semibold">20 Maio</span>
                            </div>
                            <div className="flex justify-between">
                              <span>2¬∫ Trimestre (Abr-Jun):</span>
                              <span className="font-semibold">20 Agosto</span>
                            </div>
                            <div className="flex justify-between">
                              <span>3¬∫ Trimestre (Jul-Set):</span>
                              <span className="font-semibold">20 Novembro</span>
                            </div>
                            <div className="flex justify-between">
                              <span>4¬∫ Trimestre (Out-Dez):</span>
                              <span className="font-semibold">20 Fevereiro</span>
                            </div>
                          </div>
                          
                          <div className="mt-3 pt-3 border-t border-yellow-300 text-xs text-yellow-800">
                            <p className="font-semibold mb-1">üí° Dicas:</p>
                            <ul className="space-y-1 ml-4">
                              <li>‚Ä¢ Declara√ß√£o at√© dia 20</li>
                              <li>‚Ä¢ Pagamento at√© dia 25</li>
                              <li>‚Ä¢ Regime para fatura√ß√£o &lt;‚Ç¨650k/ano</li>
                            </ul>
                          </div>
                        </div>
                      </div>
                    );
                  })()}
                </div>
              </>
            )}
          </div>
        )}


            {dashboardSubTab === 'delivery' && deliveryApps.some(app => app.ativo) && (
              <div className="bg-white rounded-lg shadow p-4">
                <h2 className="text-xl font-bold mb-4 flex items-center gap-2">
                  üöó An√°lise de Delivery
                </h2>
                
                <div className="bg-gradient-to-r from-orange-50 to-yellow-50 border-2 border-orange-200 rounded-lg p-4 mb-4">
                  <p className="text-sm text-gray-700 mb-2">
                    üí° <strong>Compara√ß√£o de Pre√ßos e Margens</strong> - Produtos Take-Away vs Apps Delivery
                  </p>
                  <p className="text-xs text-gray-600">
                    Apps ativas: {deliveryApps.filter(app => app.ativo).map(app => `${app.nome} (${app.comissao}%)`).join(', ')}
                  </p>
                </div>
                
                {/* Filtrar produtos com embalagens */}
                {(() => {
                  console.log('=== DEBUG DELIVERY ===');
                  console.log('Produtos total:', produtos.length);
                  console.log('Ingredientes total:', ingredientes.length);
                  
                  // Debug ingredientes embalagens
                  const embalagens = ingredientes.filter(i => i.categoria === 'embalagens');
                  console.log('Ingredientes embalagens:', embalagens);
                  
                  const produtosTakeAway = produtos.filter(p => {
                    if (!p.receita) {
                      console.log('Produto sem receita:', p.nome);
                      return false;
                    }
                    
                    const temEmbalagem = p.receita.some(r => {
                      const ing = ingredientes.find(i => i.id == r.ingredienteId);
                      if (ing && ing.categoria === 'embalagens') {
                        console.log('Produto', p.nome, 'tem embalagem:', ing.nome);
                        return true;
                      }
                      return false;
                    });
                    
                    return temEmbalagem;
                  });
                  
                  console.log('Produtos take-away encontrados:', produtosTakeAway.length);
                  console.log('Produtos take-away:', produtosTakeAway.map(p => p.nome));
                  
                  if (produtosTakeAway.length === 0) {
                    return (
                      <div className="text-center py-12 bg-gray-50 rounded-lg border-2 border-dashed">
                        <p className="text-gray-600 mb-2">üì¶ Nenhum produto Take-Away encontrado</p>
                        <p className="text-sm text-gray-500 mb-2">
                          Adicione produtos com embalagens (categoria "Embalagens") para ver an√°lise de delivery
                        </p>
                        <div className="text-xs text-left bg-white p-4 rounded mx-auto max-w-md mt-4">
                          <p className="font-bold mb-2">Debug Info:</p>
                          <p>Total produtos: {produtos.length}</p>
                          <p>Total ingredientes: {ingredientes.length}</p>
                          <p>Ingredientes "embalagens": {embalagens.length}</p>
                          <p className="mt-2 text-gray-600">Categorias encontradas:</p>
                          <p className="text-xs">{[...new Set(ingredientes.map(i => i.categoria))].join(', ')}</p>
                        </div>
                      </div>
                    );
                  }
                  
                  return (
                    <div className="space-y-4">
                      {produtosTakeAway.map(produto => {
                        const precos = calcPrecosPorModalidade(produto);
                        const appsAtivas = deliveryApps.filter(app => app.ativo);
                        
                        return (
                          <div key={produto.id} className="border-2 border-gray-200 rounded-lg overflow-hidden">
                            <div className="bg-gradient-to-r from-blue-50 to-indigo-50 p-3 border-b-2 border-blue-200">
                              <h3 className="font-bold text-lg">{produto.nome}</h3>
                              <p className="text-xs text-gray-600">
                                Custo ingredientes: ‚Ç¨{precos.takeaway.custo - precos.takeaway.custoEmbalagens || 0} | 
                                Custo embalagens: ‚Ç¨{precos.takeaway.custoEmbalagens.toFixed(2)} | 
                                <strong> Total: ‚Ç¨{precos.takeaway.custo.toFixed(2)}</strong>
                              </p>
                            </div>
                            
                            <div className="p-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3">
                              {/* Take-Away Direto */}
                              <div className="bg-green-50 border-2 border-green-300 rounded-lg p-3">
                                <div className="flex items-center gap-2 mb-2">
                                  <span className="text-2xl">üõçÔ∏è</span>
                                  <div>
                                    <p className="font-bold text-sm">Take-Away Direto</p>
                                    <p className="text-xs text-gray-600">Sem comiss√µes</p>
                                  </div>
                                </div>
                                <div className="space-y-1">
                                  <div className="flex justify-between text-xs">
                                    <span>Pre√ßo:</span>
                                    <span className="font-bold">‚Ç¨{precos.takeaway.preco.toFixed(2)}</span>
                                  </div>
                                  <div className="flex justify-between text-xs">
                                    <span>Margem:</span>
                                    <span className="font-bold text-green-700">‚Ç¨{precos.takeaway.margem.toFixed(2)}</span>
                                  </div>
                                  <div className="flex justify-between text-xs">
                                    <span>Margem %:</span>
                                    <span className="font-bold text-green-700">{precos.takeaway.margemPerc.toFixed(0)}%</span>
                                  </div>
                                </div>
                              </div>
                              
                              {/* Apps de Delivery */}
                              {appsAtivas.map(app => {
                                const dados = precos.delivery[app.id];
                                const diferencaMargem = ((dados.margemPerc - precos.takeaway.margemPerc) / precos.takeaway.margemPerc * 100);
                                
                                return (
                                  <div key={app.id} className="bg-orange-50 border-2 border-orange-300 rounded-lg p-3">
                                    <div className="flex items-center gap-2 mb-2">
                                      <span className="text-2xl">üöó</span>
                                      <div>
                                        <p className="font-bold text-sm">{app.nome}</p>
                                        <p className="text-xs text-gray-600">Comiss√£o {app.comissao}%</p>
                                      </div>
                                    </div>
                                    <div className="space-y-1">
                                      <div className="flex justify-between text-xs">
                                        <span>Pre√ßo sugerido:</span>
                                        <span className="font-bold">‚Ç¨{dados.precoSugerido.toFixed(2)}</span>
                                      </div>
                                      <div className="flex justify-between text-xs">
                                        <span>Receita l√≠quida:</span>
                                        <span className="font-semibold text-blue-600">‚Ç¨{dados.receitaLiquida.toFixed(2)}</span>
                                      </div>
                                      <div className="flex justify-between text-xs">
                                        <span>Margem:</span>
                                        <span className={`font-bold ${dados.margem > 0 ? 'text-green-700' : 'text-red-700'}`}>
                                          ‚Ç¨{dados.margem.toFixed(2)}
                                        </span>
                                      </div>
                                      <div className="flex justify-between text-xs">
                                        <span>Margem %:</span>
                                        <span className={`font-bold ${dados.margem > 0 ? 'text-green-700' : 'text-red-700'}`}>
                                          {dados.margemPerc.toFixed(0)}%
                                        </span>
                                      </div>
                                      <div className="pt-1 border-t border-orange-200">
                                        <p className={`text-xs font-semibold ${diferencaMargem < 0 ? 'text-red-600' : 'text-green-600'}`}>
                                          {diferencaMargem >= 0 ? '‚Üë' : '‚Üì'} {Math.abs(diferencaMargem).toFixed(0)}% vs direto
                                        </p>
                                      </div>
                                    </div>
                                  </div>
                                );
                              })}
                            </div>
                            
                            {/* Recomenda√ß√£o */}
                            <div className="bg-blue-50 p-3 border-t-2 border-blue-200">
                              <p className="text-xs text-blue-900">
                                <strong>üí° Recomenda√ß√£o:</strong> {(() => {
                                  const melhorApp = appsAtivas.reduce((melhor, app) => {
                                    const dados = precos.delivery[app.id];
                                    const melhorDados = precos.delivery[melhor.id];
                                    return dados.margemPerc > melhorDados.margemPerc ? app : melhor;
                                  });
                                  
                                  const melhorDados = precos.delivery[melhorApp.id];
                                  
                                  if (melhorDados.margemPerc < precos.takeaway.margemPerc * 0.7) {
                                    return `‚ö†Ô∏è Todas as apps reduzem margem >30%. Considere aumentar pre√ßos ou venda direta.`;
                                  }
                                  
                                  return `Melhor app: ${melhorApp.nome} (margem ${melhorDados.margemPerc.toFixed(0)}%)`;
                                })()}
                              </p>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  );
                })()}
              </div>
            )}
        {activeTab === 'gestao' && (
          <div className="space-y-3">
            {/* Gest√£o Sub-tabs */}
            <div className="bg-white rounded-lg shadow">
              <div className="flex border-b overflow-x-auto">
                {[
                  { id: 'ingredientes', label: 'Ingredientes', icon: FileText },
                  { id: 'produtos', label: 'Produtos', icon: Package },
                  { id: 'faturas', label: 'Faturas', icon: FileText },
                  { id: 'vendas', label: 'Vendas', icon: Upload }
                ].map(tab => {
                  const Icon = tab.icon;
                  return (
                    <button key={tab.id} onClick={() => setGestaoSubTab(tab.id)}
                      className={`flex items-center gap-2 px-4 py-2 font-medium text-xs transition ${
                        gestaoSubTab === tab.id ? 'bg-blue-500 text-white' : 'text-gray-600 hover:bg-blue-50'
                      }`}>
                      <Icon size={14} />{tab.label}
                    </button>
                  );
                })}
              </div>
            </div>
            

            {gestaoSubTab === 'ingredientes' && (
              <div className="bg-white rounded-lg shadow p-3">
                <h2 className="text-lg font-bold mb-3">Ingredientes</h2>
                
                <div className={`rounded p-3 mb-3 border ${editandoIngrediente ? 'bg-yellow-50 border-yellow-300' : 'bg-blue-50 border-blue-200'}`}>
                  <h3 className="font-semibold text-xs mb-2">{editandoIngrediente ? 'Editar Ingrediente' : 'Adicionar Ingrediente'}</h3>
                  <div className="grid grid-cols-6 gap-2">
                    <input type="text" placeholder="Nome" value={novoIngrediente.nome}
                      onChange={(e) => {
                        const nome = e.target.value;
                        const catDetectada = detectarCategoria(nome);
                        setNovoIngrediente({ ...novoIngrediente, nome: nome, categoria: catDetectada });
                      }}
                      className="border rounded px-2 py-1.5 text-xs" />
                    <select value={novoIngrediente.categoria || 'outros'}
                      onChange={(e) => setNovoIngrediente({ ...novoIngrediente, categoria: e.target.value })}
                      className="border rounded px-2 py-1.5 text-xs"
                      title="Categoria auto-detectada (pode editar)">
                      <option value="vegetais">Vegetais</option>
                      <option value="carnes">Carnes</option>
                      <option value="peixe">Peixe</option>
                      <option value="latic√≠nios">Latic√≠nios</option>
                      <option value="padaria">Padaria</option>
                      <option value="pastelaria">Pastelaria</option>
                      <option value="compotas">Compotas</option>
                      <option value="bebidas">Bebidas</option>
                      <option value="temperos">Temperos</option>
                      <option value="embalagens">Embalagens</option>
                      <option value="limpeza">Limpeza</option>
                      <option value="outros">Outros</option>
                    </select>
                    <select value={novoIngrediente.unidade}
                      onChange={(e) => setNovoIngrediente({ ...novoIngrediente, unidade: e.target.value })}
                      className="border rounded px-2 py-1.5 text-xs">
                      <option value="kg">kg</option>
                      <option value="g">g</option>
                      <option value="L">L</option>
                      <option value="ml">ml</option>
                      <option value="un">un</option>
                    </select>
                    <input type="number" step="0.01" placeholder="Custo ‚Ç¨" value={novoIngrediente.custoUnitario}
                      onChange={(e) => setNovoIngrediente({ ...novoIngrediente, custoUnitario: e.target.value })}
                      className="border rounded px-2 py-1.5 text-xs" />
                    <select value={novoIngrediente.iva}
                      onChange={(e) => setNovoIngrediente({ ...novoIngrediente, iva: e.target.value })}
                      className="border rounded px-2 py-1.5 text-xs">
                      <option value="6">IVA 6%</option>
                      <option value="13">IVA 13%</option>
                      <option value="23">IVA 23%</option>
                    </select>
                    {editandoIngrediente ? (
                      <div className="flex gap-1">
                        <button onClick={atualizarIngrediente}
                          className="flex-1 bg-yellow-600 text-white rounded px-2 py-1.5 text-xs hover:bg-yellow-700 flex items-center justify-center font-semibold">
                          <Save size={14} />
                        </button>
                        <button onClick={cancelarEdicaoIngrediente}
                          className="bg-gray-400 text-white rounded px-2 py-1.5 text-xs hover:bg-gray-500">
                          X
                        </button>
                      </div>
                    ) : (
                      <button onClick={adicionarIngrediente}
                        className="bg-blue-600 text-white rounded px-3 py-1.5 text-xs hover:bg-blue-700 flex items-center justify-center gap-1 font-semibold">
                        <Plus size={14} />Add
                      </button>
                    )}
                  </div>
                </div>

                <div className="overflow-x-auto rounded border">
                  <table className="w-full text-xs">
                    <thead className="bg-gray-50">
                      <tr>
                        <th className="px-2 py-2 text-left font-semibold">Nome</th>
                        <th className="px-2 py-2 text-left font-semibold">Categoria</th>
                        <th className="px-2 py-2 text-left font-semibold">Unid</th>
                        <th className="px-2 py-2 text-right font-semibold">Custo</th>
                        <th className="px-2 py-2 text-center font-semibold">IVA</th>
                        <th className="px-2 py-2 text-center font-semibold">A√ß√µes</th>
                      </tr>
                    </thead>
                    <tbody>
                      {ingredientes.map((ing, idx) => (
                        <tr key={ing.id} className={`border-t ${idx % 2 === 0 ? 'bg-white' : 'bg-gray-50'}`}>
                          <td className="px-2 py-2 font-medium">{ing.nome}</td>
                          <td className="px-2 py-2">
                            <span className="text-xs bg-gray-100 px-2 py-1 rounded">{ing.categoria || 'outros'}</span>
                          </td>
                          <td className="px-2 py-2">{ing.unidade}</td>
                          <td className="px-2 py-2 text-right">
                            <div className="text-xs">
                              <div className="font-bold text-gray-900">‚Ç¨{ing.custoUnitario.toFixed(2)}</div>
                              {ing.custoUnitario && ing.iva && (
                                <div className="text-gray-500 text-[10px]">
                                  s/IVA: ‚Ç¨{(ing.custoUnitario / (1 + ing.iva / 100)).toFixed(2)}
                                </div>
                              )}
                            </div>
                          </td>
                          <td className="px-2 py-2 text-center">
                            <span className="px-1.5 py-0.5 bg-blue-100 text-blue-700 rounded text-xs font-semibold">{ing.iva}%</span>
                          </td>
                          <td className="px-2 py-2 text-center">
                            <div className="flex items-center justify-center gap-1">
                              <button onClick={() => editarIngrediente(ing)}
                                className="text-yellow-600 hover:bg-yellow-50 p-1 rounded">
                                <Edit2 size={14} />
                              </button>
                              <button onClick={() => {
                                if (confirm('Eliminar?')) {
                                  setIngredientes(ingredientes.filter(i => i.id !== ing.id));
                                  showNotification('Eliminado!', 'success');
                                }
                              }}
                                className="text-red-600 hover:bg-red-50 p-1 rounded">
                                <Trash2 size={14} />
                              </button>
                            </div>
                          </td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>
                {!ingredientes.length && <p className="text-center text-gray-400 py-6 text-xs">Nenhum ingrediente</p>}
              </div>
            )}

            {gestaoSubTab === 'produtos' && (
              <div className="bg-white rounded-lg shadow p-3">
                <h2 className="text-lg font-bold mb-3">Produtos & Fichas T√©cnicas</h2>
                
                {/* Add Product Form */}
                <div className={`rounded p-3 mb-3 border ${editandoProduto ? 'bg-yellow-50 border-yellow-300' : 'bg-green-50 border-green-200'}`}>
                  <h3 className="font-semibold text-sm mb-2">{editandoProduto ? 'Editar Produto' : 'Adicionar Produto'}</h3>
                  <div className="space-y-3">
                    <div className="grid grid-cols-3 gap-2">
                      <input type="text" placeholder="Nome do produto" value={novoProduto.nome}
                        onChange={(e) => setNovoProduto({ ...novoProduto, nome: e.target.value })}
                        className="border rounded px-2 py-1.5 text-sm" />
                      <input type="number" step="0.01" placeholder="Pre√ßo ‚Ç¨" value={novoProduto.precoVenda}
                        onChange={(e) => setNovoProduto({ ...novoProduto, precoVenda: e.target.value })}
                        className="border rounded px-2 py-1.5 text-sm" />
                      <select value={novoProduto.iva}
                        onChange={(e) => setNovoProduto({ ...novoProduto, iva: e.target.value })}
                        className="border rounded px-2 py-1.5 text-sm">
                        <option value="6">IVA 6%</option>
                        <option value="13">IVA 13%</option>
                        <option value="23">IVA 23%</option>
                      </select>
                    </div>
                    
                    {ingredientes.length > 0 && (
                      <div className="border rounded p-2 bg-white">
                        <p className="font-medium mb-2 text-xs flex items-center gap-1">
                          <FileText size={14} />Receita (Ingredientes):
                        </p>
                        
                        {/* Search bar - SEM √≠cone overlay! */}
                        <div className="relative mb-2">
                          <input 
                            type="text" 
                            placeholder="üîç Procurar ingrediente..." 
                            value={searchIngrediente}
                            onChange={(e) => {
                              setSearchIngrediente(e.target.value);
                              setShowIngredienteSuggestions(e.target.value.length > 0);
                            }}
                            onFocus={() => setShowIngredienteSuggestions(searchIngrediente.length > 0)}
                            className="w-full px-3 py-1.5 border rounded text-sm focus:border-green-500 focus:ring-1 focus:ring-green-200"
                          />
                          
                          {/* Suggestions dropdown */}
                          {showIngredienteSuggestions && searchIngrediente && searchIngrediente.length > 0 && (
                            <div className="absolute z-10 w-full bg-white border rounded shadow-lg mt-1 max-h-40 overflow-y-auto">
                              {ingredientes
                                .filter(ing => 
                                  ing.nome.toLowerCase().includes(searchIngrediente.toLowerCase()) &&
                                  !novoProduto.receita.find(r => r.ingredienteId === ing.id)
                                )
                                .map(ing => (
                                  <button
                                    key={ing.id}
                                    type="button"
                                    onClick={() => {
                                      setNovoProduto({ 
                                        ...novoProduto, 
                                        receita: [...novoProduto.receita, { ingredienteId: ing.id, quantidade: 0, unidade: ing.unidade }] 
                                      });
                                      setSearchIngrediente('');
                                      setShowIngredienteSuggestions(false);
                                    }}
                                    className="w-full text-left px-3 py-2 hover:bg-green-50 flex justify-between items-center text-sm border-b last:border-b-0"
                                  >
                                    <span className="font-medium">{ing.nome}</span>
                                    <span className="text-xs text-gray-500 bg-gray-100 px-2 py-0.5 rounded">
                                      ‚Ç¨{ing.custoUnitario.toFixed(2)}/{ing.unidade}
                                    </span>
                                  </button>
                                ))}
                              {ingredientes.filter(ing => 
                                ing.nome.toLowerCase().includes(searchIngrediente.toLowerCase()) &&
                                !novoProduto.receita.find(r => r.ingredienteId === ing.id)
                              ).length === 0 && (
                                <div className="px-3 py-4 text-gray-400 text-center text-xs">
                                  Nenhum ingrediente encontrado
                                </div>
                              )}
                            </div>
                          )}
                        </div>

                        {/* Selected ingredients */}
                        <div className="space-y-1">
                          {novoProduto.receita.map((item, idx) => {
                            const ing = ingredientes.find(i => i.id === item.ingredienteId);
                            if (!ing) return null;
                            
                            return (
                              <div key={idx} className="flex items-center gap-2 bg-green-50 p-1.5 rounded border border-green-200">
                                <span className="text-xs font-medium flex-1">{ing.nome}</span>
                                <input 
                                  type="number" 
                                  step="0.01" 
                                  placeholder="Qtd"
                                  value={item.quantidade || ''}
                                  onChange={(e) => {
                                    const newReceita = [...novoProduto.receita];
                                    newReceita[idx].quantidade = parseFloat(e.target.value) || 0;
                                    setNovoProduto({ ...novoProduto, receita: newReceita });
                                  }}
                                  className="border rounded px-2 py-1 text-xs w-20" 
                                />
                                <select
                                  value={item.unidade || ing.unidade}
                                  onChange={(e) => {
                                    const newReceita = [...novoProduto.receita];
                                    newReceita[idx].unidade = e.target.value;
                                    setNovoProduto({ ...novoProduto, receita: newReceita });
                                  }}
                                  className="border rounded px-1 py-1 text-xs w-14"
                                >
                                  <option value="kg">kg</option>
                                  <option value="g">g</option>
                                  <option value="L">L</option>
                                  <option value="ml">ml</option>
                                  <option value="un">un</option>
                                </select>
                                <button
                                  type="button"
                                  onClick={() => {
                                    setNovoProduto({ 
                                      ...novoProduto, 
                                      receita: novoProduto.receita.filter((_, i) => i !== idx) 
                                    });
                                  }}
                                  className="text-red-600 hover:text-red-800 hover:bg-red-50 p-1 rounded"
                                >
                                  <Trash2 size={14} />
                                </button>
                              </div>
                            );
                          })}
                          {novoProduto.receita.length === 0 && (
                            <p className="text-center text-gray-400 italic py-2 text-xs">
                              Nenhum ingrediente adicionado. Use a pesquisa acima.
                            </p>
                          )}
                        </div>
                      </div>
                    )}
                    
                    {editandoProduto ? (
                      <div className="flex gap-2">
                        <button onClick={atualizarProduto}
                          className="flex-1 bg-yellow-600 text-white rounded px-4 py-2 text-sm hover:bg-yellow-700 flex items-center justify-center gap-2 font-semibold">
                          <Save size={16} />Atualizar Produto
                        </button>
                        <button onClick={cancelarEdicaoProduto}
                          className="bg-gray-400 text-white rounded px-4 py-2 text-sm hover:bg-gray-500 font-semibold">
                          Cancelar
                        </button>
                      </div>
                    ) : (
                      <button onClick={adicionarProduto}
                        className="w-full bg-green-600 text-white rounded px-4 py-2 text-sm hover:bg-green-700 flex items-center justify-center gap-2 font-semibold">
                        <Plus size={16} />Adicionar Produto
                      </button>
                    )}
                  </div>
                </div>

                {/* Products List */}
                <div className="space-y-2">
                  {produtos.map((p) => {
                    const { custo, margem, margemPercentual } = calcMargem(p);
                    const isExpanded = expandedProduct === p.id;
                    
                    return (
                      <div key={p.id} className="border rounded overflow-hidden hover:shadow transition bg-white">
                        <div className="p-3">
                          <div className="flex justify-between items-start mb-2">
                            <div className="flex-1">
                              <h3 className="font-bold text-base">{p.nome}</h3>
                              <p className="text-xs text-gray-600">
                                Pre√ßo: <span className="font-semibold text-blue-600">‚Ç¨{p.precoVenda.toFixed(2)}</span>
                                <span className="ml-2 px-2 py-0.5 bg-blue-100 text-blue-700 rounded text-xs font-semibold">
                                  IVA {p.iva}%
                                </span>
                                {p.receita && p.receita.some(r => {
                                  const ing = ingredientes.find(i => i.id == r.ingredienteId);
                                  return ing && ing.categoria === 'embalagens';
                                }) && (
                                  <span className="ml-2 px-2 py-0.5 bg-orange-100 text-orange-700 rounded text-xs font-semibold">
                                    üì¶ Take-Away
                                  </span>
                                )}
                              </p>
                            </div>
                            <div className="flex gap-1">
                              {p.receita && p.receita.length > 0 && (
                                <button 
                                  onClick={() => setExpandedProduct(isExpanded ? null : p.id)}
                                  className="text-blue-600 hover:bg-blue-50 p-1.5 rounded transition"
                                  title={isExpanded ? "Ocultar receita" : "Ver receita"}
                                >
                                  {isExpanded ? <ChevronUp size={18} /> : <ChevronDown size={18} />}
                                </button>
                              )}
                              <button onClick={() => editarProduto(p)}
                                className="text-yellow-600 hover:bg-yellow-50 p-1.5 rounded transition">
                                <Edit2 size={18} />
                              </button>
                              <button onClick={() => {
                                if (confirm('Eliminar este produto?')) {
                                  setProdutos(produtos.filter(x => x.id !== p.id));
                                  showNotification('Produto eliminado!', 'success');
                                }
                              }}
                                className="text-red-600 hover:bg-red-50 p-1.5 rounded transition">
                                <Trash2 size={18} />
                              </button>
                            </div>
                          </div>
                          
                          <div className="grid grid-cols-3 gap-2">
                            <div className="bg-red-50 rounded p-2 border border-red-200">
                              <p className="text-xs text-red-700 mb-0.5">Custo</p>
                              <p className="font-bold text-sm text-red-800">‚Ç¨{custo.toFixed(2)}</p>
                            </div>
                            <div className="bg-green-50 rounded p-2 border border-green-200">
                              <p className="text-xs text-green-700 mb-0.5">Margem</p>
                              <p className="font-bold text-sm text-green-800">‚Ç¨{margem.toFixed(2)}</p>
                            </div>
                            <div className="bg-blue-50 rounded p-2 border border-blue-200">
                              <p className="text-xs text-blue-700 mb-0.5">Margem %</p>
                              <p className="font-bold text-sm text-blue-800">{margemPercentual.toFixed(1)}%</p>
                            </div>
                          </div>
                          
                          {isExpanded && p.receita && p.receita.length > 0 && (
                            <div className="mt-3 pt-3 border-t">
                              <p className="text-xs font-bold text-gray-700 mb-2 flex items-center gap-1">
                                <FileText size={12} />Ingredientes da Receita:
                              </p>
                              <div className="space-y-1">
                                {p.receita.map((item, idx) => {
                                  const ing = ingredientes.find(i => i.id === item.ingredienteId);
                                  if (!ing) return null;
                                  const custoParcial = (() => {
                                    let q = item.quantidade;
                                    const unidadeReceita = item.unidade || ing.unidade;
                                    if (ing.unidade === 'kg' && unidadeReceita === 'g') q = item.quantidade / 1000;
                                    if (ing.unidade === 'L' && unidadeReceita === 'ml') q = item.quantidade / 1000;
                                    if (ing.unidade === 'g' && unidadeReceita === 'kg') q = item.quantidade * 1000;
                                    if (ing.unidade === 'ml' && unidadeReceita === 'L') q = item.quantidade * 1000;
                                    if (unidadeReceita === ing.unidade) q = item.quantidade;
                                    return q * ing.custoUnitario;
                                  })();
                                  
                                  return (
                                    <div key={idx} className="flex justify-between items-center text-xs bg-gray-50 p-2 rounded">
                                      <span className="font-medium text-gray-800">{ing.nome}</span>
                                      <div className="flex items-center gap-3">
                                        <span className="text-gray-600">{item.quantidade} {item.unidade || ing.unidade}</span>
                                        <span className="font-semibold text-blue-600">‚Ç¨{custoParcial.toFixed(2)}</span>
                                      </div>
                                    </div>
                                  );
                                })}
                              </div>
                            </div>
                          )}
                        </div>
                      </div>
                    );
                  })}

                </div>
              </div>
            )}

            {gestaoSubTab === 'faturas' && (
              <div className="bg-white rounded-lg shadow p-4">
                <h2 className="text-xl font-bold mb-4 flex items-center gap-2">
                  üõí Gest√£o de Compras
                </h2>
                
                {/* Formul√°rio Nova Compra/Editar */}
                <div className={`rounded-lg p-4 mb-4 border-2 ${editandoFatura ? 'bg-yellow-50 border-yellow-300' : 'bg-blue-50 border-blue-300'}`}>
                  <div className="flex items-center justify-between mb-3">
                    <h3 className="font-semibold text-sm flex items-center gap-2">
                      {editandoFatura ? '‚úèÔ∏è Editar Compra' : '‚ûï Nova Compra'}
                    </h3>
                    
                    {/* Toggle Modo Formul√°rio */}
                    {!editandoFatura && (
                      <div className="flex gap-2 bg-white rounded-lg p-1 border border-gray-300">
                        <button
                          onClick={() => setModoFormulario('completo')}
                          className={`px-3 py-1.5 rounded text-xs font-semibold transition ${
                            modoFormulario === 'completo' 
                              ? 'bg-blue-600 text-white' 
                              : 'text-gray-600 hover:bg-gray-100'
                          }`}
                        >
                          üßæ Fatura Completa
                        </button>
                        <button
                          onClick={() => setModoFormulario('rapido')}
                          className={`px-3 py-1.5 rounded text-xs font-semibold transition ${
                            modoFormulario === 'rapido' 
                              ? 'bg-green-600 text-white' 
                              : 'text-gray-600 hover:bg-gray-100'
                          }`}
                        >
                          ‚ö° Registo R√°pido
                        </button>
                      </div>
                    )}
                  </div>
                  
                  {/* MODO COMPLETO - Fatura com m√∫ltiplos items */}
                  {(modoFormulario === 'completo' || editandoFatura) && (
                    <>
                      {/* Linha 1: N√∫mero, Data, Fornecedor */}
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-3 mb-3">
                        <div>
                          <label className="block text-xs font-medium text-gray-700 mb-1">
                            N√∫mero Fatura *
                          </label>
                          <input
                            type="text"
                            value={novaFatura.numero}
                            onChange={(e) => setNovaFatura({...novaFatura, numero: e.target.value})}
                            placeholder="F/2025/001"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500"
                          />
                        </div>
                        
                        <div>
                          <label className="block text-xs font-medium text-gray-700 mb-1">
                            Data *
                          </label>
                          <input
                            type="date"
                            value={novaFatura.data}
                            onChange={(e) => setNovaFatura({...novaFatura, data: e.target.value})}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500"
                          />
                        </div>
                        
                        <div>
                          <label className="block text-xs font-medium text-gray-700 mb-1">
                            Fornecedor *
                          </label>
                          <select
                            value={novaFatura.fornecedorId}
                            onChange={(e) => setNovaFatura({...novaFatura, fornecedorId: e.target.value})}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500"
                          >
                            <option value="">Selecionar fornecedor...</option>
                            {fornecedores.map(f => (
                              <option key={f.id || f} value={f.id || f}>
                                {f.nome || f} {f.nif ? `(NIF: ${f.nif})` : ''}
                              </option>
                            ))}
                          </select>
                        </div>
                      </div>
                      
                      {/* Items da Fatura */}
                      <div className="border-t border-gray-200 pt-3 mb-3">
                        <h4 className="font-semibold text-sm mb-2">Items da Fatura:</h4>
                        
                        {/* Adicionar Item */}
                        <div className="bg-white rounded-lg border border-gray-300 p-3 mb-3">
                          <div className="grid grid-cols-1 md:grid-cols-6 gap-2">
                            <div className="md:col-span-2">
                          <label className="block text-xs font-medium text-gray-700 mb-1">
                            Ingrediente *
                          </label>
                          <select
                            value={itemFatura.ingredienteId}
                            onChange={(e) => {
                              const ingredienteId = e.target.value;
                              const ing = ingredientes.find(i => i.id == ingredienteId);
                              console.log('Ingrediente selecionado:', ing);
                              setItemFatura({
                                ...itemFatura,
                                ingredienteId: ingredienteId,
                                precoUnitario: ing ? ing.custoUnitario.toString() : '',
                                iva: ing ? ing.iva.toString() : '13'
                              });
                            }}
                            className="w-full px-2 py-1.5 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500"
                          >
                            <option value="">üîç Selecionar ingrediente...</option>
                            {ingredientes.map(ing => (
                              <option key={ing.id} value={ing.id}>
                                {ing.nome} - ‚Ç¨{ing.custoUnitario.toFixed(2)}/{ing.unidade}
                              </option>
                            ))}
                          </select>
                        </div>
                        
                        <div>
                          <label className="block text-xs font-medium text-gray-700 mb-1">
                            Quantidade
                          </label>
                          <input
                            type="number"
                            step="0.01"
                            value={itemFatura.quantidade}
                            onChange={(e) => setItemFatura({...itemFatura, quantidade: e.target.value})}
                            placeholder="0"
                            className="w-full px-2 py-1.5 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500"
                          />
                        </div>
                        
                        <div>
                          <label className="block text-xs font-medium text-gray-700 mb-1">
                            Pre√ßo Unit. (‚Ç¨)
                          </label>
                          <input
                            type="number"
                            step="0.01"
                            value={itemFatura.precoUnitario}
                            onChange={(e) => setItemFatura({...itemFatura, precoUnitario: e.target.value})}
                            placeholder="0.00"
                            className="w-full px-2 py-1.5 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500"
                          />
                        </div>
                        
                        <div>
                          <label className="block text-xs font-medium text-gray-700 mb-1">
                            IVA
                          </label>
                          <select
                            value={itemFatura.iva}
                            onChange={(e) => setItemFatura({...itemFatura, iva: e.target.value})}
                            className="w-full px-2 py-1.5 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500"
                          >
                            <option value="6">6%</option>
                            <option value="13">13%</option>
                            <option value="23">23%</option>
                          </select>
                        </div>
                        
                        <div className="flex items-end">
                          <button
                            onClick={adicionarItemFatura}
                            className="w-full bg-green-600 hover:bg-green-700 text-white px-3 py-1.5 rounded text-sm font-semibold transition flex items-center justify-center gap-1"
                          >
                            <Plus size={14} /> Adicionar
                          </button>
                        </div>
                      </div>
                    </div>
                    
                    {/* Lista de Items */}
                    {novaFatura.items.length > 0 ? (
                      <div className="space-y-2">
                        {novaFatura.items.map(item => (
                          <div key={item.id} className="bg-gray-50 rounded-lg p-3 flex items-center justify-between border border-gray-200">
                            <div className="flex-1">
                              <div className="flex items-center gap-2">
                                <span className="font-semibold text-sm">{item.ingredienteNome}</span>
                                <span className="text-xs text-gray-500">({item.unidade})</span>
                              </div>
                              <div className="text-xs text-gray-600 mt-1">
                                {item.quantidade} √ó ‚Ç¨{item.precoUnitario.toFixed(2)} = <strong>‚Ç¨{item.subtotal.toFixed(2)}</strong>
                                <span className="ml-2 text-gray-500">(IVA {item.iva}%)</span>
                              </div>
                            </div>
                            <button
                              onClick={() => removerItemFatura(item.id)}
                              className="text-red-600 hover:text-red-800 hover:bg-red-50 p-2 rounded transition"
                            >
                              <Trash2 size={16} />
                            </button>
                          </div>
                        ))}
                        
                        {/* Totais */}
                        <div className="bg-blue-50 rounded-lg p-3 border border-blue-200 mt-3">
                          <div className="flex justify-between text-sm mb-1">
                            <span>Subtotal:</span>
                            <span className="font-semibold">‚Ç¨{novaFatura.items.reduce((s, i) => s + i.subtotal, 0).toFixed(2)}</span>
                          </div>
                          <div className="flex justify-between text-sm mb-1">
                            <span>IVA Total:</span>
                            <span className="font-semibold">‚Ç¨{novaFatura.items.reduce((s, i) => s + (i.subtotal * i.iva / 100), 0).toFixed(2)}</span>
                          </div>
                          <div className="flex justify-between text-base font-bold border-t border-blue-300 pt-2 mt-1">
                            <span>Total c/ IVA:</span>
                            <span className="text-blue-700">‚Ç¨{novaFatura.items.reduce((s, i) => s + (i.subtotal * (1 + i.iva / 100)), 0).toFixed(2)}</span>
                          </div>
                        </div>
                      </div>
                    ) : (
                      <div className="text-center text-gray-500 text-sm py-4 bg-gray-50 rounded-lg border border-dashed border-gray-300">
                        Nenhum item adicionado. Adicione items acima.
                      </div>
                    )}
                  </div>
                  
                  {/* Notas */}
                  <div className="mb-3">
                    <label className="block text-xs font-medium text-gray-700 mb-1">
                      Notas (opcional)
                    </label>
                    <textarea
                      value={novaFatura.notas}
                      onChange={(e) => setNovaFatura({...novaFatura, notas: e.target.value})}
                      placeholder="Observa√ß√µes sobre a fatura..."
                      rows={2}
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500"
                    />
                  </div>
                  
                  {/* Bot√µes */}
                  <div className="flex gap-2">
                    {editandoFatura ? (
                      <>
                        <button
                          onClick={atualizarFatura}
                          className="flex-1 bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded-lg font-semibold transition flex items-center justify-center gap-2"
                        >
                          <Save size={16} /> Atualizar Fatura
                        </button>
                        <button
                          onClick={cancelarEdicaoFatura}
                          className="bg-gray-400 hover:bg-gray-500 text-white px-4 py-2 rounded-lg font-semibold transition"
                        >
                          Cancelar
                        </button>
                      </>
                    ) : (
                      <button
                        onClick={salvarFatura}
                        className="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-semibold transition flex items-center justify-center gap-2"
                      >
                        <Save size={16} /> Guardar Fatura
                      </button>
                    )}
                  </div>
                </>
              )}
              
              {/* MODO R√ÅPIDO - Registo r√°pido com 1 item */}
              {modoFormulario === 'rapido' && !editandoFatura && (
                <>
                  <div className="bg-green-50 rounded-lg p-4 border border-green-200 mb-3">
                    <p className="text-xs text-green-800 mb-3">
                      <strong>‚ö° Registo R√°pido:</strong> Preencha apenas um item. O n√∫mero ser√° gerado automaticamente (RR/2025/XXX).
                    </p>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-3 mb-3">
                      <div>
                        <label className="block text-xs font-medium text-gray-700 mb-1">
                          Data *
                        </label>
                        <input
                          type="date"
                          value={novaFatura.data}
                          onChange={(e) => setNovaFatura({...novaFatura, data: e.target.value})}
                          className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-green-500"
                        />
                      </div>
                      
                      <div>
                        <label className="block text-xs font-medium text-gray-700 mb-1">
                          Fornecedor *
                        </label>
                        <select
                          value={novaFatura.fornecedorId}
                          onChange={(e) => setNovaFatura({...novaFatura, fornecedorId: e.target.value})}
                          className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-green-500"
                        >
                          <option value="">Selecionar fornecedor...</option>
                          {fornecedores.map(f => (
                            <option key={f.id || f} value={f.id || f}>
                              {f.nome || f} {f.nif ? `(NIF: ${f.nif})` : ''}
                            </option>
                          ))}
                        </select>
                      </div>
                    </div>
                    
                    <div className="grid grid-cols-1 md:grid-cols-4 gap-3 mb-3">
                      <div className="md:col-span-2">
                        <label className="block text-xs font-medium text-gray-700 mb-1">
                          Ingrediente/Produto *
                        </label>
                        <select
                          value={itemFatura.ingredienteId}
                          onChange={(e) => {
                            const ingredienteId = e.target.value;
                            const ing = ingredientes.find(i => i.id == ingredienteId);
                            console.log('Ingrediente selecionado (r√°pido):', ing);
                            setItemFatura({
                              ...itemFatura,
                              ingredienteId: ingredienteId,
                              precoUnitario: ing ? ing.custoUnitario.toString() : '',
                              iva: ing ? ing.iva.toString() : '13'
                            });
                          }}
                          className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-green-500"
                        >
                          <option value="">üîç Selecionar ingrediente...</option>
                          {ingredientes.map(ing => (
                            <option key={ing.id} value={ing.id}>
                              {ing.nome} - ‚Ç¨{ing.custoUnitario.toFixed(2)}/{ing.unidade}
                            </option>
                          ))}
                        </select>
                      </div>
                      
                      <div>
                        <label className="block text-xs font-medium text-gray-700 mb-1">
                          Quantidade *
                        </label>
                        <input
                          type="number"
                          step="0.01"
                          value={itemFatura.quantidade}
                          onChange={(e) => setItemFatura({...itemFatura, quantidade: e.target.value})}
                          placeholder="0"
                          className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-green-500"
                        />
                      </div>
                      
                      <div>
                        <label className="block text-xs font-medium text-gray-700 mb-1">
                          Pre√ßo Unit. (‚Ç¨) *
                        </label>
                        <input
                          type="number"
                          step="0.01"
                          value={itemFatura.precoUnitario}
                          onChange={(e) => setItemFatura({...itemFatura, precoUnitario: e.target.value})}
                          placeholder="0.00"
                          className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-green-500"
                        />
                      </div>
                    </div>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-3 mb-3">
                      <div>
                        <label className="block text-xs font-medium text-gray-700 mb-1">
                          IVA
                        </label>
                        <select
                          value={itemFatura.iva}
                          onChange={(e) => setItemFatura({...itemFatura, iva: e.target.value})}
                          className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-green-500"
                        >
                          <option value="6">6%</option>
                          <option value="13">13%</option>
                          <option value="23">23%</option>
                        </select>
                      </div>
                    </div>
                    
                    <div className="mb-3">
                      <label className="block text-xs font-medium text-gray-700 mb-1">
                        Notas (opcional)
                      </label>
                      <input
                        type="text"
                        value={novaFatura.notas}
                        onChange={(e) => setNovaFatura({...novaFatura, notas: e.target.value})}
                        placeholder="Observa√ß√µes..."
                        className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-green-500"
                      />
                    </div>
                    
                    {/* Preview do Total */}
                    {itemFatura.quantidade && itemFatura.precoUnitario && (
                      <div className="bg-white rounded-lg p-3 border border-green-300 mb-3">
                        <div className="flex justify-between text-sm">
                          <span>Total:</span>
                          <span className="font-bold text-green-700">
                            ‚Ç¨{(parseFloat(itemFatura.quantidade || 0) * parseFloat(itemFatura.precoUnitario || 0) * (1 + parseFloat(itemFatura.iva) / 100)).toFixed(2)}
                          </span>
                        </div>
                      </div>
                    )}
                    
                    <button
                      onClick={salvarFaturaRapida}
                      className="w-full bg-green-600 hover:bg-green-700 text-white px-4 py-2.5 rounded-lg font-semibold transition flex items-center justify-center gap-2"
                    >
                      <Save size={16} /> Guardar Compra R√°pida
                    </button>
                  </div>
                </>
              )}
            </div>
                
                {/* Lista de Faturas */}
                <div>
                  <h3 className="font-semibold text-sm mb-3 flex items-center justify-between">
                    <span>üõí Compras Registadas ({faturas.length})</span>
                  </h3>
                  
                  {faturas.length === 0 ? (
                    <div className="text-center text-gray-500 text-sm py-8 bg-gray-50 rounded-lg border border-dashed border-gray-300">
                      Nenhuma fatura registada. Crie a primeira fatura acima!
                    </div>
                  ) : (
                    <div className="space-y-3">
                      {faturas.sort((a, b) => new Date(b.data) - new Date(a.data)).map(fatura => (
                        <div key={fatura.id} className="border rounded-lg overflow-hidden hover:shadow-md transition">
                          {/* Cabe√ßalho da Fatura (sempre vis√≠vel) */}
                          <div 
                            onClick={() => setExpandedFatura(expandedFatura === fatura.id ? null : fatura.id)}
                            className="bg-gradient-to-r from-blue-50 to-purple-50 p-4 cursor-pointer hover:from-blue-100 hover:to-purple-100 transition"
                          >
                            <div className="flex items-center justify-between">
                              <div className="flex-1">
                                <div className="flex items-center gap-3 mb-1">
                                  <span className="font-bold text-blue-700">
                                    {fatura.tipo === 'rapido' ? '‚ö°' : 'üìÑ'} {fatura.numero}
                                  </span>
                                  {fatura.tipo === 'rapido' && (
                                    <span className="text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded font-semibold">
                                      R√ÅPIDO
                                    </span>
                                  )}
                                  {fatura.tipo === 'completa' && (
                                    <span className="text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded font-semibold">
                                      FATURA
                                    </span>
                                  )}
                                  <span className="text-sm text-gray-600">{fatura.fornecedorNome}</span>
                                  <span className="text-xs text-gray-500">{new Date(fatura.data).toLocaleDateString('pt-PT')}</span>
                                </div>
                                <div className="flex items-center gap-4 text-sm">
                                  <span className="text-gray-600">{fatura.items.length} {fatura.items.length === 1 ? 'item' : 'items'}</span>
                                  <span className="font-bold text-blue-700">Total: ‚Ç¨{fatura.total.toFixed(2)}</span>
                                </div>
                              </div>
                              <div className="flex items-center gap-2">
                                <button
                                  onClick={(e) => {
                                    e.stopPropagation();
                                    editarFatura(fatura);
                                  }}
                                  className="text-yellow-600 hover:text-yellow-800 hover:bg-yellow-50 p-2 rounded transition"
                                >
                                  <Edit2 size={16} />
                                </button>
                                <button
                                  onClick={(e) => {
                                    e.stopPropagation();
                                    apagarFatura(fatura.id);
                                  }}
                                  className="text-red-600 hover:text-red-800 hover:bg-red-50 p-2 rounded transition"
                                >
                                  <Trash2 size={16} />
                                </button>
                                <button className="text-gray-600">
                                  {expandedFatura === fatura.id ? <ChevronUp size={20} /> : <ChevronDown size={20} />}
                                </button>
                              </div>
                            </div>
                          </div>
                          
                          {/* Detalhes da Fatura (expans√≠vel) */}
                          {expandedFatura === fatura.id && (
                            <div className="bg-white p-4 border-t">
                              <div className="mb-3">
                                <h4 className="font-semibold text-sm mb-2 text-gray-700">Fornecedor:</h4>
                                <div className="bg-gray-50 rounded p-2 text-sm">
                                  <p><strong>{fatura.fornecedorNome}</strong></p>
                                  {fatura.fornecedorNif && <p className="text-gray-600 text-xs">NIF: {fatura.fornecedorNif}</p>}
                                </div>
                              </div>
                              
                              <div className="mb-3">
                                <h4 className="font-semibold text-sm mb-2 text-gray-700">Items:</h4>
                                <div className="space-y-2">
                                  {fatura.items.map(item => (
                                    <div key={item.id} className="bg-gray-50 rounded p-3 text-sm">
                                      <div className="flex justify-between items-start mb-1">
                                        <span className="font-medium">{item.ingredienteNome}</span>
                                        <span className="font-semibold text-blue-700">‚Ç¨{item.subtotal.toFixed(2)}</span>
                                      </div>
                                      <div className="text-xs text-gray-600">
                                        {item.quantidade} {item.unidade} √ó ‚Ç¨{item.precoUnitario.toFixed(2)}
                                        <span className="ml-2">(IVA {item.iva}%: +‚Ç¨{(item.subtotal * item.iva / 100).toFixed(2)})</span>
                                      </div>
                                    </div>
                                  ))}
                                </div>
                              </div>
                              
                              <div className="bg-blue-50 rounded p-3 border border-blue-200">
                                <div className="flex justify-between text-sm mb-1">
                                  <span>Subtotal:</span>
                                  <span className="font-semibold">‚Ç¨{fatura.subtotal.toFixed(2)}</span>
                                </div>
                                <div className="flex justify-between text-sm mb-1">
                                  <span>IVA Total:</span>
                                  <span className="font-semibold">‚Ç¨{fatura.totalIva.toFixed(2)}</span>
                                </div>
                                <div className="flex justify-between text-base font-bold border-t border-blue-300 pt-2 mt-1">
                                  <span>Total c/ IVA:</span>
                                  <span className="text-blue-700">‚Ç¨{fatura.total.toFixed(2)}</span>
                                </div>
                              </div>
                              
                              {fatura.notas && (
                                <div className="mt-3 bg-yellow-50 rounded p-2 border border-yellow-200">
                                  <p className="text-xs text-gray-700"><strong>Notas:</strong> {fatura.notas}</p>
                                </div>
                              )}
                            </div>
                          )}
                        </div>
                      ))}
                    </div>
                  )}
                </div>
              </div>
            )}

            {gestaoSubTab === 'vendas' && (
              <div className="bg-white rounded-lg shadow p-3">
                <h2 className="text-lg font-bold mb-3">Importar Vendas do Moloni</h2>
                
                <div className="bg-blue-50 border border-blue-200 rounded p-3 mb-4">
                  <h3 className="font-semibold text-sm mb-2">Como importar:</h3>
                  <ol className="text-xs space-y-1 list-decimal list-inside">
                    <li>Exporte dados do Moloni em formato CSV</li>
                    <li>Clique no bot√£o abaixo para selecionar o ficheiro</li>
                    <li>As vendas ser√£o importadas automaticamente!</li>
                  </ol>
                </div>
                
                <div className="mb-4">
                  <label className="bg-blue-600 text-white rounded px-6 py-3 text-sm hover:bg-blue-700 cursor-pointer inline-flex items-center gap-2 font-semibold shadow hover:shadow-lg transition">
                    <Upload size={18} />Escolher Ficheiro CSV do Moloni
                    <input type="file" accept=".csv,.txt" onChange={processarFicheiro} className="hidden" />
                  </label>
                </div>

                {/* Sales Table */}
                <div className="overflow-x-auto rounded border">
                  <table className="w-full text-xs">
                    <thead className="bg-gray-50">
                      <tr>
                        <th className="px-2 py-2 text-left font-semibold">Data</th>
                        <th className="px-2 py-2 text-left font-semibold">Produto</th>
                        <th className="px-2 py-2 text-right font-semibold">Quantidade</th>
                        <th className="px-2 py-2 text-right font-semibold">Valor</th>
                        <th className="px-2 py-2 text-center font-semibold">IVA</th>
                        <th className="px-2 py-2 text-center font-semibold">A√ß√µes</th>
                      </tr>
                    </thead>
                    <tbody>
                      {vendas.sort((a, b) => new Date(b.data) - new Date(a.data)).slice(0, 100).map((v, idx) => (
                        <tr key={v.id} className={`border-t hover:bg-gray-50 ${idx % 2 === 0 ? 'bg-white' : 'bg-gray-50'}`}>
                          <td className="px-2 py-2">{new Date(v.data).toLocaleDateString('pt-PT')}</td>
                          <td className="px-2 py-2 font-medium">{v.produto}</td>
                          <td className="px-2 py-2 text-right">{v.quantidade}</td>
                          <td className="px-2 py-2 text-right font-bold text-green-600">‚Ç¨{v.valor.toFixed(2)}</td>
                          <td className="px-2 py-2 text-center">
                            <span className="px-2 py-0.5 bg-blue-100 text-blue-700 rounded text-xs font-semibold">
                              {v.iva}%
                            </span>
                          </td>
                          <td className="px-2 py-2 text-center">
                            <button onClick={() => {
                              if (confirm('Eliminar esta venda?')) {
                                setVendas(vendas.filter(x => x.id !== v.id));
                                showNotification('Venda eliminada!', 'success');
                              }
                            }}
                              className="text-red-600 hover:bg-red-50 p-1 rounded">
                              <Trash2 size={14} />
                            </button>
                          </td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>
                
                {vendas.length > 100 && (
                  <p className="text-center text-xs text-gray-500 mt-2">
                    A mostrar as 100 vendas mais recentes de {vendas.length} totais
                  </p>
                )}
                
                {!vendas.length && (
                  <div className="text-center py-12">
                    <Upload size={48} className="mx-auto text-gray-300 mb-3" />
                    <p className="text-gray-400 text-sm">Nenhuma venda importada</p>
                    <p className="text-gray-400 text-xs mt-1">Importe um ficheiro CSV do Moloni</p>
                  </div>
                )}
              </div>
            )}
          </div>
        )}

        {/* TAB DEFINI√á√ïES */}
        {activeTab === 'definicoes' && (
          <div className="space-y-3">
            <div className="bg-white rounded-lg shadow p-6">
              <h2 className="text-2xl font-bold mb-4">
                ‚öôÔ∏è Defini√ß√µes
              </h2>
              <p className="text-gray-600 mb-6">Configure as prefer√™ncias do Munchi Manager</p>
              
              <div className="space-y-6">
                {/* Dados da Empresa */}
                <div className="border rounded-lg overflow-hidden bg-gradient-to-r from-blue-50 to-purple-50">
                  <button
                    onClick={() => setDadosEmpresaExpanded(!dadosEmpresaExpanded)}
                    className="w-full p-4 flex items-center justify-between hover:bg-blue-100 transition"
                  >
                    <div>
                      <h3 className="font-bold text-lg flex items-center gap-2">
                        üè¢ Dados da Empresa
                      </h3>
                      <p className="text-sm text-gray-600 text-left mt-1">
                        Informa√ß√µes fiscais da sua empresa
                      </p>
                    </div>
                    {dadosEmpresaExpanded ? <ChevronUp size={24} /> : <ChevronDown size={24} />}
                  </button>
                  
                  {dadosEmpresaExpanded && (
                    <div className="p-4 border-t border-blue-200 bg-white">
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1">
                        NIF/NIPC *
                      </label>
                      <input
                        type="text"
                        value={dadosEmpresa.nif}
                        onChange={(e) => setDadosEmpresa({...dadosEmpresa, nif: e.target.value})}
                        placeholder="123456789"
                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                      />
                    </div>
                    
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1">
                        Nome da Empresa *
                      </label>
                      <input
                        type="text"
                        value={dadosEmpresa.nome}
                        onChange={(e) => setDadosEmpresa({...dadosEmpresa, nome: e.target.value})}
                        placeholder="Munchi Restaurant, Lda"
                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                      />
                    </div>
                    
                    <div className="md:col-span-2">
                      <label className="block text-sm font-medium text-gray-700 mb-1">
                        Morada Fiscal
                      </label>
                      <input
                        type="text"
                        value={dadosEmpresa.morada}
                        onChange={(e) => setDadosEmpresa({...dadosEmpresa, morada: e.target.value})}
                        placeholder="Rua Example, 123"
                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                      />
                    </div>
                    
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1">
                        C√≥digo Postal
                      </label>
                      <input
                        type="text"
                        value={dadosEmpresa.codigoPostal}
                        onChange={(e) => setDadosEmpresa({...dadosEmpresa, codigoPostal: e.target.value})}
                        placeholder="1000-001"
                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                      />
                    </div>
                    
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1">
                        Cidade
                      </label>
                      <input
                        type="text"
                        value={dadosEmpresa.cidade}
                        onChange={(e) => setDadosEmpresa({...dadosEmpresa, cidade: e.target.value})}
                        placeholder="Lisboa"
                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                      />
                    </div>
                    
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1">
                        CAE (C√≥digo Atividade)
                      </label>
                      <input
                        type="text"
                        value={dadosEmpresa.cae}
                        onChange={(e) => setDadosEmpresa({...dadosEmpresa, cae: e.target.value})}
                        placeholder="56101"
                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                      />
                    </div>
                    
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1">
                        Email
                      </label>
                      <input
                        type="email"
                        value={dadosEmpresa.email}
                        onChange={(e) => setDadosEmpresa({...dadosEmpresa, email: e.target.value})}
                        placeholder="geral@munchi.pt"
                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                      />
                    </div>
                    
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1">
                        Telefone
                      </label>
                      <input
                        type="tel"
                        value={dadosEmpresa.telefone}
                        onChange={(e) => setDadosEmpresa({...dadosEmpresa, telefone: e.target.value})}
                        placeholder="+351 21 123 4567"
                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                      />
                    </div>
                  </div>
                  
                  <div className="mt-4 bg-blue-50 border border-blue-200 rounded-lg p-3">
                    <p className="text-xs text-blue-800">
                      <strong>üí° Dica:</strong> Estes dados ser√£o inclu√≠dos nos exports CSV para o contabilista e em futuros exports certificados (SAF-T).
                    </p>
                  </div>
                  
                  {(dadosEmpresa.nif && dadosEmpresa.nome) && (
                    <div className="mt-3 bg-green-50 border border-green-200 rounded-lg p-3 flex items-center gap-2">
                      <span className="text-green-600">‚úÖ</span>
                      <p className="text-xs text-green-800 font-medium">
                        Dados da empresa configurados!
                      </p>
                    </div>
                  )}
                </div>
              )}
                </div>
                
                {/* Fornecedores */}
                <div className="border rounded-lg overflow-hidden bg-gradient-to-r from-purple-50 to-pink-50">
                  <button
                    onClick={() => setFornecedoresExpanded(!fornecedoresExpanded)}
                    className="w-full p-4 flex items-center justify-between hover:bg-purple-100 transition"
                  >
                    <div>
                      <h3 className="font-bold text-lg flex items-center gap-2">
                        üë• Fornecedores
                      </h3>
                      <p className="text-sm text-gray-600 text-left mt-1">
                        Gerir contactos de fornecedores
                      </p>
                    </div>
                    {fornecedoresExpanded ? <ChevronUp size={24} /> : <ChevronDown size={24} />}
                  </button>
                  
                  {fornecedoresExpanded && (
                    <div className="p-4 border-t border-purple-200 bg-white">
                      {/* Formul√°rio Novo Fornecedor */}
                      <div className="bg-purple-50 rounded-lg p-4 mb-4 border-2 border-purple-200">
                        <h4 className="font-semibold text-sm mb-3">‚ûï Adicionar Fornecedor</h4>
                        
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                          <div>
                            <label className="block text-xs font-medium text-gray-700 mb-1">
                              Nome do Fornecedor *
                            </label>
                            <input
                              type="text"
                              id="fornecedor-nome"
                              placeholder="Ex: Mercearia Silva"
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-purple-500"
                            />
                          </div>
                          
                          <div>
                            <label className="block text-xs font-medium text-gray-700 mb-1">
                              NIF
                            </label>
                            <input
                              type="text"
                              id="fornecedor-nif"
                              placeholder="123456789"
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-purple-500"
                            />
                          </div>
                          
                          <div className="md:col-span-2">
                            <label className="block text-xs font-medium text-gray-700 mb-1">
                              Morada
                            </label>
                            <input
                              type="text"
                              id="fornecedor-morada"
                              placeholder="Rua Example, 123"
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-purple-500"
                            />
                          </div>
                          
                          <div>
                            <label className="block text-xs font-medium text-gray-700 mb-1">
                              Email
                            </label>
                            <input
                              type="email"
                              id="fornecedor-email"
                              placeholder="contacto@fornecedor.pt"
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-purple-500"
                            />
                          </div>
                          
                          <div>
                            <label className="block text-xs font-medium text-gray-700 mb-1">
                              Telefone
                            </label>
                            <input
                              type="tel"
                              id="fornecedor-telefone"
                              placeholder="+351 21 123 4567"
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-purple-500"
                            />
                          </div>
                        </div>
                        
                        <button
                          onClick={() => {
                            const nome = document.getElementById('fornecedor-nome').value;
                            const nif = document.getElementById('fornecedor-nif').value;
                            const morada = document.getElementById('fornecedor-morada').value;
                            const email = document.getElementById('fornecedor-email').value;
                            const telefone = document.getElementById('fornecedor-telefone').value;
                            
                            if (!nome) {
                              showNotification('Preencha o nome do fornecedor!', 'error');
                              return;
                            }
                            
                            adicionarFornecedor(nome, nif, morada, email, telefone);
                            
                            // Limpar campos
                            document.getElementById('fornecedor-nome').value = '';
                            document.getElementById('fornecedor-nif').value = '';
                            document.getElementById('fornecedor-morada').value = '';
                            document.getElementById('fornecedor-email').value = '';
                            document.getElementById('fornecedor-telefone').value = '';
                            
                            showNotification('Fornecedor adicionado!', 'success');
                          }}
                          className="w-full mt-3 bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg font-semibold transition flex items-center justify-center gap-2"
                        >
                          <Plus size={16} /> Adicionar Fornecedor
                        </button>
                      </div>
                      
                      {/* Lista de Fornecedores */}
                      <div>
                        <h4 className="font-semibold text-sm mb-3">
                          üìã Fornecedores Registados ({fornecedores.length})
                        </h4>
                        
                        {fornecedores.length === 0 ? (
                          <div className="text-center text-gray-500 text-sm py-6 bg-gray-50 rounded-lg border border-dashed border-gray-300">
                            Nenhum fornecedor registado.
                          </div>
                        ) : (
                          <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                            {fornecedores.map(fornecedor => {
                              const isOldFormat = typeof fornecedor === 'string';
                              const id = isOldFormat ? fornecedor : fornecedor.id;
                              const nome = isOldFormat ? fornecedor : fornecedor.nome;
                              const nif = isOldFormat ? '' : fornecedor.nif;
                              const morada = isOldFormat ? '' : fornecedor.morada;
                              const email = isOldFormat ? '' : fornecedor.email;
                              const telefone = isOldFormat ? '' : fornecedor.telefone;
                              
                              return (
                                <div key={id} className="bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg p-3 border border-purple-200">
                                  <div className="flex items-start justify-between mb-2">
                                    <div className="flex-1">
                                      <h5 className="font-bold text-purple-900 text-sm">{nome}</h5>
                                      {nif && <p className="text-xs text-gray-600 mt-1">NIF: {nif}</p>}
                                    </div>
                                    {!isOldFormat && (
                                      <button
                                        onClick={() => apagarFornecedor(id)}
                                        className="text-red-600 hover:text-red-800 hover:bg-red-50 p-1 rounded transition"
                                      >
                                        <Trash2 size={14} />
                                      </button>
                                    )}
                                  </div>
                                  
                                  {!isOldFormat && (
                                    <div className="text-xs text-gray-600 space-y-1">
                                      {morada && <p>üìç {morada}</p>}
                                      {email && <p>‚úâÔ∏è {email}</p>}
                                      {telefone && <p>üìû {telefone}</p>}
                                    </div>
                                  )}
                                  
                                  <div className="mt-2 pt-2 border-t border-purple-200 flex items-center justify-between text-xs">
                                    <span className="text-gray-600">
                                      Compras: <strong>{faturas.filter(f => f.fornecedorId === id).length}</strong>
                                    </span>
                                    <span className="text-gray-600">
                                      Total: <strong>‚Ç¨{faturas.filter(f => f.fornecedorId === id).reduce((sum, f) => sum + f.total, 0).toFixed(2)}</strong>
                                    </span>
                                  </div>
                                </div>
                              );
                            })}
                          </div>
                        )}
                      </div>
                    </div>
                  )}
                </div>
                
                {/* Apps de Delivery */}
                <div className="border rounded-lg overflow-hidden shadow-sm bg-gradient-to-br from-orange-50 to-yellow-50 border-orange-200">
                  <button
                    onClick={() => setDeliveryAppsExpanded(!deliveryAppsExpanded)}
                    className="w-full p-4 flex items-center justify-between hover:bg-orange-100 transition"
                  >
                    <div>
                      <h3 className="font-bold text-lg flex items-center gap-2">
                        üöó Apps de Delivery
                      </h3>
                      <p className="text-sm text-gray-600 text-left mt-1">
                        Configurar Uber Eats, Glovo, Bolt Food, etc
                      </p>
                    </div>
                    {deliveryAppsExpanded ? <ChevronUp size={24} /> : <ChevronDown size={24} />}
                  </button>
                  
                  {deliveryAppsExpanded && (
                    <div className="p-4 border-t border-orange-200 bg-white">
                      <p className="text-xs text-gray-600 mb-4">
                        üí° Ative as apps que utiliza para ver simula√ß√µes de pre√ßos e margens no Dashboard
                      </p>
                      
                      {/* Lista de Apps */}
                      <div className="space-y-3 mb-4">
                        {deliveryApps.map(app => (
                          <div key={app.id} className={`border-2 rounded-lg p-3 ${app.ativo ? 'border-green-300 bg-green-50' : 'border-gray-200 bg-gray-50'}`}>
                            <div className="flex items-center justify-between mb-2">
                              <div className="flex items-center gap-3">
                                <button
                                  onClick={() => toggleApp(app.id)}
                                  className={`w-12 h-6 rounded-full transition ${app.ativo ? 'bg-green-500' : 'bg-gray-300'} relative`}
                                >
                                  <div className={`w-5 h-5 rounded-full bg-white absolute top-0.5 transition-all ${app.ativo ? 'left-6' : 'left-0.5'}`}></div>
                                </button>
                                <div>
                                  <h4 className="font-bold text-sm">{app.nome}</h4>
                                  <p className="text-xs text-gray-500">
                                    {app.ativo ? '‚úÖ Ativa' : '‚ùå Inativa'}
                                  </p>
                                </div>
                              </div>
                              
                              <button
                                onClick={() => apagarApp(app.id)}
                                className="text-red-600 hover:bg-red-50 p-1 rounded"
                                title="Apagar app"
                              >
                                <Trash2 size={16} />
                              </button>
                            </div>
                            
                            <div className="grid grid-cols-2 gap-2">
                              <div>
                                <label className="block text-xs text-gray-600 mb-1">Comiss√£o (%)</label>
                                {editandoApp === app.id ? (
                                  <div className="flex gap-1">
                                    <input
                                      type="number"
                                      step="0.1"
                                      defaultValue={app.comissao}
                                      id={`comissao-${app.id}`}
                                      className="w-full px-2 py-1 border rounded text-sm"
                                    />
                                    <button
                                      onClick={() => {
                                        const novaComissao = document.getElementById(`comissao-${app.id}`).value;
                                        atualizarComissaoApp(app.id, novaComissao);
                                      }}
                                      className="bg-green-500 text-white px-2 rounded hover:bg-green-600"
                                    >
                                      ‚úì
                                    </button>
                                  </div>
                                ) : (
                                  <div className="flex items-center gap-2">
                                    <span className="font-bold text-lg">{app.comissao}%</span>
                                    <button
                                      onClick={() => setEditandoApp(app.id)}
                                      className="text-blue-600 hover:bg-blue-50 p-1 rounded"
                                    >
                                      <Edit2 size={14} />
                                    </button>
                                  </div>
                                )}
                              </div>
                              
                              <div>
                                <label className="block text-xs text-gray-600 mb-1">√öltima atualiza√ß√£o</label>
                                <span className="text-xs text-gray-500">{new Date(app.dataAtualizacao).toLocaleDateString('pt-PT')}</span>
                              </div>
                            </div>
                          </div>
                        ))}
                      </div>
                      
                      {/* Adicionar Nova App */}
                      <div className="bg-orange-50 rounded-lg p-3 border-2 border-orange-200">
                        <h4 className="font-semibold text-sm mb-2">‚ûï Adicionar Nova App</h4>
                        <div className="grid grid-cols-2 gap-2">
                          <input
                            type="text"
                            placeholder="Nome (ex: Just Eat)"
                            value={novaApp.nome}
                            onChange={(e) => setNovaApp({...novaApp, nome: e.target.value})}
                            className="px-2 py-1.5 border rounded text-sm"
                          />
                          <div className="flex gap-1">
                            <input
                              type="number"
                              step="0.1"
                              placeholder="Comiss√£o %"
                              value={novaApp.comissao}
                              onChange={(e) => setNovaApp({...novaApp, comissao: e.target.value})}
                              className="flex-1 px-2 py-1.5 border rounded text-sm"
                            />
                            <button
                              onClick={adicionarNovaApp}
                              className="bg-orange-500 text-white px-3 rounded hover:bg-orange-600 font-semibold text-sm"
                            >
                              +
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                  )}
                </div>
                
                {/* Backup e Dados */}
                <div className="border rounded-lg p-4 bg-gradient-to-r from-green-50 to-blue-50">
                  <h3 className="font-bold text-lg mb-3 flex items-center gap-2">
                    üíæ Backup e Dados
                  </h3>
                  <p className="text-sm text-gray-600 mb-4">
                    Exporte os seus dados para criar uma c√≥pia de seguran√ßa ou importe dados de um ficheiro anterior.
                  </p>
                  
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-3">
                    {/* Exportar */}
                    <div className="bg-white rounded-lg p-4 border-2 border-green-200">
                      <h4 className="font-semibold text-green-800 mb-2 flex items-center gap-2">
                        <Download size={16} />
                        Exportar Dados
                      </h4>
                      <p className="text-xs text-gray-600 mb-3">
                        Guarde todos os dados num ficheiro JSON.
                      </p>
                      <button 
                        onClick={exportarDados}
                        className="w-full bg-green-600 hover:bg-green-700 text-white rounded-lg px-4 py-2.5 text-sm font-semibold flex items-center justify-center gap-2 transition"
                      >
                        <Download size={14} />
                        Exportar
                      </button>
                    </div>
                    
                    {/* Importar */}
                    <div className="bg-white rounded-lg p-4 border-2 border-blue-200">
                      <h4 className="font-semibold text-blue-800 mb-2 flex items-center gap-2">
                        <Upload size={16} />
                        Importar Dados
                      </h4>
                      <p className="text-xs text-gray-600 mb-3">
                        Restaure dados de backup. ‚ö†Ô∏è Substitui tudo.
                      </p>
                      <label className="w-full bg-blue-600 hover:bg-blue-700 text-white rounded-lg px-4 py-2.5 text-sm font-semibold flex items-center justify-center gap-2 transition cursor-pointer">
                        <Upload size={14} />
                        Importar
                        <input type="file" accept=".json" onChange={importarDados} className="hidden" />
                      </label>
                    </div>
                    
                    {/* GitHub Backup Cloud */}
    <GitHubBackupPanel 
      onSync={async () => {
        const token = GitHubSync.getToken();
        if (!token) {
          showNotification('Configure o GitHub primeiro!', 'error');
          return;
        }
        
        const allData = {
          produtos,
          ingredientes,
          vendas,
          despesas,
          faturas,
          fornecedores,
          deliveryApps,
          embalagens,
          dadosEmpresa,
          version: '2.0'
        };
        
        const result = await GitHubSync.saveToGist(allData, token);
        if (result.success) {
          showNotification('‚úÖ Backup sincronizado com GitHub!', 'success');
        } else {
          showNotification(`‚ùå Erro: ${result.error}`, 'error');
        }
      }}
    />
  </div>
                  
                  <div className="mt-4 bg-yellow-50 border border-yellow-200 rounded-lg p-3">
                    <p className="text-xs text-yellow-800">
                      <strong>üí° GitHub:</strong> Backup autom√°tico e seguro na cloud. Configure o token nas defini√ß√µes acima.
                    </p>
                  </div>
                </div>
                
                {/* Exportar para Excel/CSV */}
                <div className="border rounded-lg p-4 bg-gradient-to-r from-purple-50 to-pink-50">
                  <h3 className="font-bold text-lg mb-3 flex items-center gap-2">
                    üìä Exportar para Excel/CSV
                  </h3>
                  <p className="text-sm text-gray-600 mb-4">
                    Exporte vendas e despesas em formato CSV para abrir no Excel ou enviar ao contabilista.
                  </p>
                  
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                    {/* Exportar Vendas */}
                    <div className="bg-white rounded-lg p-4 border-2 border-purple-200">
                      <h4 className="font-semibold text-purple-800 mb-2 flex items-center gap-2">
                        <Download size={16} />
                        Exportar Vendas
                      </h4>
                      <p className="text-xs text-gray-600 mb-3">
                        Ficheiro CSV com todas as vendas do per√≠odo selecionado (respeita filtros de data).
                      </p>
                      <button 
                        onClick={exportarVendasCSV}
                        className="w-full bg-purple-600 hover:bg-purple-700 text-white rounded-lg px-4 py-2.5 text-sm font-semibold flex items-center justify-center gap-2 transition"
                      >
                        <Download size={14} />
                        Exportar Vendas CSV
                      </button>
                    </div>
                    
                    {/* Exportar Despesas */}
                    <div className="bg-white rounded-lg p-4 border-2 border-orange-200">
                      <h4 className="font-semibold text-orange-800 mb-2 flex items-center gap-2">
                        <Download size={16} />
                        Exportar Despesas
                      </h4>
                      <p className="text-xs text-gray-600 mb-3">
                        Ficheiro CSV com todas as despesas do per√≠odo selecionado (respeita filtros de data).
                      </p>
                      <button 
                        onClick={exportarDespesasCSV}
                        className="w-full bg-orange-600 hover:bg-orange-700 text-white rounded-lg px-4 py-2.5 text-sm font-semibold flex items-center justify-center gap-2 transition"
                      >
                        <Download size={14} />
                        Exportar Despesas CSV
                      </button>
                    </div>
                  </div>
                  
                  <div className="mt-4 bg-blue-50 border border-blue-200 rounded-lg p-3">
                    <p className="text-xs text-blue-800">
                      <strong>üí° Dica:</strong> Os exports CSV respeitam os filtros de data. Para exportar tudo, selecione "Tudo" no filtro de per√≠odo no Dashboard.
                    </p>
                  </div>
                </div>
                
                {/* Outras sec√ß√µes */}
                <div className="border-b pb-4">
                  <h3 className="font-semibold mb-2">‚öôÔ∏è Configura√ß√µes Gerais</h3>
                  <p className="text-sm text-gray-500">Em breve: Configura√ß√µes personalizadas</p>
                </div>
                
                <div className="border-b pb-4">
                  <h3 className="font-semibold mb-2">üîî Notifica√ß√µes</h3>
                  <p className="text-sm text-gray-500">Em breve: Gest√£o de notifica√ß√µes</p>
                </div>
                
                <div className="border-b pb-4">
                  <h3 className="font-semibold mb-2">üìä Relat√≥rios</h3>
                  <p className="text-sm text-gray-500">Em breve: Configura√ß√£o de relat√≥rios autom√°ticos</p>
                </div>
                
                <div>
                  <h3 className="font-semibold mb-2">‚ÑπÔ∏è Sobre</h3>
                  <p className="text-sm text-gray-600">
                    <strong>Munchi Manager</strong> v1.0<br/>
                    Sistema de gest√£o para restaurantes
                  </p>
                </div>
              </div>
            </div>
          </div>
        )}
      </div>
    </div>
  );
};


// AUTO-LOAD 2 MONTHS DATA
setTimeout(() => {
  const data = {"versao": "1.0", "dataExport": "2026-01-06T12:00:00.000Z", "ingredientes": [{"id": 1701388800000, "nome": "Caf\u00e9 em Gr\u00e3o", "unidade": "kg", "custoUnitario": 12.5, "iva": 6}, {"id": 1701388801000, "nome": "Leite", "unidade": "L", "custoUnitario": 0.85, "iva": 6}, {"id": 1701388802000, "nome": "A\u00e7\u00facar", "unidade": "kg", "custoUnitario": 1.2, "iva": 6}, {"id": 1701388803000, "nome": "Farinha", "unidade": "kg", "custoUnitario": 0.8, "iva": 6}, {"id": 1701388804000, "nome": "Ovos", "unidade": "un", "custoUnitario": 0.25, "iva": 6}, {"id": 1701388805000, "nome": "Manteiga", "unidade": "kg", "custoUnitario": 5.5, "iva": 6}, {"id": 1701388806000, "nome": "Queijo", "unidade": "kg", "custoUnitario": 8.9, "iva": 6}, {"id": 1701388807000, "nome": "Fiambre", "unidade": "kg", "custoUnitario": 6.5, "iva": 6}, {"id": 1701388808000, "nome": "P\u00e3o", "unidade": "un", "custoUnitario": 0.35, "iva": 6}, {"id": 1701388809000, "nome": "Tomate", "unidade": "kg", "custoUnitario": 1.8, "iva": 6}, {"id": 1701388810000, "nome": "Alface", "unidade": "un", "custoUnitario": 0.6, "iva": 6}, {"id": 1701388811000, "nome": "Chocolate", "unidade": "kg", "custoUnitario": 7.2, "iva": 6}, {"id": 1701388812000, "nome": "Batatas", "unidade": "kg", "custoUnitario": 0.9, "iva": 6}, {"id": 1701388813000, "nome": "\u00d3leo", "unidade": "L", "custoUnitario": 4.5, "iva": 6}, {"id": 1701388814000, "nome": "Sal", "unidade": "kg", "custoUnitario": 0.5, "iva": 6}, {"id": 1701388815000, "nome": "Presunto", "unidade": "kg", "custoUnitario": 12.0, "iva": 6}, {"id": 1701388816000, "nome": "Atum", "unidade": "kg", "custoUnitario": 8.5, "iva": 6}, {"id": 1701388817000, "nome": "Maionese", "unidade": "L", "custoUnitario": 3.2, "iva": 6}], "produtos": [{"id": 1701475200000, "nome": "Caf\u00e9 Expresso", "precoVenda": 0.8, "iva": 6, "receita": [{"ingredienteId": 1701388800000, "quantidade": 0.007, "unidade": "kg"}]}, {"id": 1701475201000, "nome": "Gal\u00e3o", "precoVenda": 1.5, "iva": 6, "receita": [{"ingredienteId": 1701388800000, "quantidade": 0.007, "unidade": "kg"}, {"ingredienteId": 1701388801000, "quantidade": 0.15, "unidade": "L"}]}, {"id": 1701475202000, "nome": "Meia de Leite", "precoVenda": 0.9, "iva": 6, "receita": [{"ingredienteId": 1701388800000, "quantidade": 0.007, "unidade": "kg"}, {"ingredienteId": 1701388801000, "quantidade": 0.05, "unidade": "L"}]}, {"id": 1701475203000, "nome": "Tosta Mista", "precoVenda": 2.5, "iva": 6, "receita": [{"ingredienteId": 1701388808000, "quantidade": 2, "unidade": "un"}, {"ingredienteId": 1701388806000, "quantidade": 0.03, "unidade": "kg"}, {"ingredienteId": 1701388807000, "quantidade": 0.025, "unidade": "kg"}, {"ingredienteId": 1701388805000, "quantidade": 0.01, "unidade": "kg"}]}, {"id": 1701475204000, "nome": "Croissant", "precoVenda": 1.2, "iva": 6, "receita": [{"ingredienteId": 1701388803000, "quantidade": 0.06, "unidade": "kg"}, {"ingredienteId": 1701388805000, "quantidade": 0.02, "unidade": "kg"}, {"ingredienteId": 1701388804000, "quantidade": 0.5, "unidade": "un"}]}, {"id": 1701475205000, "nome": "Pastel de Nata", "precoVenda": 1.1, "iva": 6, "receita": [{"ingredienteId": 1701388803000, "quantidade": 0.05, "unidade": "kg"}, {"ingredienteId": 1701388804000, "quantidade": 1, "unidade": "un"}, {"ingredienteId": 1701388802000, "quantidade": 0.02, "unidade": "kg"}, {"ingredienteId": 1701388801000, "quantidade": 0.03, "unidade": "L"}]}, {"id": 1701475206000, "nome": "Sandes Natural", "precoVenda": 3.5, "iva": 6, "receita": [{"ingredienteId": 1701388808000, "quantidade": 1, "unidade": "un"}, {"ingredienteId": 1701388807000, "quantidade": 0.04, "unidade": "kg"}, {"ingredienteId": 1701388806000, "quantidade": 0.03, "unidade": "kg"}, {"ingredienteId": 1701388810000, "quantidade": 0.3, "unidade": "un"}, {"ingredienteId": 1701388809000, "quantidade": 0.05, "unidade": "kg"}]}, {"id": 1701475207000, "nome": "Bolo de Chocolate", "precoVenda": 2.0, "iva": 6, "receita": [{"ingredienteId": 1701388803000, "quantidade": 0.08, "unidade": "kg"}, {"ingredienteId": 1701388811000, "quantidade": 0.04, "unidade": "kg"}, {"ingredienteId": 1701388804000, "quantidade": 1.5, "unidade": "un"}, {"ingredienteId": 1701388802000, "quantidade": 0.03, "unidade": "kg"}, {"ingredienteId": 1701388805000, "quantidade": 0.015, "unidade": "kg"}]}, {"id": 1701475208000, "nome": "Sandes de Presunto", "precoVenda": 4.0, "iva": 6, "receita": [{"ingredienteId": 1701388808000, "quantidade": 1, "unidade": "un"}, {"ingredienteId": 1701388815000, "quantidade": 0.05, "unidade": "kg"}, {"ingredienteId": 1701388806000, "quantidade": 0.03, "unidade": "kg"}, {"ingredienteId": 1701388810000, "quantidade": 0.3, "unidade": "un"}]}, {"id": 1701475209000, "nome": "Sandes de Atum", "precoVenda": 3.8, "iva": 6, "receita": [{"ingredienteId": 1701388808000, "quantidade": 1, "unidade": "un"}, {"ingredienteId": 1701388816000, "quantidade": 0.06, "unidade": "kg"}, {"ingredienteId": 1701388817000, "quantidade": 0.015, "unidade": "L"}, {"ingredienteId": 1701388810000, "quantidade": 0.3, "unidade": "un"}]}], "fornecedores": ["Delta Caf\u00e9s", "Buondi", "Lactogal", "Padaria Silva", "Makro", "EDP", "EPAL", "Recheio"], "vendas": [{"id": 1730419200000, "data": "2025-11-01", "produto": "Caf\u00e9 Expresso", "quantidade": 30, "valor": 24.0, "iva": 6}, {"id": 1730419200001, "data": "2025-11-01", "produto": "Gal\u00e3o", "quantidade": 26, "valor": 39.0, "iva": 6}, {"id": 1730419200002, "data": "2025-11-01", "produto": "Meia de Leite", "quantidade": 11, "valor": 9.9, "iva": 6}, {"id": 1730419200003, "data": "2025-11-01", "produto": "Tosta Mista", "quantidade": 14, "valor": 35.0, "iva": 6}, {"id": 1730419200004, "data": "2025-11-01", "produto": "Croissant", "quantidade": 17, "valor": 20.4, "iva": 6}, {"id": 1730419200005, "data": "2025-11-01", "produto": "Pastel de Nata", "quantidade": 30, "valor": 33.0, "iva": 6}, {"id": 1730419200006, "data": "2025-11-01", "produto": "Sandes Natural", "quantidade": 14, "valor": 49.0, "iva": 6}, {"id": 1730419200007, "data": "2025-11-01", "produto": "Bolo de Chocolate", "quantidade": 10, "valor": 20.0, "iva": 6}, {"id": 1730419200008, "data": "2025-11-01", "produto": "Sandes de Presunto", "quantidade": 8, "valor": 32.0, "iva": 6}, {"id": 1730419200009, "data": "2025-11-01", "produto": "Sandes de Atum", "quantidade": 6, "valor": 22.8, "iva": 6}, {"id": 1730419200010, "data": "2025-11-03", "produto": "Caf\u00e9 Expresso", "quantidade": 42, "valor": 33.6, "iva": 6}, {"id": 1730419200011, "data": "2025-11-03", "produto": "Gal\u00e3o", "quantidade": 27, "valor": 40.5, "iva": 6}, {"id": 1730419200012, "data": "2025-11-03", "produto": "Meia de Leite", "quantidade": 15, "valor": 13.5, "iva": 6}, {"id": 1730419200013, "data": "2025-11-03", "produto": "Tosta Mista", "quantidade": 18, "valor": 45.0, "iva": 6}, {"id": 1730419200014, "data": "2025-11-03", "produto": "Croissant", "quantidade": 22, "valor": 26.4, "iva": 6}, {"id": 1730419200015, "data": "2025-11-03", "produto": "Pastel de Nata", "quantidade": 29, "valor": 31.9, "iva": 6}, {"id": 1730419200016, "data": "2025-11-03", "produto": "Sandes Natural", "quantidade": 9, "valor": 31.5, "iva": 6}, {"id": 1730419200017, "data": "2025-11-03", "produto": "Bolo de Chocolate", "quantidade": 16, "valor": 32.0, "iva": 6}, {"id": 1730419200018, "data": "2025-11-03", "produto": "Sandes de Presunto", "quantidade": 4, "valor": 16.0, "iva": 6}, {"id": 1730419200019, "data": "2025-11-03", "produto": "Sandes de Atum", "quantidade": 5, "valor": 19.0, "iva": 6}, {"id": 1730419200020, "data": "2025-11-04", "produto": "Caf\u00e9 Expresso", "quantidade": 63, "valor": 50.4, "iva": 6}, {"id": 1730419200021, "data": "2025-11-04", "produto": "Gal\u00e3o", "quantidade": 38, "valor": 57.0, "iva": 6}, {"id": 1730419200022, "data": "2025-11-04", "produto": "Meia de Leite", "quantidade": 15, "valor": 13.5, "iva": 6}, {"id": 1730419200023, "data": "2025-11-04", "produto": "Tosta Mista", "quantidade": 16, "valor": 40.0, "iva": 6}, {"id": 1730419200024, "data": "2025-11-04", "produto": "Croissant", "quantidade": 16, "valor": 19.2, "iva": 6}, {"id": 1730419200025, "data": "2025-11-04", "produto": "Pastel de Nata", "quantidade": 32, "valor": 35.2, "iva": 6}, {"id": 1730419200026, "data": "2025-11-04", "produto": "Sandes Natural", "quantidade": 12, "valor": 42.0, "iva": 6}, {"id": 1730419200027, "data": "2025-11-04", "produto": "Bolo de Chocolate", "quantidade": 15, "valor": 30.0, "iva": 6}, {"id": 1730419200028, "data": "2025-11-04", "produto": "Sandes de Presunto", "quantidade": 7, "valor": 28.0, "iva": 6}, {"id": 1730419200029, "data": "2025-11-04", "produto": "Sandes de Atum", "quantidade": 6, "valor": 22.8, "iva": 6}, {"id": 1730419200030, "data": "2025-11-05", "produto": "Caf\u00e9 Expresso", "quantidade": 61, "valor": 48.8, "iva": 6}, {"id": 1730419200031, "data": "2025-11-05", "produto": "Gal\u00e3o", "quantidade": 41, "valor": 61.5, "iva": 6}, {"id": 1730419200032, "data": "2025-11-05", "produto": "Meia de Leite", "quantidade": 11, "valor": 9.9, "iva": 6}, {"id": 1730419200033, "data": "2025-11-05", "produto": "Tosta Mista", "quantidade": 20, "valor": 50.0, "iva": 6}, {"id": 1730419200034, "data": "2025-11-05", "produto": "Croissant", "quantidade": 21, "valor": 25.2, "iva": 6}, {"id": 1730419200035, "data": "2025-11-05", "produto": "Pastel de Nata", "quantidade": 32, "valor": 35.2, "iva": 6}, {"id": 1730419200036, "data": "2025-11-05", "produto": "Sandes Natural", "quantidade": 7, "valor": 24.5, "iva": 6}, {"id": 1730419200037, "data": "2025-11-05", "produto": "Bolo de Chocolate", "quantidade": 16, "valor": 32.0, "iva": 6}, {"id": 1730419200038, "data": "2025-11-05", "produto": "Sandes de Presunto", "quantidade": 8, "valor": 32.0, "iva": 6}, {"id": 1730419200039, "data": "2025-11-05", "produto": "Sandes de Atum", "quantidade": 4, "valor": 15.2, "iva": 6}, {"id": 1730419200040, "data": "2025-11-06", "produto": "Caf\u00e9 Expresso", "quantidade": 38, "valor": 30.4, "iva": 6}, {"id": 1730419200041, "data": "2025-11-06", "produto": "Gal\u00e3o", "quantidade": 42, "valor": 63.0, "iva": 6}, {"id": 1730419200042, "data": "2025-11-06", "produto": "Meia de Leite", "quantidade": 13, "valor": 11.7, "iva": 6}, {"id": 1730419200043, "data": "2025-11-06", "produto": "Tosta Mista", "quantidade": 21, "valor": 52.5, "iva": 6}, {"id": 1730419200044, "data": "2025-11-06", "produto": "Croissant", "quantidade": 20, "valor": 24.0, "iva": 6}, {"id": 1730419200045, "data": "2025-11-06", "produto": "Pastel de Nata", "quantidade": 34, "valor": 37.4, "iva": 6}, {"id": 1730419200046, "data": "2025-11-06", "produto": "Sandes Natural", "quantidade": 11, "valor": 38.5, "iva": 6}, {"id": 1730419200047, "data": "2025-11-06", "produto": "Bolo de Chocolate", "quantidade": 14, "valor": 28.0, "iva": 6}, {"id": 1730419200048, "data": "2025-11-06", "produto": "Sandes de Presunto", "quantidade": 4, "valor": 16.0, "iva": 6}, {"id": 1730419200049, "data": "2025-11-06", "produto": "Sandes de Atum", "quantidade": 11, "valor": 41.8, "iva": 6}, {"id": 1730419200050, "data": "2025-11-07", "produto": "Caf\u00e9 Expresso", "quantidade": 41, "valor": 32.8, "iva": 6}, {"id": 1730419200051, "data": "2025-11-07", "produto": "Gal\u00e3o", "quantidade": 38, "valor": 57.0, "iva": 6}, {"id": 1730419200052, "data": "2025-11-07", "produto": "Meia de Leite", "quantidade": 18, "valor": 16.2, "iva": 6}, {"id": 1730419200053, "data": "2025-11-07", "produto": "Tosta Mista", "quantidade": 14, "valor": 35.0, "iva": 6}, {"id": 1730419200054, "data": "2025-11-07", "produto": "Croissant", "quantidade": 17, "valor": 20.4, "iva": 6}, {"id": 1730419200055, "data": "2025-11-07", "produto": "Pastel de Nata", "quantidade": 32, "valor": 35.2, "iva": 6}, {"id": 1730419200056, "data": "2025-11-07", "produto": "Sandes Natural", "quantidade": 11, "valor": 38.5, "iva": 6}, {"id": 1730419200057, "data": "2025-11-07", "produto": "Bolo de Chocolate", "quantidade": 14, "valor": 28.0, "iva": 6}, {"id": 1730419200058, "data": "2025-11-07", "produto": "Sandes de Presunto", "quantidade": 4, "valor": 16.0, "iva": 6}, {"id": 1730419200059, "data": "2025-11-07", "produto": "Sandes de Atum", "quantidade": 5, "valor": 19.0, "iva": 6}, {"id": 1730419200060, "data": "2025-11-08", "produto": "Caf\u00e9 Expresso", "quantidade": 40, "valor": 32.0, "iva": 6}, {"id": 1730419200061, "data": "2025-11-08", "produto": "Gal\u00e3o", "quantidade": 19, "valor": 28.5, "iva": 6}, {"id": 1730419200062, "data": "2025-11-08", "produto": "Meia de Leite", "quantidade": 6, "valor": 5.4, "iva": 6}, {"id": 1730419200063, "data": "2025-11-08", "produto": "Tosta Mista", "quantidade": 12, "valor": 30.0, "iva": 6}, {"id": 1730419200064, "data": "2025-11-08", "produto": "Croissant", "quantidade": 14, "valor": 16.8, "iva": 6}, {"id": 1730419200065, "data": "2025-11-08", "produto": "Pastel de Nata", "quantidade": 28, "valor": 30.8, "iva": 6}, {"id": 1730419200066, "data": "2025-11-08", "produto": "Sandes Natural", "quantidade": 7, "valor": 24.5, "iva": 6}, {"id": 1730419200067, "data": "2025-11-08", "produto": "Bolo de Chocolate", "quantidade": 11, "valor": 22.0, "iva": 6}, {"id": 1730419200068, "data": "2025-11-08", "produto": "Sandes de Presunto", "quantidade": 6, "valor": 24.0, "iva": 6}, {"id": 1730419200069, "data": "2025-11-08", "produto": "Sandes de Atum", "quantidade": 13, "valor": 49.4, "iva": 6}, {"id": 1730419200070, "data": "2025-11-10", "produto": "Caf\u00e9 Expresso", "quantidade": 58, "valor": 46.4, "iva": 6}, {"id": 1730419200071, "data": "2025-11-10", "produto": "Gal\u00e3o", "quantidade": 43, "valor": 64.5, "iva": 6}, {"id": 1730419200072, "data": "2025-11-10", "produto": "Meia de Leite", "quantidade": 15, "valor": 13.5, "iva": 6}, {"id": 1730419200073, "data": "2025-11-10", "produto": "Tosta Mista", "quantidade": 19, "valor": 47.5, "iva": 6}, {"id": 1730419200074, "data": "2025-11-10", "produto": "Croissant", "quantidade": 15, "valor": 18.0, "iva": 6}, {"id": 1730419200075, "data": "2025-11-10", "produto": "Pastel de Nata", "quantidade": 29, "valor": 31.9, "iva": 6}, {"id": 1730419200076, "data": "2025-11-10", "produto": "Sandes Natural", "quantidade": 9, "valor": 31.5, "iva": 6}, {"id": 1730419200077, "data": "2025-11-10", "produto": "Bolo de Chocolate", "quantidade": 16, "valor": 32.0, "iva": 6}, {"id": 1730419200078, "data": "2025-11-10", "produto": "Sandes de Presunto", "quantidade": 9, "valor": 36.0, "iva": 6}, {"id": 1730419200079, "data": "2025-11-10", "produto": "Sandes de Atum", "quantidade": 6, "valor": 22.8, "iva": 6}, {"id": 1730419200080, "data": "2025-11-11", "produto": "Caf\u00e9 Expresso", "quantidade": 36, "valor": 28.8, "iva": 6}, {"id": 1730419200081, "data": "2025-11-11", "produto": "Gal\u00e3o", "quantidade": 28, "valor": 42.0, "iva": 6}, {"id": 1730419200082, "data": "2025-11-11", "produto": "Meia de Leite", "quantidade": 15, "valor": 13.5, "iva": 6}, {"id": 1730419200083, "data": "2025-11-11", "produto": "Tosta Mista", "quantidade": 13, "valor": 32.5, "iva": 6}, {"id": 1730419200084, "data": "2025-11-11", "produto": "Croissant", "quantidade": 22, "valor": 26.4, "iva": 6}, {"id": 1730419200085, "data": "2025-11-11", "produto": "Pastel de Nata", "quantidade": 25, "valor": 27.5, "iva": 6}, {"id": 1730419200086, "data": "2025-11-11", "produto": "Sandes Natural", "quantidade": 10, "valor": 35.0, "iva": 6}, {"id": 1730419200087, "data": "2025-11-11", "produto": "Bolo de Chocolate", "quantidade": 11, "valor": 22.0, "iva": 6}, {"id": 1730419200088, "data": "2025-11-11", "produto": "Sandes de Presunto", "quantidade": 8, "valor": 32.0, "iva": 6}, {"id": 1730419200089, "data": "2025-11-11", "produto": "Sandes de Atum", "quantidade": 5, "valor": 19.0, "iva": 6}, {"id": 1730419200090, "data": "2025-11-12", "produto": "Caf\u00e9 Expresso", "quantidade": 64, "valor": 51.2, "iva": 6}, {"id": 1730419200091, "data": "2025-11-12", "produto": "Gal\u00e3o", "quantidade": 38, "valor": 57.0, "iva": 6}, {"id": 1730419200092, "data": "2025-11-12", "produto": "Meia de Leite", "quantidade": 15, "valor": 13.5, "iva": 6}, {"id": 1730419200093, "data": "2025-11-12", "produto": "Tosta Mista", "quantidade": 17, "valor": 42.5, "iva": 6}, {"id": 1730419200094, "data": "2025-11-12", "produto": "Croissant", "quantidade": 24, "valor": 28.8, "iva": 6}, {"id": 1730419200095, "data": "2025-11-12", "produto": "Pastel de Nata", "quantidade": 28, "valor": 30.8, "iva": 6}, {"id": 1730419200096, "data": "2025-11-12", "produto": "Sandes Natural", "quantidade": 5, "valor": 17.5, "iva": 6}, {"id": 1730419200097, "data": "2025-11-12", "produto": "Bolo de Chocolate", "quantidade": 8, "valor": 16.0, "iva": 6}, {"id": 1730419200098, "data": "2025-11-12", "produto": "Sandes de Presunto", "quantidade": 7, "valor": 28.0, "iva": 6}, {"id": 1730419200099, "data": "2025-11-12", "produto": "Sandes de Atum", "quantidade": 5, "valor": 19.0, "iva": 6}, {"id": 1730419200100, "data": "2025-11-13", "produto": "Caf\u00e9 Expresso", "quantidade": 45, "valor": 36.0, "iva": 6}, {"id": 1730419200101, "data": "2025-11-13", "produto": "Gal\u00e3o", "quantidade": 44, "valor": 66.0, "iva": 6}, {"id": 1730419200102, "data": "2025-11-13", "produto": "Meia de Leite", "quantidade": 14, "valor": 12.6, "iva": 6}, {"id": 1730419200103, "data": "2025-11-13", "produto": "Tosta Mista", "quantidade": 12, "valor": 30.0, "iva": 6}, {"id": 1730419200104, "data": "2025-11-13", "produto": "Croissant", "quantidade": 24, "valor": 28.8, "iva": 6}, {"id": 1730419200105, "data": "2025-11-13", "produto": "Pastel de Nata", "quantidade": 26, "valor": 28.6, "iva": 6}, {"id": 1730419200106, "data": "2025-11-13", "produto": "Sandes Natural", "quantidade": 6, "valor": 21.0, "iva": 6}, {"id": 1730419200107, "data": "2025-11-13", "produto": "Bolo de Chocolate", "quantidade": 9, "valor": 18.0, "iva": 6}, {"id": 1730419200108, "data": "2025-11-13", "produto": "Sandes de Presunto", "quantidade": 5, "valor": 20.0, "iva": 6}, {"id": 1730419200109, "data": "2025-11-13", "produto": "Sandes de Atum", "quantidade": 9, "valor": 34.2, "iva": 6}, {"id": 1730419200110, "data": "2025-11-14", "produto": "Caf\u00e9 Expresso", "quantidade": 54, "valor": 43.2, "iva": 6}, {"id": 1730419200111, "data": "2025-11-14", "produto": "Gal\u00e3o", "quantidade": 28, "valor": 42.0, "iva": 6}, {"id": 1730419200112, "data": "2025-11-14", "produto": "Meia de Leite", "quantidade": 14, "valor": 12.6, "iva": 6}, {"id": 1730419200113, "data": "2025-11-14", "produto": "Tosta Mista", "quantidade": 19, "valor": 47.5, "iva": 6}, {"id": 1730419200114, "data": "2025-11-14", "produto": "Croissant", "quantidade": 21, "valor": 25.2, "iva": 6}, {"id": 1730419200115, "data": "2025-11-14", "produto": "Pastel de Nata", "quantidade": 31, "valor": 34.1, "iva": 6}, {"id": 1730419200116, "data": "2025-11-14", "produto": "Sandes Natural", "quantidade": 12, "valor": 42.0, "iva": 6}, {"id": 1730419200117, "data": "2025-11-14", "produto": "Bolo de Chocolate", "quantidade": 8, "valor": 16.0, "iva": 6}, {"id": 1730419200118, "data": "2025-11-14", "produto": "Sandes de Presunto", "quantidade": 6, "valor": 24.0, "iva": 6}, {"id": 1730419200119, "data": "2025-11-14", "produto": "Sandes de Atum", "quantidade": 7, "valor": 26.6, "iva": 6}, {"id": 1730419200120, "data": "2025-11-15", "produto": "Caf\u00e9 Expresso", "quantidade": 40, "valor": 32.0, "iva": 6}, {"id": 1730419200121, "data": "2025-11-15", "produto": "Gal\u00e3o", "quantidade": 25, "valor": 37.5, "iva": 6}, {"id": 1730419200122, "data": "2025-11-15", "produto": "Meia de Leite", "quantidade": 7, "valor": 6.3, "iva": 6}, {"id": 1730419200123, "data": "2025-11-15", "produto": "Tosta Mista", "quantidade": 22, "valor": 55.0, "iva": 6}, {"id": 1730419200124, "data": "2025-11-15", "produto": "Croissant", "quantidade": 16, "valor": 19.2, "iva": 6}, {"id": 1730419200125, "data": "2025-11-15", "produto": "Pastel de Nata", "quantidade": 31, "valor": 34.1, "iva": 6}, {"id": 1730419200126, "data": "2025-11-15", "produto": "Sandes Natural", "quantidade": 15, "valor": 52.5, "iva": 6}, {"id": 1730419200127, "data": "2025-11-15", "produto": "Bolo de Chocolate", "quantidade": 9, "valor": 18.0, "iva": 6}, {"id": 1730419200128, "data": "2025-11-15", "produto": "Sandes de Presunto", "quantidade": 9, "valor": 36.0, "iva": 6}, {"id": 1730419200129, "data": "2025-11-15", "produto": "Sandes de Atum", "quantidade": 10, "valor": 38.0, "iva": 6}, {"id": 1730419200130, "data": "2025-11-17", "produto": "Caf\u00e9 Expresso", "quantidade": 37, "valor": 29.6, "iva": 6}, {"id": 1730419200131, "data": "2025-11-17", "produto": "Gal\u00e3o", "quantidade": 32, "valor": 48.0, "iva": 6}, {"id": 1730419200132, "data": "2025-11-17", "produto": "Meia de Leite", "quantidade": 15, "valor": 13.5, "iva": 6}, {"id": 1730419200133, "data": "2025-11-17", "produto": "Tosta Mista", "quantidade": 16, "valor": 40.0, "iva": 6}, {"id": 1730419200134, "data": "2025-11-17", "produto": "Croissant", "quantidade": 23, "valor": 27.6, "iva": 6}, {"id": 1730419200135, "data": "2025-11-17", "produto": "Pastel de Nata", "quantidade": 28, "valor": 30.8, "iva": 6}, {"id": 1730419200136, "data": "2025-11-17", "produto": "Sandes Natural", "quantidade": 13, "valor": 45.5, "iva": 6}, {"id": 1730419200137, "data": "2025-11-17", "produto": "Bolo de Chocolate", "quantidade": 15, "valor": 30.0, "iva": 6}, {"id": 1730419200138, "data": "2025-11-17", "produto": "Sandes de Presunto", "quantidade": 4, "valor": 16.0, "iva": 6}, {"id": 1730419200139, "data": "2025-11-17", "produto": "Sandes de Atum", "quantidade": 7, "valor": 26.6, "iva": 6}, {"id": 1730419200140, "data": "2025-11-18", "produto": "Caf\u00e9 Expresso", "quantidade": 56, "valor": 44.8, "iva": 6}, {"id": 1730419200141, "data": "2025-11-18", "produto": "Gal\u00e3o", "quantidade": 37, "valor": 55.5, "iva": 6}, {"id": 1730419200142, "data": "2025-11-18", "produto": "Meia de Leite", "quantidade": 18, "valor": 16.2, "iva": 6}, {"id": 1730419200143, "data": "2025-11-18", "produto": "Tosta Mista", "quantidade": 18, "valor": 45.0, "iva": 6}, {"id": 1730419200144, "data": "2025-11-18", "produto": "Croissant", "quantidade": 23, "valor": 27.6, "iva": 6}, {"id": 1730419200145, "data": "2025-11-18", "produto": "Pastel de Nata", "quantidade": 25, "valor": 27.5, "iva": 6}, {"id": 1730419200146, "data": "2025-11-18", "produto": "Sandes Natural", "quantidade": 8, "valor": 28.0, "iva": 6}, {"id": 1730419200147, "data": "2025-11-18", "produto": "Bolo de Chocolate", "quantidade": 10, "valor": 20.0, "iva": 6}, {"id": 1730419200148, "data": "2025-11-18", "produto": "Sandes de Presunto", "quantidade": 4, "valor": 16.0, "iva": 6}, {"id": 1730419200149, "data": "2025-11-18", "produto": "Sandes de Atum", "quantidade": 7, "valor": 26.6, "iva": 6}, {"id": 1730419200150, "data": "2025-11-19", "produto": "Caf\u00e9 Expresso", "quantidade": 53, "valor": 42.4, "iva": 6}, {"id": 1730419200151, "data": "2025-11-19", "produto": "Gal\u00e3o", "quantidade": 35, "valor": 52.5, "iva": 6}, {"id": 1730419200152, "data": "2025-11-19", "produto": "Meia de Leite", "quantidade": 11, "valor": 9.9, "iva": 6}, {"id": 1730419200153, "data": "2025-11-19", "produto": "Tosta Mista", "quantidade": 16, "valor": 40.0, "iva": 6}, {"id": 1730419200154, "data": "2025-11-19", "produto": "Croissant", "quantidade": 23, "valor": 27.6, "iva": 6}, {"id": 1730419200155, "data": "2025-11-19", "produto": "Pastel de Nata", "quantidade": 27, "valor": 29.7, "iva": 6}, {"id": 1730419200156, "data": "2025-11-19", "produto": "Sandes Natural", "quantidade": 8, "valor": 28.0, "iva": 6}, {"id": 1730419200157, "data": "2025-11-19", "produto": "Bolo de Chocolate", "quantidade": 17, "valor": 34.0, "iva": 6}, {"id": 1730419200158, "data": "2025-11-19", "produto": "Sandes de Presunto", "quantidade": 6, "valor": 24.0, "iva": 6}, {"id": 1730419200159, "data": "2025-11-19", "produto": "Sandes de Atum", "quantidade": 7, "valor": 26.6, "iva": 6}, {"id": 1730419200160, "data": "2025-11-20", "produto": "Caf\u00e9 Expresso", "quantidade": 47, "valor": 37.6, "iva": 6}, {"id": 1730419200161, "data": "2025-11-20", "produto": "Gal\u00e3o", "quantidade": 26, "valor": 39.0, "iva": 6}, {"id": 1730419200162, "data": "2025-11-20", "produto": "Meia de Leite", "quantidade": 17, "valor": 15.3, "iva": 6}, {"id": 1730419200163, "data": "2025-11-20", "produto": "Tosta Mista", "quantidade": 18, "valor": 45.0, "iva": 6}, {"id": 1730419200164, "data": "2025-11-20", "produto": "Croissant", "quantidade": 18, "valor": 21.6, "iva": 6}, {"id": 1730419200165, "data": "2025-11-20", "produto": "Pastel de Nata", "quantidade": 36, "valor": 39.6, "iva": 6}, {"id": 1730419200166, "data": "2025-11-20", "produto": "Sandes Natural", "quantidade": 11, "valor": 38.5, "iva": 6}, {"id": 1730419200167, "data": "2025-11-20", "produto": "Bolo de Chocolate", "quantidade": 17, "valor": 34.0, "iva": 6}, {"id": 1730419200168, "data": "2025-11-20", "produto": "Sandes de Presunto", "quantidade": 4, "valor": 16.0, "iva": 6}, {"id": 1730419200169, "data": "2025-11-20", "produto": "Sandes de Atum", "quantidade": 6, "valor": 22.8, "iva": 6}, {"id": 1730419200170, "data": "2025-11-21", "produto": "Caf\u00e9 Expresso", "quantidade": 58, "valor": 46.4, "iva": 6}, {"id": 1730419200171, "data": "2025-11-21", "produto": "Gal\u00e3o", "quantidade": 32, "valor": 48.0, "iva": 6}, {"id": 1730419200172, "data": "2025-11-21", "produto": "Meia de Leite", "quantidade": 19, "valor": 17.1, "iva": 6}, {"id": 1730419200173, "data": "2025-11-21", "produto": "Tosta Mista", "quantidade": 20, "valor": 50.0, "iva": 6}, {"id": 1730419200174, "data": "2025-11-21", "produto": "Croissant", "quantidade": 15, "valor": 18.0, "iva": 6}, {"id": 1730419200175, "data": "2025-11-21", "produto": "Pastel de Nata", "quantidade": 27, "valor": 29.7, "iva": 6}, {"id": 1730419200176, "data": "2025-11-21", "produto": "Sandes Natural", "quantidade": 9, "valor": 31.5, "iva": 6}, {"id": 1730419200177, "data": "2025-11-21", "produto": "Bolo de Chocolate", "quantidade": 10, "valor": 20.0, "iva": 6}, {"id": 1730419200178, "data": "2025-11-21", "produto": "Sandes de Presunto", "quantidade": 8, "valor": 32.0, "iva": 6}, {"id": 1730419200179, "data": "2025-11-21", "produto": "Sandes de Atum", "quantidade": 9, "valor": 34.2, "iva": 6}, {"id": 1730419200180, "data": "2025-11-22", "produto": "Caf\u00e9 Expresso", "quantidade": 28, "valor": 22.4, "iva": 6}, {"id": 1730419200181, "data": "2025-11-22", "produto": "Gal\u00e3o", "quantidade": 23, "valor": 34.5, "iva": 6}, {"id": 1730419200182, "data": "2025-11-22", "produto": "Meia de Leite", "quantidade": 11, "valor": 9.9, "iva": 6}, {"id": 1730419200183, "data": "2025-11-22", "produto": "Tosta Mista", "quantidade": 22, "valor": 55.0, "iva": 6}, {"id": 1730419200184, "data": "2025-11-22", "produto": "Croissant", "quantidade": 13, "valor": 15.6, "iva": 6}, {"id": 1730419200185, "data": "2025-11-22", "produto": "Pastel de Nata", "quantidade": 32, "valor": 35.2, "iva": 6}, {"id": 1730419200186, "data": "2025-11-22", "produto": "Sandes Natural", "quantidade": 12, "valor": 42.0, "iva": 6}, {"id": 1730419200187, "data": "2025-11-22", "produto": "Bolo de Chocolate", "quantidade": 12, "valor": 24.0, "iva": 6}, {"id": 1730419200188, "data": "2025-11-22", "produto": "Sandes de Presunto", "quantidade": 9, "valor": 36.0, "iva": 6}, {"id": 1730419200189, "data": "2025-11-22", "produto": "Sandes de Atum", "quantidade": 9, "valor": 34.2, "iva": 6}, {"id": 1730419200190, "data": "2025-11-24", "produto": "Caf\u00e9 Expresso", "quantidade": 37, "valor": 29.6, "iva": 6}, {"id": 1730419200191, "data": "2025-11-24", "produto": "Gal\u00e3o", "quantidade": 44, "valor": 66.0, "iva": 6}, {"id": 1730419200192, "data": "2025-11-24", "produto": "Meia de Leite", "quantidade": 12, "valor": 10.8, "iva": 6}, {"id": 1730419200193, "data": "2025-11-24", "produto": "Tosta Mista", "quantidade": 12, "valor": 30.0, "iva": 6}, {"id": 1730419200194, "data": "2025-11-24", "produto": "Croissant", "quantidade": 24, "valor": 28.8, "iva": 6}, {"id": 1730419200195, "data": "2025-11-24", "produto": "Pastel de Nata", "quantidade": 30, "valor": 33.0, "iva": 6}, {"id": 1730419200196, "data": "2025-11-24", "produto": "Sandes Natural", "quantidade": 7, "valor": 24.5, "iva": 6}, {"id": 1730419200197, "data": "2025-11-24", "produto": "Bolo de Chocolate", "quantidade": 11, "valor": 22.0, "iva": 6}, {"id": 1730419200198, "data": "2025-11-24", "produto": "Sandes de Presunto", "quantidade": 7, "valor": 28.0, "iva": 6}, {"id": 1730419200199, "data": "2025-11-24", "produto": "Sandes de Atum", "quantidade": 9, "valor": 34.2, "iva": 6}, {"id": 1730419200200, "data": "2025-11-25", "produto": "Caf\u00e9 Expresso", "quantidade": 44, "valor": 35.2, "iva": 6}, {"id": 1730419200201, "data": "2025-11-25", "produto": "Gal\u00e3o", "quantidade": 36, "valor": 54.0, "iva": 6}, {"id": 1730419200202, "data": "2025-11-25", "produto": "Meia de Leite", "quantidade": 12, "valor": 10.8, "iva": 6}, {"id": 1730419200203, "data": "2025-11-25", "produto": "Tosta Mista", "quantidade": 15, "valor": 37.5, "iva": 6}, {"id": 1730419200204, "data": "2025-11-25", "produto": "Croissant", "quantidade": 21, "valor": 25.2, "iva": 6}, {"id": 1730419200205, "data": "2025-11-25", "produto": "Pastel de Nata", "quantidade": 27, "valor": 29.7, "iva": 6}, {"id": 1730419200206, "data": "2025-11-25", "produto": "Sandes Natural", "quantidade": 12, "valor": 42.0, "iva": 6}, {"id": 1730419200207, "data": "2025-11-25", "produto": "Bolo de Chocolate", "quantidade": 16, "valor": 32.0, "iva": 6}, {"id": 1730419200208, "data": "2025-11-25", "produto": "Sandes de Presunto", "quantidade": 8, "valor": 32.0, "iva": 6}, {"id": 1730419200209, "data": "2025-11-25", "produto": "Sandes de Atum", "quantidade": 6, "valor": 22.8, "iva": 6}, {"id": 1730419200210, "data": "2025-11-26", "produto": "Caf\u00e9 Expresso", "quantidade": 51, "valor": 40.8, "iva": 6}, {"id": 1730419200211, "data": "2025-11-26", "produto": "Gal\u00e3o", "quantidade": 29, "valor": 43.5, "iva": 6}, {"id": 1730419200212, "data": "2025-11-26", "produto": "Meia de Leite", "quantidade": 19, "valor": 17.1, "iva": 6}, {"id": 1730419200213, "data": "2025-11-26", "produto": "Tosta Mista", "quantidade": 20, "valor": 50.0, "iva": 6}, {"id": 1730419200214, "data": "2025-11-26", "produto": "Croissant", "quantidade": 15, "valor": 18.0, "iva": 6}, {"id": 1730419200215, "data": "2025-11-26", "produto": "Pastel de Nata", "quantidade": 29, "valor": 31.9, "iva": 6}, {"id": 1730419200216, "data": "2025-11-26", "produto": "Sandes Natural", "quantidade": 10, "valor": 35.0, "iva": 6}, {"id": 1730419200217, "data": "2025-11-26", "produto": "Bolo de Chocolate", "quantidade": 13, "valor": 26.0, "iva": 6}, {"id": 1730419200218, "data": "2025-11-26", "produto": "Sandes de Presunto", "quantidade": 5, "valor": 20.0, "iva": 6}, {"id": 1730419200219, "data": "2025-11-26", "produto": "Sandes de Atum", "quantidade": 8, "valor": 30.4, "iva": 6}, {"id": 1730419200220, "data": "2025-11-27", "produto": "Caf\u00e9 Expresso", "quantidade": 44, "valor": 35.2, "iva": 6}, {"id": 1730419200221, "data": "2025-11-27", "produto": "Gal\u00e3o", "quantidade": 27, "valor": 40.5, "iva": 6}, {"id": 1730419200222, "data": "2025-11-27", "produto": "Meia de Leite", "quantidade": 17, "valor": 15.3, "iva": 6}, {"id": 1730419200223, "data": "2025-11-27", "produto": "Tosta Mista", "quantidade": 12, "valor": 30.0, "iva": 6}, {"id": 1730419200224, "data": "2025-11-27", "produto": "Croissant", "quantidade": 19, "valor": 22.8, "iva": 6}, {"id": 1730419200225, "data": "2025-11-27", "produto": "Pastel de Nata", "quantidade": 28, "valor": 30.8, "iva": 6}, {"id": 1730419200226, "data": "2025-11-27", "produto": "Sandes Natural", "quantidade": 12, "valor": 42.0, "iva": 6}, {"id": 1730419200227, "data": "2025-11-27", "produto": "Bolo de Chocolate", "quantidade": 16, "valor": 32.0, "iva": 6}, {"id": 1730419200228, "data": "2025-11-27", "produto": "Sandes de Presunto", "quantidade": 6, "valor": 24.0, "iva": 6}, {"id": 1730419200229, "data": "2025-11-27", "produto": "Sandes de Atum", "quantidade": 6, "valor": 22.8, "iva": 6}, {"id": 1730419200230, "data": "2025-11-28", "produto": "Caf\u00e9 Expresso", "quantidade": 39, "valor": 31.2, "iva": 6}, {"id": 1730419200231, "data": "2025-11-28", "produto": "Gal\u00e3o", "quantidade": 29, "valor": 43.5, "iva": 6}, {"id": 1730419200232, "data": "2025-11-28", "produto": "Meia de Leite", "quantidade": 10, "valor": 9.0, "iva": 6}, {"id": 1730419200233, "data": "2025-11-28", "produto": "Tosta Mista", "quantidade": 25, "valor": 62.5, "iva": 6}, {"id": 1730419200234, "data": "2025-11-28", "produto": "Croissant", "quantidade": 17, "valor": 20.4, "iva": 6}, {"id": 1730419200235, "data": "2025-11-28", "produto": "Pastel de Nata", "quantidade": 32, "valor": 35.2, "iva": 6}, {"id": 1730419200236, "data": "2025-11-28", "produto": "Sandes Natural", "quantidade": 6, "valor": 21.0, "iva": 6}, {"id": 1730419200237, "data": "2025-11-28", "produto": "Bolo de Chocolate", "quantidade": 17, "valor": 34.0, "iva": 6}, {"id": 1730419200238, "data": "2025-11-28", "produto": "Sandes de Presunto", "quantidade": 7, "valor": 28.0, "iva": 6}, {"id": 1730419200239, "data": "2025-11-28", "produto": "Sandes de Atum", "quantidade": 11, "valor": 41.8, "iva": 6}, {"id": 1730419200240, "data": "2025-11-29", "produto": "Caf\u00e9 Expresso", "quantidade": 39, "valor": 31.2, "iva": 6}, {"id": 1730419200241, "data": "2025-11-29", "produto": "Gal\u00e3o", "quantidade": 17, "valor": 25.5, "iva": 6}, {"id": 1730419200242, "data": "2025-11-29", "produto": "Meia de Leite", "quantidade": 10, "valor": 9.0, "iva": 6}, {"id": 1730419200243, "data": "2025-11-29", "produto": "Tosta Mista", "quantidade": 20, "valor": 50.0, "iva": 6}, {"id": 1730419200244, "data": "2025-11-29", "produto": "Croissant", "quantidade": 19, "valor": 22.8, "iva": 6}, {"id": 1730419200245, "data": "2025-11-29", "produto": "Pastel de Nata", "quantidade": 27, "valor": 29.7, "iva": 6}, {"id": 1730419200246, "data": "2025-11-29", "produto": "Sandes Natural", "quantidade": 7, "valor": 24.5, "iva": 6}, {"id": 1730419200247, "data": "2025-11-29", "produto": "Bolo de Chocolate", "quantidade": 9, "valor": 18.0, "iva": 6}, {"id": 1730419200248, "data": "2025-11-29", "produto": "Sandes de Presunto", "quantidade": 8, "valor": 32.0, "iva": 6}, {"id": 1730419200249, "data": "2025-11-29", "produto": "Sandes de Atum", "quantidade": 5, "valor": 19.0, "iva": 6}, {"id": 1730419200250, "data": "2025-12-01", "produto": "Caf\u00e9 Expresso", "quantidade": 57, "valor": 45.6, "iva": 6}, {"id": 1730419200251, "data": "2025-12-01", "produto": "Gal\u00e3o", "quantidade": 22, "valor": 33.0, "iva": 6}, {"id": 1730419200252, "data": "2025-12-01", "produto": "Meia de Leite", "quantidade": 11, "valor": 9.9, "iva": 6}, {"id": 1730419200253, "data": "2025-12-01", "produto": "Tosta Mista", "quantidade": 18, "valor": 45.0, "iva": 6}, {"id": 1730419200254, "data": "2025-12-01", "produto": "Croissant", "quantidade": 22, "valor": 26.4, "iva": 6}, {"id": 1730419200255, "data": "2025-12-01", "produto": "Pastel de Nata", "quantidade": 25, "valor": 27.5, "iva": 6}, {"id": 1730419200256, "data": "2025-12-01", "produto": "Sandes Natural", "quantidade": 7, "valor": 24.5, "iva": 6}, {"id": 1730419200257, "data": "2025-12-01", "produto": "Bolo de Chocolate", "quantidade": 10, "valor": 20.0, "iva": 6}, {"id": 1730419200258, "data": "2025-12-01", "produto": "Sandes de Presunto", "quantidade": 5, "valor": 20.0, "iva": 6}, {"id": 1730419200259, "data": "2025-12-01", "produto": "Sandes de Atum", "quantidade": 11, "valor": 41.8, "iva": 6}, {"id": 1730419200260, "data": "2025-12-02", "produto": "Caf\u00e9 Expresso", "quantidade": 51, "valor": 40.8, "iva": 6}, {"id": 1730419200261, "data": "2025-12-02", "produto": "Gal\u00e3o", "quantidade": 26, "valor": 39.0, "iva": 6}, {"id": 1730419200262, "data": "2025-12-02", "produto": "Meia de Leite", "quantidade": 19, "valor": 17.1, "iva": 6}, {"id": 1730419200263, "data": "2025-12-02", "produto": "Tosta Mista", "quantidade": 19, "valor": 47.5, "iva": 6}, {"id": 1730419200264, "data": "2025-12-02", "produto": "Croissant", "quantidade": 21, "valor": 25.2, "iva": 6}, {"id": 1730419200265, "data": "2025-12-02", "produto": "Pastel de Nata", "quantidade": 29, "valor": 31.9, "iva": 6}, {"id": 1730419200266, "data": "2025-12-02", "produto": "Sandes Natural", "quantidade": 14, "valor": 49.0, "iva": 6}, {"id": 1730419200267, "data": "2025-12-02", "produto": "Bolo de Chocolate", "quantidade": 11, "valor": 22.0, "iva": 6}, {"id": 1730419200268, "data": "2025-12-02", "produto": "Sandes de Presunto", "quantidade": 4, "valor": 16.0, "iva": 6}, {"id": 1730419200269, "data": "2025-12-02", "produto": "Sandes de Atum", "quantidade": 5, "valor": 19.0, "iva": 6}, {"id": 1730419200270, "data": "2025-12-03", "produto": "Caf\u00e9 Expresso", "quantidade": 40, "valor": 32.0, "iva": 6}, {"id": 1730419200271, "data": "2025-12-03", "produto": "Gal\u00e3o", "quantidade": 36, "valor": 54.0, "iva": 6}, {"id": 1730419200272, "data": "2025-12-03", "produto": "Meia de Leite", "quantidade": 16, "valor": 14.4, "iva": 6}, {"id": 1730419200273, "data": "2025-12-03", "produto": "Tosta Mista", "quantidade": 21, "valor": 52.5, "iva": 6}, {"id": 1730419200274, "data": "2025-12-03", "produto": "Croissant", "quantidade": 20, "valor": 24.0, "iva": 6}, {"id": 1730419200275, "data": "2025-12-03", "produto": "Pastel de Nata", "quantidade": 30, "valor": 33.0, "iva": 6}, {"id": 1730419200276, "data": "2025-12-03", "produto": "Sandes Natural", "quantidade": 10, "valor": 35.0, "iva": 6}, {"id": 1730419200277, "data": "2025-12-03", "produto": "Bolo de Chocolate", "quantidade": 10, "valor": 20.0, "iva": 6}, {"id": 1730419200278, "data": "2025-12-03", "produto": "Sandes de Presunto", "quantidade": 4, "valor": 16.0, "iva": 6}, {"id": 1730419200279, "data": "2025-12-03", "produto": "Sandes de Atum", "quantidade": 11, "valor": 41.8, "iva": 6}, {"id": 1730419200280, "data": "2025-12-04", "produto": "Caf\u00e9 Expresso", "quantidade": 39, "valor": 31.2, "iva": 6}, {"id": 1730419200281, "data": "2025-12-04", "produto": "Gal\u00e3o", "quantidade": 29, "valor": 43.5, "iva": 6}, {"id": 1730419200282, "data": "2025-12-04", "produto": "Meia de Leite", "quantidade": 14, "valor": 12.6, "iva": 6}, {"id": 1730419200283, "data": "2025-12-04", "produto": "Tosta Mista", "quantidade": 26, "valor": 65.0, "iva": 6}, {"id": 1730419200284, "data": "2025-12-04", "produto": "Croissant", "quantidade": 19, "valor": 22.8, "iva": 6}, {"id": 1730419200285, "data": "2025-12-04", "produto": "Pastel de Nata", "quantidade": 28, "valor": 30.8, "iva": 6}, {"id": 1730419200286, "data": "2025-12-04", "produto": "Sandes Natural", "quantidade": 10, "valor": 35.0, "iva": 6}, {"id": 1730419200287, "data": "2025-12-04", "produto": "Bolo de Chocolate", "quantidade": 8, "valor": 16.0, "iva": 6}, {"id": 1730419200288, "data": "2025-12-04", "produto": "Sandes de Presunto", "quantidade": 8, "valor": 32.0, "iva": 6}, {"id": 1730419200289, "data": "2025-12-04", "produto": "Sandes de Atum", "quantidade": 5, "valor": 19.0, "iva": 6}, {"id": 1730419200290, "data": "2025-12-05", "produto": "Caf\u00e9 Expresso", "quantidade": 37, "valor": 29.6, "iva": 6}, {"id": 1730419200291, "data": "2025-12-05", "produto": "Gal\u00e3o", "quantidade": 25, "valor": 37.5, "iva": 6}, {"id": 1730419200292, "data": "2025-12-05", "produto": "Meia de Leite", "quantidade": 13, "valor": 11.7, "iva": 6}, {"id": 1730419200293, "data": "2025-12-05", "produto": "Tosta Mista", "quantidade": 22, "valor": 55.0, "iva": 6}, {"id": 1730419200294, "data": "2025-12-05", "produto": "Croissant", "quantidade": 17, "valor": 20.4, "iva": 6}, {"id": 1730419200295, "data": "2025-12-05", "produto": "Pastel de Nata", "quantidade": 39, "valor": 42.9, "iva": 6}, {"id": 1730419200296, "data": "2025-12-05", "produto": "Sandes Natural", "quantidade": 11, "valor": 38.5, "iva": 6}, {"id": 1730419200297, "data": "2025-12-05", "produto": "Bolo de Chocolate", "quantidade": 16, "valor": 32.0, "iva": 6}, {"id": 1730419200298, "data": "2025-12-05", "produto": "Sandes de Presunto", "quantidade": 6, "valor": 24.0, "iva": 6}, {"id": 1730419200299, "data": "2025-12-05", "produto": "Sandes de Atum", "quantidade": 7, "valor": 26.6, "iva": 6}, {"id": 1730419200300, "data": "2025-12-06", "produto": "Caf\u00e9 Expresso", "quantidade": 45, "valor": 36.0, "iva": 6}, {"id": 1730419200301, "data": "2025-12-06", "produto": "Gal\u00e3o", "quantidade": 29, "valor": 43.5, "iva": 6}, {"id": 1730419200302, "data": "2025-12-06", "produto": "Meia de Leite", "quantidade": 6, "valor": 5.4, "iva": 6}, {"id": 1730419200303, "data": "2025-12-06", "produto": "Tosta Mista", "quantidade": 24, "valor": 60.0, "iva": 6}, {"id": 1730419200304, "data": "2025-12-06", "produto": "Croissant", "quantidade": 15, "valor": 18.0, "iva": 6}, {"id": 1730419200305, "data": "2025-12-06", "produto": "Pastel de Nata", "quantidade": 22, "valor": 24.2, "iva": 6}, {"id": 1730419200306, "data": "2025-12-06", "produto": "Sandes Natural", "quantidade": 6, "valor": 21.0, "iva": 6}, {"id": 1730419200307, "data": "2025-12-06", "produto": "Bolo de Chocolate", "quantidade": 12, "valor": 24.0, "iva": 6}, {"id": 1730419200308, "data": "2025-12-06", "produto": "Sandes de Presunto", "quantidade": 4, "valor": 16.0, "iva": 6}, {"id": 1730419200309, "data": "2025-12-06", "produto": "Sandes de Atum", "quantidade": 7, "valor": 26.6, "iva": 6}, {"id": 1730419200310, "data": "2025-12-08", "produto": "Caf\u00e9 Expresso", "quantidade": 55, "valor": 44.0, "iva": 6}, {"id": 1730419200311, "data": "2025-12-08", "produto": "Gal\u00e3o", "quantidade": 23, "valor": 34.5, "iva": 6}, {"id": 1730419200312, "data": "2025-12-08", "produto": "Meia de Leite", "quantidade": 17, "valor": 15.3, "iva": 6}, {"id": 1730419200313, "data": "2025-12-08", "produto": "Tosta Mista", "quantidade": 25, "valor": 62.5, "iva": 6}, {"id": 1730419200314, "data": "2025-12-08", "produto": "Croissant", "quantidade": 20, "valor": 24.0, "iva": 6}, {"id": 1730419200315, "data": "2025-12-08", "produto": "Pastel de Nata", "quantidade": 28, "valor": 30.8, "iva": 6}, {"id": 1730419200316, "data": "2025-12-08", "produto": "Sandes Natural", "quantidade": 6, "valor": 21.0, "iva": 6}, {"id": 1730419200317, "data": "2025-12-08", "produto": "Bolo de Chocolate", "quantidade": 14, "valor": 28.0, "iva": 6}, {"id": 1730419200318, "data": "2025-12-08", "produto": "Sandes de Presunto", "quantidade": 4, "valor": 16.0, "iva": 6}, {"id": 1730419200319, "data": "2025-12-08", "produto": "Sandes de Atum", "quantidade": 4, "valor": 15.2, "iva": 6}, {"id": 1730419200320, "data": "2025-12-09", "produto": "Caf\u00e9 Expresso", "quantidade": 39, "valor": 31.2, "iva": 6}, {"id": 1730419200321, "data": "2025-12-09", "produto": "Gal\u00e3o", "quantidade": 25, "valor": 37.5, "iva": 6}, {"id": 1730419200322, "data": "2025-12-09", "produto": "Meia de Leite", "quantidade": 15, "valor": 13.5, "iva": 6}, {"id": 1730419200323, "data": "2025-12-09", "produto": "Tosta Mista", "quantidade": 25, "valor": 62.5, "iva": 6}, {"id": 1730419200324, "data": "2025-12-09", "produto": "Croissant", "quantidade": 16, "valor": 19.2, "iva": 6}, {"id": 1730419200325, "data": "2025-12-09", "produto": "Pastel de Nata", "quantidade": 32, "valor": 35.2, "iva": 6}, {"id": 1730419200326, "data": "2025-12-09", "produto": "Sandes Natural", "quantidade": 6, "valor": 21.0, "iva": 6}, {"id": 1730419200327, "data": "2025-12-09", "produto": "Bolo de Chocolate", "quantidade": 17, "valor": 34.0, "iva": 6}, {"id": 1730419200328, "data": "2025-12-09", "produto": "Sandes de Presunto", "quantidade": 8, "valor": 32.0, "iva": 6}, {"id": 1730419200329, "data": "2025-12-09", "produto": "Sandes de Atum", "quantidade": 9, "valor": 34.2, "iva": 6}, {"id": 1730419200330, "data": "2025-12-10", "produto": "Caf\u00e9 Expresso", "quantidade": 50, "valor": 40.0, "iva": 6}, {"id": 1730419200331, "data": "2025-12-10", "produto": "Gal\u00e3o", "quantidade": 35, "valor": 52.5, "iva": 6}, {"id": 1730419200332, "data": "2025-12-10", "produto": "Meia de Leite", "quantidade": 12, "valor": 10.8, "iva": 6}, {"id": 1730419200333, "data": "2025-12-10", "produto": "Tosta Mista", "quantidade": 22, "valor": 55.0, "iva": 6}, {"id": 1730419200334, "data": "2025-12-10", "produto": "Croissant", "quantidade": 21, "valor": 25.2, "iva": 6}, {"id": 1730419200335, "data": "2025-12-10", "produto": "Pastel de Nata", "quantidade": 36, "valor": 39.6, "iva": 6}, {"id": 1730419200336, "data": "2025-12-10", "produto": "Sandes Natural", "quantidade": 13, "valor": 45.5, "iva": 6}, {"id": 1730419200337, "data": "2025-12-10", "produto": "Bolo de Chocolate", "quantidade": 16, "valor": 32.0, "iva": 6}, {"id": 1730419200338, "data": "2025-12-10", "produto": "Sandes de Presunto", "quantidade": 6, "valor": 24.0, "iva": 6}, {"id": 1730419200339, "data": "2025-12-10", "produto": "Sandes de Atum", "quantidade": 6, "valor": 22.8, "iva": 6}, {"id": 1730419200340, "data": "2025-12-11", "produto": "Caf\u00e9 Expresso", "quantidade": 50, "valor": 40.0, "iva": 6}, {"id": 1730419200341, "data": "2025-12-11", "produto": "Gal\u00e3o", "quantidade": 26, "valor": 39.0, "iva": 6}, {"id": 1730419200342, "data": "2025-12-11", "produto": "Meia de Leite", "quantidade": 10, "valor": 9.0, "iva": 6}, {"id": 1730419200343, "data": "2025-12-11", "produto": "Tosta Mista", "quantidade": 18, "valor": 45.0, "iva": 6}, {"id": 1730419200344, "data": "2025-12-11", "produto": "Croissant", "quantidade": 19, "valor": 22.8, "iva": 6}, {"id": 1730419200345, "data": "2025-12-11", "produto": "Pastel de Nata", "quantidade": 39, "valor": 42.9, "iva": 6}, {"id": 1730419200346, "data": "2025-12-11", "produto": "Sandes Natural", "quantidade": 14, "valor": 49.0, "iva": 6}, {"id": 1730419200347, "data": "2025-12-11", "produto": "Bolo de Chocolate", "quantidade": 15, "valor": 30.0, "iva": 6}, {"id": 1730419200348, "data": "2025-12-11", "produto": "Sandes de Presunto", "quantidade": 3, "valor": 12.0, "iva": 6}, {"id": 1730419200349, "data": "2025-12-11", "produto": "Sandes de Atum", "quantidade": 5, "valor": 19.0, "iva": 6}, {"id": 1730419200350, "data": "2025-12-12", "produto": "Caf\u00e9 Expresso", "quantidade": 50, "valor": 40.0, "iva": 6}, {"id": 1730419200351, "data": "2025-12-12", "produto": "Gal\u00e3o", "quantidade": 23, "valor": 34.5, "iva": 6}, {"id": 1730419200352, "data": "2025-12-12", "produto": "Meia de Leite", "quantidade": 16, "valor": 14.4, "iva": 6}, {"id": 1730419200353, "data": "2025-12-12", "produto": "Tosta Mista", "quantidade": 27, "valor": 67.5, "iva": 6}, {"id": 1730419200354, "data": "2025-12-12", "produto": "Croissant", "quantidade": 22, "valor": 26.4, "iva": 6}, {"id": 1730419200355, "data": "2025-12-12", "produto": "Pastel de Nata", "quantidade": 36, "valor": 39.6, "iva": 6}, {"id": 1730419200356, "data": "2025-12-12", "produto": "Sandes Natural", "quantidade": 14, "valor": 49.0, "iva": 6}, {"id": 1730419200357, "data": "2025-12-12", "produto": "Bolo de Chocolate", "quantidade": 10, "valor": 20.0, "iva": 6}, {"id": 1730419200358, "data": "2025-12-12", "produto": "Sandes de Presunto", "quantidade": 6, "valor": 24.0, "iva": 6}, {"id": 1730419200359, "data": "2025-12-12", "produto": "Sandes de Atum", "quantidade": 10, "valor": 38.0, "iva": 6}, {"id": 1730419200360, "data": "2025-12-13", "produto": "Caf\u00e9 Expresso", "quantidade": 35, "valor": 28.0, "iva": 6}, {"id": 1730419200361, "data": "2025-12-13", "produto": "Gal\u00e3o", "quantidade": 20, "valor": 30.0, "iva": 6}, {"id": 1730419200362, "data": "2025-12-13", "produto": "Meia de Leite", "quantidade": 9, "valor": 8.1, "iva": 6}, {"id": 1730419200363, "data": "2025-12-13", "produto": "Tosta Mista", "quantidade": 15, "valor": 37.5, "iva": 6}, {"id": 1730419200364, "data": "2025-12-13", "produto": "Croissant", "quantidade": 15, "valor": 18.0, "iva": 6}, {"id": 1730419200365, "data": "2025-12-13", "produto": "Pastel de Nata", "quantidade": 30, "valor": 33.0, "iva": 6}, {"id": 1730419200366, "data": "2025-12-13", "produto": "Sandes Natural", "quantidade": 16, "valor": 56.0, "iva": 6}, {"id": 1730419200367, "data": "2025-12-13", "produto": "Bolo de Chocolate", "quantidade": 8, "valor": 16.0, "iva": 6}, {"id": 1730419200368, "data": "2025-12-13", "produto": "Sandes de Presunto", "quantidade": 7, "valor": 28.0, "iva": 6}, {"id": 1730419200369, "data": "2025-12-13", "produto": "Sandes de Atum", "quantidade": 9, "valor": 34.2, "iva": 6}, {"id": 1730419200370, "data": "2025-12-15", "produto": "Caf\u00e9 Expresso", "quantidade": 60, "valor": 48.0, "iva": 6}, {"id": 1730419200371, "data": "2025-12-15", "produto": "Gal\u00e3o", "quantidade": 35, "valor": 52.5, "iva": 6}, {"id": 1730419200372, "data": "2025-12-15", "produto": "Meia de Leite", "quantidade": 17, "valor": 15.3, "iva": 6}, {"id": 1730419200373, "data": "2025-12-15", "produto": "Tosta Mista", "quantidade": 16, "valor": 40.0, "iva": 6}, {"id": 1730419200374, "data": "2025-12-15", "produto": "Croissant", "quantidade": 16, "valor": 19.2, "iva": 6}, {"id": 1730419200375, "data": "2025-12-15", "produto": "Pastel de Nata", "quantidade": 28, "valor": 30.8, "iva": 6}, {"id": 1730419200376, "data": "2025-12-15", "produto": "Sandes Natural", "quantidade": 13, "valor": 45.5, "iva": 6}, {"id": 1730419200377, "data": "2025-12-15", "produto": "Bolo de Chocolate", "quantidade": 10, "valor": 20.0, "iva": 6}, {"id": 1730419200378, "data": "2025-12-15", "produto": "Sandes de Presunto", "quantidade": 3, "valor": 12.0, "iva": 6}, {"id": 1730419200379, "data": "2025-12-15", "produto": "Sandes de Atum", "quantidade": 11, "valor": 41.8, "iva": 6}, {"id": 1730419200380, "data": "2025-12-16", "produto": "Caf\u00e9 Expresso", "quantidade": 39, "valor": 31.2, "iva": 6}, {"id": 1730419200381, "data": "2025-12-16", "produto": "Gal\u00e3o", "quantidade": 37, "valor": 55.5, "iva": 6}, {"id": 1730419200382, "data": "2025-12-16", "produto": "Meia de Leite", "quantidade": 14, "valor": 12.6, "iva": 6}, {"id": 1730419200383, "data": "2025-12-16", "produto": "Tosta Mista", "quantidade": 22, "valor": 55.0, "iva": 6}, {"id": 1730419200384, "data": "2025-12-16", "produto": "Croissant", "quantidade": 20, "valor": 24.0, "iva": 6}, {"id": 1730419200385, "data": "2025-12-16", "produto": "Pastel de Nata", "quantidade": 29, "valor": 31.9, "iva": 6}, {"id": 1730419200386, "data": "2025-12-16", "produto": "Sandes Natural", "quantidade": 13, "valor": 45.5, "iva": 6}, {"id": 1730419200387, "data": "2025-12-16", "produto": "Bolo de Chocolate", "quantidade": 14, "valor": 28.0, "iva": 6}, {"id": 1730419200388, "data": "2025-12-16", "produto": "Sandes de Presunto", "quantidade": 9, "valor": 36.0, "iva": 6}, {"id": 1730419200389, "data": "2025-12-16", "produto": "Sandes de Atum", "quantidade": 8, "valor": 30.4, "iva": 6}, {"id": 1730419200390, "data": "2025-12-17", "produto": "Caf\u00e9 Expresso", "quantidade": 52, "valor": 41.6, "iva": 6}, {"id": 1730419200391, "data": "2025-12-17", "produto": "Gal\u00e3o", "quantidade": 21, "valor": 31.5, "iva": 6}, {"id": 1730419200392, "data": "2025-12-17", "produto": "Meia de Leite", "quantidade": 16, "valor": 14.4, "iva": 6}, {"id": 1730419200393, "data": "2025-12-17", "produto": "Tosta Mista", "quantidade": 18, "valor": 45.0, "iva": 6}, {"id": 1730419200394, "data": "2025-12-17", "produto": "Croissant", "quantidade": 21, "valor": 25.2, "iva": 6}, {"id": 1730419200395, "data": "2025-12-17", "produto": "Pastel de Nata", "quantidade": 30, "valor": 33.0, "iva": 6}, {"id": 1730419200396, "data": "2025-12-17", "produto": "Sandes Natural", "quantidade": 11, "valor": 38.5, "iva": 6}, {"id": 1730419200397, "data": "2025-12-17", "produto": "Bolo de Chocolate", "quantidade": 12, "valor": 24.0, "iva": 6}, {"id": 1730419200398, "data": "2025-12-17", "produto": "Sandes de Presunto", "quantidade": 9, "valor": 36.0, "iva": 6}, {"id": 1730419200399, "data": "2025-12-17", "produto": "Sandes de Atum", "quantidade": 7, "valor": 26.6, "iva": 6}, {"id": 1730419200400, "data": "2025-12-18", "produto": "Caf\u00e9 Expresso", "quantidade": 50, "valor": 40.0, "iva": 6}, {"id": 1730419200401, "data": "2025-12-18", "produto": "Gal\u00e3o", "quantidade": 31, "valor": 46.5, "iva": 6}, {"id": 1730419200402, "data": "2025-12-18", "produto": "Meia de Leite", "quantidade": 19, "valor": 17.1, "iva": 6}, {"id": 1730419200403, "data": "2025-12-18", "produto": "Tosta Mista", "quantidade": 24, "valor": 60.0, "iva": 6}, {"id": 1730419200404, "data": "2025-12-18", "produto": "Croissant", "quantidade": 17, "valor": 20.4, "iva": 6}, {"id": 1730419200405, "data": "2025-12-18", "produto": "Pastel de Nata", "quantidade": 25, "valor": 27.5, "iva": 6}, {"id": 1730419200406, "data": "2025-12-18", "produto": "Sandes Natural", "quantidade": 9, "valor": 31.5, "iva": 6}, {"id": 1730419200407, "data": "2025-12-18", "produto": "Bolo de Chocolate", "quantidade": 11, "valor": 22.0, "iva": 6}, {"id": 1730419200408, "data": "2025-12-18", "produto": "Sandes de Presunto", "quantidade": 7, "valor": 28.0, "iva": 6}, {"id": 1730419200409, "data": "2025-12-18", "produto": "Sandes de Atum", "quantidade": 9, "valor": 34.2, "iva": 6}, {"id": 1730419200410, "data": "2025-12-19", "produto": "Caf\u00e9 Expresso", "quantidade": 51, "valor": 40.8, "iva": 6}, {"id": 1730419200411, "data": "2025-12-19", "produto": "Gal\u00e3o", "quantidade": 38, "valor": 57.0, "iva": 6}, {"id": 1730419200412, "data": "2025-12-19", "produto": "Meia de Leite", "quantidade": 16, "valor": 14.4, "iva": 6}, {"id": 1730419200413, "data": "2025-12-19", "produto": "Tosta Mista", "quantidade": 26, "valor": 65.0, "iva": 6}, {"id": 1730419200414, "data": "2025-12-19", "produto": "Croissant", "quantidade": 17, "valor": 20.4, "iva": 6}, {"id": 1730419200415, "data": "2025-12-19", "produto": "Pastel de Nata", "quantidade": 26, "valor": 28.6, "iva": 6}, {"id": 1730419200416, "data": "2025-12-19", "produto": "Sandes Natural", "quantidade": 8, "valor": 28.0, "iva": 6}, {"id": 1730419200417, "data": "2025-12-19", "produto": "Bolo de Chocolate", "quantidade": 10, "valor": 20.0, "iva": 6}, {"id": 1730419200418, "data": "2025-12-19", "produto": "Sandes de Presunto", "quantidade": 6, "valor": 24.0, "iva": 6}, {"id": 1730419200419, "data": "2025-12-19", "produto": "Sandes de Atum", "quantidade": 10, "valor": 38.0, "iva": 6}, {"id": 1730419200420, "data": "2025-12-20", "produto": "Caf\u00e9 Expresso", "quantidade": 28, "valor": 22.4, "iva": 6}, {"id": 1730419200421, "data": "2025-12-20", "produto": "Gal\u00e3o", "quantidade": 30, "valor": 45.0, "iva": 6}, {"id": 1730419200422, "data": "2025-12-20", "produto": "Meia de Leite", "quantidade": 8, "valor": 7.2, "iva": 6}, {"id": 1730419200423, "data": "2025-12-20", "produto": "Tosta Mista", "quantidade": 15, "valor": 37.5, "iva": 6}, {"id": 1730419200424, "data": "2025-12-20", "produto": "Croissant", "quantidade": 12, "valor": 14.4, "iva": 6}, {"id": 1730419200425, "data": "2025-12-20", "produto": "Pastel de Nata", "quantidade": 33, "valor": 36.3, "iva": 6}, {"id": 1730419200426, "data": "2025-12-20", "produto": "Sandes Natural", "quantidade": 13, "valor": 45.5, "iva": 6}, {"id": 1730419200427, "data": "2025-12-20", "produto": "Bolo de Chocolate", "quantidade": 17, "valor": 34.0, "iva": 6}, {"id": 1730419200428, "data": "2025-12-20", "produto": "Sandes de Presunto", "quantidade": 4, "valor": 16.0, "iva": 6}, {"id": 1730419200429, "data": "2025-12-20", "produto": "Sandes de Atum", "quantidade": 9, "valor": 34.2, "iva": 6}, {"id": 1730419200430, "data": "2025-12-22", "produto": "Caf\u00e9 Expresso", "quantidade": 48, "valor": 38.4, "iva": 6}, {"id": 1730419200431, "data": "2025-12-22", "produto": "Gal\u00e3o", "quantidade": 42, "valor": 63.0, "iva": 6}, {"id": 1730419200432, "data": "2025-12-22", "produto": "Meia de Leite", "quantidade": 10, "valor": 9.0, "iva": 6}, {"id": 1730419200433, "data": "2025-12-22", "produto": "Tosta Mista", "quantidade": 20, "valor": 50.0, "iva": 6}, {"id": 1730419200434, "data": "2025-12-22", "produto": "Croissant", "quantidade": 20, "valor": 24.0, "iva": 6}, {"id": 1730419200435, "data": "2025-12-22", "produto": "Pastel de Nata", "quantidade": 37, "valor": 40.7, "iva": 6}, {"id": 1730419200436, "data": "2025-12-22", "produto": "Sandes Natural", "quantidade": 6, "valor": 21.0, "iva": 6}, {"id": 1730419200437, "data": "2025-12-22", "produto": "Bolo de Chocolate", "quantidade": 17, "valor": 34.0, "iva": 6}, {"id": 1730419200438, "data": "2025-12-22", "produto": "Sandes de Presunto", "quantidade": 7, "valor": 28.0, "iva": 6}, {"id": 1730419200439, "data": "2025-12-22", "produto": "Sandes de Atum", "quantidade": 10, "valor": 38.0, "iva": 6}, {"id": 1730419200440, "data": "2025-12-23", "produto": "Caf\u00e9 Expresso", "quantidade": 55, "valor": 44.0, "iva": 6}, {"id": 1730419200441, "data": "2025-12-23", "produto": "Gal\u00e3o", "quantidade": 35, "valor": 52.5, "iva": 6}, {"id": 1730419200442, "data": "2025-12-23", "produto": "Meia de Leite", "quantidade": 18, "valor": 16.2, "iva": 6}, {"id": 1730419200443, "data": "2025-12-23", "produto": "Tosta Mista", "quantidade": 24, "valor": 60.0, "iva": 6}, {"id": 1730419200444, "data": "2025-12-23", "produto": "Croissant", "quantidade": 24, "valor": 28.8, "iva": 6}, {"id": 1730419200445, "data": "2025-12-23", "produto": "Pastel de Nata", "quantidade": 26, "valor": 28.6, "iva": 6}, {"id": 1730419200446, "data": "2025-12-23", "produto": "Sandes Natural", "quantidade": 6, "valor": 21.0, "iva": 6}, {"id": 1730419200447, "data": "2025-12-23", "produto": "Bolo de Chocolate", "quantidade": 9, "valor": 18.0, "iva": 6}, {"id": 1730419200448, "data": "2025-12-23", "produto": "Sandes de Presunto", "quantidade": 8, "valor": 32.0, "iva": 6}, {"id": 1730419200449, "data": "2025-12-23", "produto": "Sandes de Atum", "quantidade": 9, "valor": 34.2, "iva": 6}, {"id": 1730419200450, "data": "2025-12-24", "produto": "Caf\u00e9 Expresso", "quantidade": 51, "valor": 40.8, "iva": 6}, {"id": 1730419200451, "data": "2025-12-24", "produto": "Gal\u00e3o", "quantidade": 40, "valor": 60.0, "iva": 6}, {"id": 1730419200452, "data": "2025-12-24", "produto": "Meia de Leite", "quantidade": 14, "valor": 12.6, "iva": 6}, {"id": 1730419200453, "data": "2025-12-24", "produto": "Tosta Mista", "quantidade": 22, "valor": 55.0, "iva": 6}, {"id": 1730419200454, "data": "2025-12-24", "produto": "Croissant", "quantidade": 21, "valor": 25.2, "iva": 6}, {"id": 1730419200455, "data": "2025-12-24", "produto": "Pastel de Nata", "quantidade": 35, "valor": 38.5, "iva": 6}, {"id": 1730419200456, "data": "2025-12-24", "produto": "Sandes Natural", "quantidade": 6, "valor": 21.0, "iva": 6}, {"id": 1730419200457, "data": "2025-12-24", "produto": "Bolo de Chocolate", "quantidade": 12, "valor": 24.0, "iva": 6}, {"id": 1730419200458, "data": "2025-12-24", "produto": "Sandes de Presunto", "quantidade": 9, "valor": 36.0, "iva": 6}, {"id": 1730419200459, "data": "2025-12-24", "produto": "Sandes de Atum", "quantidade": 6, "valor": 22.8, "iva": 6}, {"id": 1730419200460, "data": "2025-12-25", "produto": "Caf\u00e9 Expresso", "quantidade": 56, "valor": 44.8, "iva": 6}, {"id": 1730419200461, "data": "2025-12-25", "produto": "Gal\u00e3o", "quantidade": 33, "valor": 49.5, "iva": 6}, {"id": 1730419200462, "data": "2025-12-25", "produto": "Meia de Leite", "quantidade": 15, "valor": 13.5, "iva": 6}, {"id": 1730419200463, "data": "2025-12-25", "produto": "Tosta Mista", "quantidade": 20, "valor": 50.0, "iva": 6}, {"id": 1730419200464, "data": "2025-12-25", "produto": "Croissant", "quantidade": 24, "valor": 28.8, "iva": 6}, {"id": 1730419200465, "data": "2025-12-25", "produto": "Pastel de Nata", "quantidade": 30, "valor": 33.0, "iva": 6}, {"id": 1730419200466, "data": "2025-12-25", "produto": "Sandes Natural", "quantidade": 9, "valor": 31.5, "iva": 6}, {"id": 1730419200467, "data": "2025-12-25", "produto": "Bolo de Chocolate", "quantidade": 13, "valor": 26.0, "iva": 6}, {"id": 1730419200468, "data": "2025-12-25", "produto": "Sandes de Presunto", "quantidade": 8, "valor": 32.0, "iva": 6}, {"id": 1730419200469, "data": "2025-12-25", "produto": "Sandes de Atum", "quantidade": 8, "valor": 30.4, "iva": 6}, {"id": 1730419200470, "data": "2025-12-26", "produto": "Caf\u00e9 Expresso", "quantidade": 63, "valor": 50.4, "iva": 6}, {"id": 1730419200471, "data": "2025-12-26", "produto": "Gal\u00e3o", "quantidade": 37, "valor": 55.5, "iva": 6}, {"id": 1730419200472, "data": "2025-12-26", "produto": "Meia de Leite", "quantidade": 19, "valor": 17.1, "iva": 6}, {"id": 1730419200473, "data": "2025-12-26", "produto": "Tosta Mista", "quantidade": 25, "valor": 62.5, "iva": 6}, {"id": 1730419200474, "data": "2025-12-26", "produto": "Croissant", "quantidade": 22, "valor": 26.4, "iva": 6}, {"id": 1730419200475, "data": "2025-12-26", "produto": "Pastel de Nata", "quantidade": 37, "valor": 40.7, "iva": 6}, {"id": 1730419200476, "data": "2025-12-26", "produto": "Sandes Natural", "quantidade": 6, "valor": 21.0, "iva": 6}, {"id": 1730419200477, "data": "2025-12-26", "produto": "Bolo de Chocolate", "quantidade": 16, "valor": 32.0, "iva": 6}, {"id": 1730419200478, "data": "2025-12-26", "produto": "Sandes de Presunto", "quantidade": 4, "valor": 16.0, "iva": 6}, {"id": 1730419200479, "data": "2025-12-26", "produto": "Sandes de Atum", "quantidade": 5, "valor": 19.0, "iva": 6}, {"id": 1730419200480, "data": "2025-12-27", "produto": "Caf\u00e9 Expresso", "quantidade": 43, "valor": 34.4, "iva": 6}, {"id": 1730419200481, "data": "2025-12-27", "produto": "Gal\u00e3o", "quantidade": 15, "valor": 22.5, "iva": 6}, {"id": 1730419200482, "data": "2025-12-27", "produto": "Meia de Leite", "quantidade": 10, "valor": 9.0, "iva": 6}, {"id": 1730419200483, "data": "2025-12-27", "produto": "Tosta Mista", "quantidade": 24, "valor": 60.0, "iva": 6}, {"id": 1730419200484, "data": "2025-12-27", "produto": "Croissant", "quantidade": 13, "valor": 15.6, "iva": 6}, {"id": 1730419200485, "data": "2025-12-27", "produto": "Pastel de Nata", "quantidade": 34, "valor": 37.4, "iva": 6}, {"id": 1730419200486, "data": "2025-12-27", "produto": "Sandes Natural", "quantidade": 12, "valor": 42.0, "iva": 6}, {"id": 1730419200487, "data": "2025-12-27", "produto": "Bolo de Chocolate", "quantidade": 10, "valor": 20.0, "iva": 6}, {"id": 1730419200488, "data": "2025-12-27", "produto": "Sandes de Presunto", "quantidade": 7, "valor": 28.0, "iva": 6}, {"id": 1730419200489, "data": "2025-12-27", "produto": "Sandes de Atum", "quantidade": 8, "valor": 30.4, "iva": 6}, {"id": 1730419200490, "data": "2025-12-29", "produto": "Caf\u00e9 Expresso", "quantidade": 50, "valor": 40.0, "iva": 6}, {"id": 1730419200491, "data": "2025-12-29", "produto": "Gal\u00e3o", "quantidade": 29, "valor": 43.5, "iva": 6}, {"id": 1730419200492, "data": "2025-12-29", "produto": "Meia de Leite", "quantidade": 16, "valor": 14.4, "iva": 6}, {"id": 1730419200493, "data": "2025-12-29", "produto": "Tosta Mista", "quantidade": 21, "valor": 52.5, "iva": 6}, {"id": 1730419200494, "data": "2025-12-29", "produto": "Croissant", "quantidade": 19, "valor": 22.8, "iva": 6}, {"id": 1730419200495, "data": "2025-12-29", "produto": "Pastel de Nata", "quantidade": 26, "valor": 28.6, "iva": 6}, {"id": 1730419200496, "data": "2025-12-29", "produto": "Sandes Natural", "quantidade": 13, "valor": 45.5, "iva": 6}, {"id": 1730419200497, "data": "2025-12-29", "produto": "Bolo de Chocolate", "quantidade": 11, "valor": 22.0, "iva": 6}, {"id": 1730419200498, "data": "2025-12-29", "produto": "Sandes de Presunto", "quantidade": 9, "valor": 36.0, "iva": 6}, {"id": 1730419200499, "data": "2025-12-29", "produto": "Sandes de Atum", "quantidade": 9, "valor": 34.2, "iva": 6}, {"id": 1730419200500, "data": "2025-12-30", "produto": "Caf\u00e9 Expresso", "quantidade": 50, "valor": 40.0, "iva": 6}, {"id": 1730419200501, "data": "2025-12-30", "produto": "Gal\u00e3o", "quantidade": 44, "valor": 66.0, "iva": 6}, {"id": 1730419200502, "data": "2025-12-30", "produto": "Meia de Leite", "quantidade": 12, "valor": 10.8, "iva": 6}, {"id": 1730419200503, "data": "2025-12-30", "produto": "Tosta Mista", "quantidade": 27, "valor": 67.5, "iva": 6}, {"id": 1730419200504, "data": "2025-12-30", "produto": "Croissant", "quantidade": 23, "valor": 27.6, "iva": 6}, {"id": 1730419200505, "data": "2025-12-30", "produto": "Pastel de Nata", "quantidade": 26, "valor": 28.6, "iva": 6}, {"id": 1730419200506, "data": "2025-12-30", "produto": "Sandes Natural", "quantidade": 10, "valor": 35.0, "iva": 6}, {"id": 1730419200507, "data": "2025-12-30", "produto": "Bolo de Chocolate", "quantidade": 14, "valor": 28.0, "iva": 6}, {"id": 1730419200508, "data": "2025-12-30", "produto": "Sandes de Presunto", "quantidade": 8, "valor": 32.0, "iva": 6}, {"id": 1730419200509, "data": "2025-12-30", "produto": "Sandes de Atum", "quantidade": 7, "valor": 26.6, "iva": 6}], "despesas": [{"id": 1730419200000, "descricao": "Renda do Espa\u00e7o - Novembro", "valor": 650, "iva": 23, "data": "2025-11-05", "categoria": "renda", "fornecedor": "", "ingredienteId": null, "quantidade": null}, {"id": 1730419200001, "descricao": "Sal\u00e1rio Part-time 20h - Novembro", "valor": 460, "iva": 23, "data": "2025-11-05", "categoria": "salarios", "fornecedor": "", "ingredienteId": null, "quantidade": null}, {"id": 1730419200002, "descricao": "Conta Eletricidade - Outubro", "valor": 175, "iva": 23, "data": "2025-11-05", "categoria": "utilities", "fornecedor": "EDP", "ingredienteId": null, "quantidade": null}, {"id": 1730419200003, "descricao": "Conta \u00c1gua - Outubro", "valor": 42, "iva": 6, "data": "2025-11-05", "categoria": "utilities", "fornecedor": "EPAL", "ingredienteId": null, "quantidade": null}, {"id": 1730419200004, "descricao": "Conta G\u00e1s - Outubro", "valor": 85, "iva": 23, "data": "2025-11-05", "categoria": "utilities", "fornecedor": "Galp", "ingredienteId": null, "quantidade": null}, {"id": 1730419200005, "descricao": "Renda do Espa\u00e7o - Dezembro", "valor": 650, "iva": 23, "data": "2025-12-05", "categoria": "renda", "fornecedor": "", "ingredienteId": null, "quantidade": null}, {"id": 1730419200006, "descricao": "Sal\u00e1rio Part-time 20h - Dezembro", "valor": 460, "iva": 23, "data": "2025-12-05", "categoria": "salarios", "fornecedor": "", "ingredienteId": null, "quantidade": null}, {"id": 1730419200007, "descricao": "Sal\u00e1rio Extra Natal", "valor": 230, "iva": 23, "data": "2025-12-05", "categoria": "salarios", "fornecedor": "", "ingredienteId": null, "quantidade": null}, {"id": 1730419200008, "descricao": "Conta Eletricidade - Novembro", "valor": 188, "iva": 23, "data": "2025-12-05", "categoria": "utilities", "fornecedor": "EDP", "ingredienteId": null, "quantidade": null}, {"id": 1730419200009, "descricao": "Conta \u00c1gua - Novembro", "valor": 47, "iva": 6, "data": "2025-12-05", "categoria": "utilities", "fornecedor": "EPAL", "ingredienteId": null, "quantidade": null}, {"id": 1730419200010, "descricao": "Conta G\u00e1s - Novembro", "valor": 92, "iva": 23, "data": "2025-12-05", "categoria": "utilities", "fornecedor": "Galp", "ingredienteId": null, "quantidade": null}, {"id": 1730419200011, "descricao": "Compra Caf\u00e9 em Gr\u00e3o - Delta Caf\u00e9s", "valor": 150.0, "iva": 6, "data": "2025-11-02", "categoria": "compras", "fornecedor": "Delta Caf\u00e9s", "ingredienteId": 1701388800000, "quantidade": 12}, {"id": 1730419200012, "descricao": "Compra Leite - Lactogal", "valor": 49.2, "iva": 6, "data": "2025-11-02", "categoria": "compras", "fornecedor": "Lactogal", "ingredienteId": 1701388801000, "quantidade": 60}, {"id": 1730419200013, "descricao": "Compra P\u00e3o - Padaria Silva", "valor": 52.5, "iva": 6, "data": "2025-11-03", "categoria": "compras", "fornecedor": "Padaria Silva", "ingredienteId": 1701388808000, "quantidade": 150}, {"id": 1730419200014, "descricao": "Compra Queijo - Makro", "valor": 26.7, "iva": 6, "data": "2025-11-04", "categoria": "compras", "fornecedor": "Makro", "ingredienteId": 1701388806000, "quantidade": 3}, {"id": 1730419200015, "descricao": "Compra Fiambre - Makro", "valor": 16.25, "iva": 6, "data": "2025-11-04", "categoria": "compras", "fornecedor": "Makro", "ingredienteId": 1701388807000, "quantidade": 2.5}, {"id": 1730419200016, "descricao": "Compra Farinha - Recheio", "valor": 7.8, "iva": 6, "data": "2025-11-05", "categoria": "compras", "fornecedor": "Recheio", "ingredienteId": 1701388803000, "quantidade": 10}, {"id": 1730419200017, "descricao": "Compra A\u00e7\u00facar - Recheio", "valor": 5.9, "iva": 6, "data": "2025-11-05", "categoria": "compras", "fornecedor": "Recheio", "ingredienteId": 1701388802000, "quantidade": 5}, {"id": 1730419200018, "descricao": "Compra Ovos - Makro", "valor": 43.2, "iva": 6, "data": "2025-11-06", "categoria": "compras", "fornecedor": "Makro", "ingredienteId": 1701388804000, "quantidade": 180}, {"id": 1730419200019, "descricao": "Compra Manteiga - Makro", "valor": 21.8, "iva": 6, "data": "2025-11-07", "categoria": "compras", "fornecedor": "Makro", "ingredienteId": 1701388805000, "quantidade": 4}, {"id": 1730419200020, "descricao": "Compra P\u00e3o - Padaria Silva", "valor": 50.4, "iva": 6, "data": "2025-11-10", "categoria": "compras", "fornecedor": "Padaria Silva", "ingredienteId": 1701388808000, "quantidade": 140}, {"id": 1730419200021, "descricao": "Compra Leite - Lactogal", "valor": 46.2, "iva": 6, "data": "2025-11-12", "categoria": "compras", "fornecedor": "Lactogal", "ingredienteId": 1701388801000, "quantidade": 55}, {"id": 1730419200022, "descricao": "Compra Caf\u00e9 em Gr\u00e3o - Buondi", "valor": 143.0, "iva": 6, "data": "2025-11-14", "categoria": "compras", "fornecedor": "Buondi", "ingredienteId": 1701388800000, "quantidade": 11}, {"id": 1730419200023, "descricao": "Compra Chocolate - Recheio", "valor": 21.45, "iva": 6, "data": "2025-11-15", "categoria": "compras", "fornecedor": "Recheio", "ingredienteId": 1701388811000, "quantidade": 3}, {"id": 1730419200024, "descricao": "Compra P\u00e3o - Padaria Silva", "valor": 50.75, "iva": 6, "data": "2025-11-17", "categoria": "compras", "fornecedor": "Padaria Silva", "ingredienteId": 1701388808000, "quantidade": 145}, {"id": 1730419200025, "descricao": "Compra Presunto - Makro", "valor": 23.6, "iva": 6, "data": "2025-11-19", "categoria": "compras", "fornecedor": "Makro", "ingredienteId": 1701388815000, "quantidade": 2}, {"id": 1730419200026, "descricao": "Compra Atum - Makro", "valor": 21.0, "iva": 6, "data": "2025-11-19", "categoria": "compras", "fornecedor": "Makro", "ingredienteId": 1701388816000, "quantidade": 2.5}, {"id": 1730419200027, "descricao": "Compra Leite - Lactogal", "valor": 48.14, "iva": 6, "data": "2025-11-21", "categoria": "compras", "fornecedor": "Lactogal", "ingredienteId": 1701388801000, "quantidade": 58}, {"id": 1730419200028, "descricao": "Compra P\u00e3o - Padaria Silva", "valor": 55.5, "iva": 6, "data": "2025-11-24", "categoria": "compras", "fornecedor": "Padaria Silva", "ingredienteId": 1701388808000, "quantidade": 150}, {"id": 1730419200029, "descricao": "Compra Caf\u00e9 em Gr\u00e3o - Delta Caf\u00e9s", "valor": 148.8, "iva": 6, "data": "2025-11-26", "categoria": "compras", "fornecedor": "Delta Caf\u00e9s", "ingredienteId": 1701388800000, "quantidade": 12}, {"id": 1730419200030, "descricao": "Compra Caf\u00e9 em Gr\u00e3o - Delta Caf\u00e9s", "valor": 163.8, "iva": 6, "data": "2025-12-02", "categoria": "compras", "fornecedor": "Delta Caf\u00e9s", "ingredienteId": 1701388800000, "quantidade": 13}, {"id": 1730419200031, "descricao": "Compra Leite - Lactogal", "valor": 53.32, "iva": 6, "data": "2025-12-02", "categoria": "compras", "fornecedor": "Lactogal", "ingredienteId": 1701388801000, "quantidade": 62}, {"id": 1730419200032, "descricao": "Compra P\u00e3o - Padaria Silva", "valor": 55.8, "iva": 6, "data": "2025-12-03", "categoria": "compras", "fornecedor": "Padaria Silva", "ingredienteId": 1701388808000, "quantidade": 155}, {"id": 1730419200033, "descricao": "Compra Queijo - Makro", "valor": 31.85, "iva": 6, "data": "2025-12-04", "categoria": "compras", "fornecedor": "Makro", "ingredienteId": 1701388806000, "quantidade": 3.5}, {"id": 1730419200034, "descricao": "Compra Fiambre - Makro", "valor": 19.8, "iva": 6, "data": "2025-12-04", "categoria": "compras", "fornecedor": "Makro", "ingredienteId": 1701388807000, "quantidade": 3}, {"id": 1730419200035, "descricao": "Compra Farinha - Recheio", "valor": 9.84, "iva": 6, "data": "2025-12-05", "categoria": "compras", "fornecedor": "Recheio", "ingredienteId": 1701388803000, "quantidade": 12}, {"id": 1730419200036, "descricao": "Compra Ovos - Makro", "valor": 52.0, "iva": 6, "data": "2025-12-06", "categoria": "compras", "fornecedor": "Makro", "ingredienteId": 1701388804000, "quantidade": 200}, {"id": 1730419200037, "descricao": "Compra P\u00e3o - Padaria Silva", "valor": 51.8, "iva": 6, "data": "2025-12-09", "categoria": "compras", "fornecedor": "Padaria Silva", "ingredienteId": 1701388808000, "quantidade": 148}, {"id": 1730419200038, "descricao": "Compra Leite - Lactogal", "valor": 52.2, "iva": 6, "data": "2025-12-11", "categoria": "compras", "fornecedor": "Lactogal", "ingredienteId": 1701388801000, "quantidade": 60}, {"id": 1730419200039, "descricao": "Compra Caf\u00e9 em Gr\u00e3o - Delta Caf\u00e9s", "valor": 150.0, "iva": 6, "data": "2025-12-13", "categoria": "compras", "fornecedor": "Delta Caf\u00e9s", "ingredienteId": 1701388800000, "quantidade": 12}, {"id": 1730419200040, "descricao": "Compra P\u00e3o - Padaria Silva", "valor": 54.72, "iva": 6, "data": "2025-12-16", "categoria": "compras", "fornecedor": "Padaria Silva", "ingredienteId": 1701388808000, "quantidade": 152}, {"id": 1730419200041, "descricao": "Compra Presunto - Makro", "valor": 30.5, "iva": 6, "data": "2025-12-18", "categoria": "compras", "fornecedor": "Makro", "ingredienteId": 1701388815000, "quantidade": 2.5}, {"id": 1730419200042, "descricao": "Compra Atum - Makro", "valor": 25.8, "iva": 6, "data": "2025-12-18", "categoria": "compras", "fornecedor": "Makro", "ingredienteId": 1701388816000, "quantidade": 3}, {"id": 1730419200043, "descricao": "Compra Leite - Lactogal", "valor": 55.25, "iva": 6, "data": "2025-12-20", "categoria": "compras", "fornecedor": "Lactogal", "ingredienteId": 1701388801000, "quantidade": 65}, {"id": 1730419200044, "descricao": "Compra P\u00e3o - Padaria Silva", "valor": 59.2, "iva": 6, "data": "2025-12-23", "categoria": "compras", "fornecedor": "Padaria Silva", "ingredienteId": 1701388808000, "quantidade": 160}, {"id": 1730419200045, "descricao": "Compra Caf\u00e9 em Gr\u00e3o - Buondi", "valor": 139.7, "iva": 6, "data": "2025-12-27", "categoria": "compras", "fornecedor": "Buondi", "ingredienteId": 1701388800000, "quantidade": 11}]};
  
  // Create a custom event to load data
  const loadEvent = new CustomEvent('loadBackupData', { detail: data });
  window.dispatchEvent(loadEvent);
}, 100);

const root = ReactDOM.createRoot(document.getElementById('root')); root.render(<RestauranteGestor />);
    </script>
</body>
</html>
